!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var s in i)("object"==typeof exports?exports:t)[s]=i[s]}}(window,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=39)}([function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=a;var n=i(2),r=i(1);function a(t,e){if(!(this instanceof a))return new a(t,e);void 0===t?(this.x=0,this.y=0):"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),o&&a.assert(this)}a.prototype._serialize=function(){return{x:this.x,y:this.y}},a._deserialize=function(t){var e=Object.create(a.prototype);return e.x=t.x,e.y=t.y,e},a.zero=function(){var t=Object.create(a.prototype);return t.x=0,t.y=0,t},a.neo=function(t,e){var i=Object.create(a.prototype);return i.x=t,i.y=e,i},a.clone=function(t){return o&&a.assert(t),a.neo(t.x,t.y)},a.prototype.toString=function(){return JSON.stringify(this)},a.isValid=function(t){return t&&r.isFinite(t.x)&&r.isFinite(t.y)},a.assert=function(t){if(o&&!a.isValid(t))throw s&&n.debug(t),new Error("Invalid Vec2!")},a.prototype.clone=function(){return a.clone(this)},a.prototype.setZero=function(){return this.x=0,this.y=0,this},a.prototype.set=function(t,e){return"object"==typeof t?(o&&a.assert(t),this.x=t.x,this.y=t.y):(o&&r.assert(t),o&&r.assert(e),this.x=t,this.y=e),this},a.prototype.wSet=function(t,e,i,s){return void 0!==i||void 0!==s?this.setCombine(t,e,i,s):this.setMul(t,e)},a.prototype.setCombine=function(t,e,i,s){o&&r.assert(t),o&&a.assert(e),o&&r.assert(i),o&&a.assert(s);var n=t*e.x+i*s.x,h=t*e.y+i*s.y;return this.x=n,this.y=h,this},a.prototype.setMul=function(t,e){o&&r.assert(t),o&&a.assert(e);var i=t*e.x,s=t*e.y;return this.x=i,this.y=s,this},a.prototype.add=function(t){return o&&a.assert(t),this.x+=t.x,this.y+=t.y,this},a.prototype.wAdd=function(t,e,i,s){return void 0!==i||void 0!==s?this.addCombine(t,e,i,s):this.addMul(t,e)},a.prototype.addCombine=function(t,e,i,s){o&&r.assert(t),o&&a.assert(e),o&&r.assert(i),o&&a.assert(s);var n=t*e.x+i*s.x,h=t*e.y+i*s.y;return this.x+=n,this.y+=h,this},a.prototype.addMul=function(t,e){o&&r.assert(t),o&&a.assert(e);var i=t*e.x,s=t*e.y;return this.x+=i,this.y+=s,this},a.prototype.wSub=function(t,e,i,s){return void 0!==i||void 0!==s?this.subCombine(t,e,i,s):this.subMul(t,e)},a.prototype.subCombine=function(t,e,i,s){o&&r.assert(t),o&&a.assert(e),o&&r.assert(i),o&&a.assert(s);var n=t*e.x+i*s.x,h=t*e.y+i*s.y;return this.x-=n,this.y-=h,this},a.prototype.subMul=function(t,e){o&&r.assert(t),o&&a.assert(e);var i=t*e.x,s=t*e.y;return this.x-=i,this.y-=s,this},a.prototype.sub=function(t){return o&&a.assert(t),this.x-=t.x,this.y-=t.y,this},a.prototype.mul=function(t){return o&&r.assert(t),this.x*=t,this.y*=t,this},a.prototype.length=function(){return a.lengthOf(this)},a.prototype.lengthSquared=function(){return a.lengthSquared(this)},a.prototype.normalize=function(){var t=this.length();if(t<r.EPSILON)return 0;var e=1/t;return this.x*=e,this.y*=e,t},a.lengthOf=function(t){return o&&a.assert(t),r.sqrt(t.x*t.x+t.y*t.y)},a.lengthSquared=function(t){return o&&a.assert(t),t.x*t.x+t.y*t.y},a.distance=function(t,e){o&&a.assert(t),o&&a.assert(e);var i=t.x-e.x,s=t.y-e.y;return r.sqrt(i*i+s*s)},a.distanceSquared=function(t,e){o&&a.assert(t),o&&a.assert(e);var i=t.x-e.x,s=t.y-e.y;return i*i+s*s},a.areEqual=function(t,e){return o&&a.assert(t),o&&a.assert(e),t==e||"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y},a.skew=function(t){return o&&a.assert(t),a.neo(-t.y,t.x)},a.dot=function(t,e){return o&&a.assert(t),o&&a.assert(e),t.x*e.x+t.y*e.y},a.cross=function(t,e){return"number"==typeof e?(o&&a.assert(t),o&&r.assert(e),a.neo(e*t.y,-e*t.x)):"number"==typeof t?(o&&r.assert(t),o&&a.assert(e),a.neo(-t*e.y,t*e.x)):(o&&a.assert(t),o&&a.assert(e),t.x*e.y-t.y*e.x)},a.addCross=function(t,e,i){return"number"==typeof i?(o&&a.assert(e),o&&r.assert(i),a.neo(i*e.y+t.x,-i*e.x+t.y)):"number"==typeof e?(o&&r.assert(e),o&&a.assert(i),a.neo(-e*i.y+t.x,e*i.x+t.y)):void(o&&n.assert(!1))},a.add=function(t,e){return o&&a.assert(t),o&&a.assert(e),a.neo(t.x+e.x,t.y+e.y)},a.wAdd=function(t,e,i,s){return void 0!==i||void 0!==s?a.combine(t,e,i,s):a.mul(t,e)},a.combine=function(t,e,i,s){return a.zero().setCombine(t,e,i,s)},a.sub=function(t,e){return o&&a.assert(t),o&&a.assert(e),a.neo(t.x-e.x,t.y-e.y)},a.mul=function(t,e){return"object"==typeof t?(o&&a.assert(t),o&&r.assert(e),a.neo(t.x*e,t.y*e)):"object"==typeof e?(o&&r.assert(t),o&&a.assert(e),a.neo(t*e.x,t*e.y)):void 0},a.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},a.neg=function(t){return o&&a.assert(t),a.neo(-t.x,-t.y)},a.abs=function(t){return o&&a.assert(t),a.neo(r.abs(t.x),r.abs(t.y))},a.mid=function(t,e){return o&&a.assert(t),o&&a.assert(e),a.neo(.5*(t.x+e.x),.5*(t.y+e.y))},a.upper=function(t,e){return o&&a.assert(t),o&&a.assert(e),a.neo(r.max(t.x,e.x),r.max(t.y,e.y))},a.lower=function(t,e){return o&&a.assert(t),o&&a.assert(e),a.neo(r.min(t.x,e.x),r.min(t.y,e.y))},a.prototype.clamp=function(t){var e=this.x*this.x+this.y*this.y;if(e>t*t){var i=r.invSqrt(e);this.x*=i*t,this.y*=i*t}return this},a.clamp=function(t,e){return(t=a.neo(t.x,t.y)).clamp(e),t},a.scaleFn=function(t,e){return function(i){return a.neo(i.x*t,i.y*e)}},a.translateFn=function(t,e){return function(i){return a.neo(i.x+t,i.y+e)}}},function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT,n=i(2),r=i(6),a=Math,h=t.exports=r(a);h.EPSILON=1e-9,h.isFinite=function(t){return"number"==typeof t&&isFinite(t)&&!isNaN(t)},h.assert=function(t){if(o&&!h.isFinite(t))throw s&&n.debug(t),new Error("Invalid Number!")},h.invSqrt=function(t){return 1/a.sqrt(t)},h.nextPowerOfTwo=function(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},h.isPowerOfTwo=function(t){return t>0&&0==(t&t-1)},h.mod=function(t,e,i){return void 0===e?(i=1,e=0):void 0===i&&(i=e,e=0),i>e?(t=(t-e)%(i-e))+(t<0?i:e):(t=(t-i)%(e-i))+(t<=0?e:i)},h.clamp=function(t,e,i){return t<e?e:t>i?i:t},h.random=function(t,e){return void 0===t?(e=1,t=0):void 0===e&&(e=t,t=0),t==e?t:a.random()*(e-t)+t}},function(t,e){var i="undefined"!=typeof DEBUG&&DEBUG,s="undefined"!=typeof ASSERT&&ASSERT;e.debug=function(){i&&console.log.apply(console,arguments)},e.assert=function(t,e,i){if(s&&!t)throw i&&console.log(i),new Error(e)}},function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=h;var n=i(2),r=i(0),a=i(1);function h(t){if(!(this instanceof h))return new h(t);"number"==typeof t?this.setAngle(t):"object"==typeof t?this.set(t):this.setIdentity()}h.neo=function(t){var e=Object.create(h.prototype);return e.setAngle(t),e},h.clone=function(t){o&&h.assert(t);var e=Object.create(h.prototype);return e.s=t.s,e.c=t.c,e},h.identity=function(){var t=Object.create(h.prototype);return t.s=0,t.c=1,t},h.isValid=function(t){return t&&a.isFinite(t.s)&&a.isFinite(t.c)},h.assert=function(t){if(o&&!h.isValid(t))throw s&&n.debug(t),new Error("Invalid Rot!")},h.prototype.setIdentity=function(){this.s=0,this.c=1},h.prototype.set=function(t){"object"==typeof t?(o&&h.assert(t),this.s=t.s,this.c=t.c):(o&&a.assert(t),this.s=a.sin(t),this.c=a.cos(t))},h.prototype.setAngle=function(t){o&&a.assert(t),this.s=a.sin(t),this.c=a.cos(t)},h.prototype.getAngle=function(){return a.atan2(this.s,this.c)},h.prototype.getXAxis=function(){return r.neo(this.c,this.s)},h.prototype.getYAxis=function(){return r.neo(-this.s,this.c)},h.mul=function(t,e){if(o&&h.assert(t),"c"in e&&"s"in e){o&&h.assert(e);var i=h.identity();return i.s=t.s*e.c+t.c*e.s,i.c=t.c*e.c-t.s*e.s,i}if("x"in e&&"y"in e)return o&&r.assert(e),r.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},h.mulRot=function(t,e){o&&h.assert(t),o&&h.assert(e);var i=h.identity();return i.s=t.s*e.c+t.c*e.s,i.c=t.c*e.c-t.s*e.s,i},h.mulVec2=function(t,e){return o&&h.assert(t),o&&r.assert(e),r.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},h.mulSub=function(t,e,i){var s=t.c*(e.x-i.x)-t.s*(e.y-i.y),o=t.s*(e.x-i.x)+t.c*(e.y-i.y);return r.neo(s,o)},h.mulT=function(t,e){if("c"in e&&"s"in e){o&&h.assert(e);var i=h.identity();return i.s=t.c*e.s-t.s*e.c,i.c=t.c*e.c+t.s*e.s,i}if("x"in e&&"y"in e)return o&&r.assert(e),r.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},h.mulTRot=function(t,e){o&&h.assert(e);var i=h.identity();return i.s=t.c*e.s-t.s*e.c,i.c=t.c*e.c+t.s*e.s,i},h.mulTVec2=function(t,e){return o&&r.assert(e),r.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)}},function(t,e){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;var i=e;i.maxManifoldPoints=2,i.maxPolygonVertices=12,i.aabbExtension=.1,i.aabbMultiplier=2,i.linearSlop=.005,i.linearSlopSquared=i.linearSlop*i.linearSlop,i.angularSlop=2/180*Math.PI,i.polygonRadius=2*i.linearSlop,i.maxSubSteps=8,i.maxTOIContacts=32,i.maxTOIIterations=20,i.maxDistnceIterations=20,i.velocityThreshold=1,i.maxLinearCorrection=.2,i.maxAngularCorrection=8/180*Math.PI,i.maxTranslation=2,i.maxTranslationSquared=i.maxTranslation*i.maxTranslation,i.maxRotation=.5*Math.PI,i.maxRotationSquared=i.maxRotation*i.maxRotation,i.baumgarte=.2,i.toiBaugarte=.75,i.timeToSleep=.5,i.linearSleepTolerance=.01,i.linearSleepToleranceSqr=Math.pow(i.linearSleepTolerance,2),i.angularSleepTolerance=2/180*Math.PI,i.angularSleepToleranceSqr=Math.pow(i.angularSleepTolerance,2)},function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=h;var n=i(2),r=i(0),a=i(3);function h(t,e){if(!(this instanceof h))return new h(t,e);this.p=r.zero(),this.q=a.identity(),void 0!==t&&this.p.set(t),void 0!==e&&this.q.set(e)}h.clone=function(t){var e=Object.create(h.prototype);return e.p=r.clone(t.p),e.q=a.clone(t.q),e},h.neo=function(t,e){var i=Object.create(h.prototype);return i.p=r.clone(t),i.q=a.clone(e),i},h.identity=function(){var t=Object.create(h.prototype);return t.p=r.zero(),t.q=a.identity(),t},h.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},h.prototype.set=function(t,e){void 0===e?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(e))},h.isValid=function(t){return t&&r.isValid(t.p)&&a.isValid(t.q)},h.assert=function(t){if(o&&!h.isValid(t))throw s&&n.debug(t),new Error("Invalid Transform!")},h.mul=function(t,e){if(o&&h.assert(t),Array.isArray(e)){for(var i=[],s=0;s<e.length;s++)i[s]=h.mul(t,e[s]);return i}if("x"in e&&"y"in e){o&&r.assert(e);var n=t.q.c*e.x-t.q.s*e.y+t.p.x,m=t.q.s*e.x+t.q.c*e.y+t.p.y;return r.neo(n,m)}if("p"in e&&"q"in e){o&&h.assert(e);var c=h.identity();return c.q=a.mulRot(t.q,e.q),c.p=r.add(a.mulVec2(t.q,e.p),t.p),c}},h.mulAll=function(t,e){o&&h.assert(t);for(var i=[],s=0;s<e.length;s++)i[s]=h.mul(t,e[s]);return i},h.mulFn=function(t){return o&&h.assert(t),function(e){return h.mul(t,e)}},h.mulVec2=function(t,e){o&&h.assert(t),o&&r.assert(e);var i=t.q.c*e.x-t.q.s*e.y+t.p.x,s=t.q.s*e.x+t.q.c*e.y+t.p.y;return r.neo(i,s)},h.mulXf=function(t,e){o&&h.assert(t),o&&h.assert(e);var i=h.identity();return i.q=a.mulRot(t.q,e.q),i.p=r.add(a.mulVec2(t.q,e.p),t.p),i},h.mulT=function(t,e){if(o&&h.assert(t),"x"in e&&"y"in e){o&&r.assert(e);var i=e.x-t.p.x,s=e.y-t.p.y,n=t.q.c*i+t.q.s*s,m=-t.q.s*i+t.q.c*s;return r.neo(n,m)}if("p"in e&&"q"in e){o&&h.assert(e);var c=h.identity();return c.q.set(a.mulTRot(t.q,e.q)),c.p.set(a.mulTVec2(t.q,r.sub(e.p,t.p))),c}},h.mulTVec2=function(t,e){o&&h.assert(t),o&&r.assert(e);var i=e.x-t.p.x,s=e.y-t.p.y,n=t.q.c*i+t.q.s*s,a=-t.q.s*i+t.q.c*s;return r.neo(n,a)},h.mulTXf=function(t,e){o&&h.assert(t),o&&h.assert(e);var i=h.identity();return i.q.set(a.mulTRot(t.q,e.q)),i.p.set(a.mulTVec2(t.q,r.sub(e.p,t.p))),i}},function(t,e){if("function"==typeof Object.create)t.exports=function(t,e){return Object.create.call(Object,t,e)};else{function i(){}t.exports=function(t,e){if(e)throw Error("Second argument is not supported!");if("object"!=typeof t||null===t)throw Error("Invalid prototype!");return i.prototype=t,new i}}},function(t,e){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,Object.prototype.propertyIsEnumerable;t.exports=function(t,e){for(var i in null==t&&(t={}),e)e.hasOwnProperty(i)&&void 0===t[i]&&(t[i]=e[i]);if("function"==typeof Object.getOwnPropertySymbols)for(var s=Object.getOwnPropertySymbols(e),o=0;o<s.length;o++){var n=s[o];e.propertyIsEnumerable(n)&&void 0===t[i]&&(t[n]=e[n])}return t}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=m;var o=i(2),n=i(1),r=i(0),a=i(3),h=i(5);function m(t,e){s&&o.assert(void 0===t),s&&o.assert(void 0===e),this.localCenter=r.zero(),this.c=r.zero(),this.a=0,this.alpha0=0,this.c0=r.zero(),this.a0=0}m.prototype.setTransform=function(t){var e=h.mulVec2(t,this.localCenter);this.c.set(e),this.c0.set(e),this.a=t.q.getAngle(),this.a0=t.q.getAngle()},m.prototype.setLocalCenter=function(t,e){this.localCenter.set(t);var i=h.mulVec2(e,this.localCenter);this.c.set(i),this.c0.set(i)},m.prototype.getTransform=function(t,e){e=void 0===e?0:e,t.q.setAngle((1-e)*this.a0+e*this.a),t.p.setCombine(1-e,this.c0,e,this.c),t.p.sub(a.mulVec2(t.q,this.localCenter))},m.prototype.advance=function(t){s&&o.assert(this.alpha0<1);var e=(t-this.alpha0)/(1-this.alpha0);this.c0.setCombine(e,this.c,1-e,this.c0),this.a0=e*this.a+(1-e)*this.a0,this.alpha0=t},m.prototype.forward=function(){this.a0=this.a,this.c0.set(this.c)},m.prototype.normalize=function(){var t=n.mod(this.a0,-n.PI,+n.PI);this.a-=this.a0-t,this.a0=t},m.prototype.clone=function(){var t=new m;return t.localCenter.set(this.localCenter),t.alpha0=this.alpha0,t.a0=this.a0,t.a=this.a,t.c0.set(this.c0),t.c.set(this.c),t},m.prototype.set=function(t){this.localCenter.set(t.localCenter),this.alpha0=t.alpha0,this.a0=t.a0,this.a=t.a,this.c0.set(t.c0),this.c.set(t.c)}},function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=a;var n=i(2),r=(i(1),i(0));function a(t,e,i,s){"object"==typeof t&&null!==t?(this.ex=r.clone(t),this.ey=r.clone(e)):"number"==typeof t?(this.ex=r.neo(t,i),this.ey=r.neo(e,s)):(this.ex=r.zero(),this.ey=r.zero())}a.prototype.toString=function(){return JSON.stringify(this)},a.isValid=function(t){return t&&r.isValid(t.ex)&&r.isValid(t.ey)},a.assert=function(t){if(o&&!a.isValid(t))throw s&&n.debug(t),new Error("Invalid Mat22!")},a.prototype.set=function(t,e,i,s){"number"==typeof t&&"number"==typeof e&&"number"==typeof i&&"number"==typeof s?(this.ex.set(t,i),this.ey.set(e,s)):"object"==typeof t&&"object"==typeof e?(this.ex.set(t),this.ey.set(e)):"object"==typeof t?(o&&a.assert(t),this.ex.set(t.ex),this.ey.set(t.ey)):o&&n.assert(!1)},a.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},a.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},a.prototype.getInverse=function(){var t=this.ex.x,e=this.ey.x,i=this.ex.y,s=this.ey.y,o=t*s-e*i;0!=o&&(o=1/o);var n=new a;return n.ex.x=o*s,n.ey.x=-o*e,n.ex.y=-o*i,n.ey.y=o*t,n},a.prototype.solve=function(t){o&&r.assert(t);var e=this.ex.x,i=this.ey.x,s=this.ex.y,n=this.ey.y,a=e*n-i*s;0!=a&&(a=1/a);var h=r.zero();return h.x=a*(n*t.x-i*t.y),h.y=a*(e*t.y-s*t.x),h},a.mul=function(t,e){if(e&&"x"in e&&"y"in e){o&&r.assert(e);var i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return r.neo(i,s)}if(e&&"ex"in e&&"ey"in e)return o&&a.assert(e),new a(t.ex.x*e.ex.x+t.ey.x*e.ex.y,t.ex.x*e.ey.x+t.ey.x*e.ey.y,t.ex.y*e.ex.x+t.ey.y*e.ex.y,t.ex.y*e.ey.x+t.ey.y*e.ey.y);o&&n.assert(!1)},a.mulVec2=function(t,e){o&&r.assert(e);var i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return r.neo(i,s)},a.mulMat22=function(t,e){return o&&a.assert(e),new a(t.ex.x*e.ex.x+t.ey.x*e.ex.y,t.ex.x*e.ey.x+t.ey.x*e.ey.y,t.ex.y*e.ex.x+t.ey.y*e.ex.y,t.ex.y*e.ey.x+t.ey.y*e.ey.y)},a.mulT=function(t,e){return e&&"x"in e&&"y"in e?(o&&r.assert(e),r.neo(r.dot(e,t.ex),r.dot(e,t.ey))):e&&"ex"in e&&"ey"in e?(o&&a.assert(e),new a(r.neo(r.dot(t.ex,e.ex),r.dot(t.ey,e.ex)),r.neo(r.dot(t.ex,e.ey),r.dot(t.ey,e.ey)))):void(o&&n.assert(!1))},a.mulTVec2=function(t,e){return o&&a.assert(t),o&&r.assert(e),r.neo(r.dot(e,t.ex),r.dot(e,t.ey))},a.mulTMat22=function(t,e){return o&&a.assert(t),o&&a.assert(e),new a(r.neo(r.dot(t.ex,e.ex),r.dot(t.ey,e.ex)),r.neo(r.dot(t.ex,e.ey),r.dot(t.ey,e.ey)))},a.abs=function(t){return o&&a.assert(t),new a(r.abs(t.ex),r.abs(t.ey))},a.add=function(t,e){return o&&a.assert(t),o&&a.assert(e),new a(r.add(t.ex,e.ex),r.add(t.ey,e.ey))}},function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=a;var n=i(2),r=i(1);function a(t,e,i){if(!(this instanceof a))return new a(t,e,i);void 0===t?(this.x=0,this.y=0,this.z=0):"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=i),o&&a.assert(this)}a.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}},a._deserialize=function(t){var e=Object.create(a.prototype);return e.x=t.x,e.y=t.y,e.z=t.z,e},a.neo=function(t,e,i){var s=Object.create(a.prototype);return s.x=t,s.y=e,s.z=i,s},a.clone=function(t){return o&&a.assert(t),a.neo(t.x,t.y,t.z)},a.prototype.toString=function(){return JSON.stringify(this)},a.isValid=function(t){return t&&r.isFinite(t.x)&&r.isFinite(t.y)&&r.isFinite(t.z)},a.assert=function(t){if(o&&!a.isValid(t))throw s&&n.debug(t),new Error("Invalid Vec3!")},a.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},a.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},a.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},a.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},a.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},a.areEqual=function(t,e){return o&&a.assert(t),o&&a.assert(e),t==e||"object"==typeof t&&null!==t&&"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y&&t.z===e.z},a.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},a.cross=function(t,e){return new a(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},a.add=function(t,e){return new a(t.x+e.x,t.y+e.y,t.z+e.z)},a.sub=function(t,e){return new a(t.x-e.x,t.y-e.y,t.z-e.z)},a.mul=function(t,e){return new a(e*t.x,e*t.y,e*t.z)},a.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},a.neg=function(t){return new a(-t.x,-t.y,-t.z)}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=r;var o=i(2);function n(){this.other=null,this.joint=null,this.prev=null,this.next=null}function r(t,e,i){e=t.bodyA||e,i=t.bodyB||i,s&&o.assert(e),s&&o.assert(i),s&&o.assert(e!=i),this.m_type="unknown-joint",this.m_bodyA=e,this.m_bodyB=i,this.m_index=0,this.m_collideConnected=!!t.collideConnected,this.m_prev=null,this.m_next=null,this.m_edgeA=new n,this.m_edgeB=new n,this.m_islandFlag=!1,this.m_userData=t.userData}r.TYPES={},r._deserialize=function(t,e,i){var s=r.TYPES[t.type];return s&&i(s,t)},r.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},r.prototype.getType=function(){return this.m_type},r.prototype.getBodyA=function(){return this.m_bodyA},r.prototype.getBodyB=function(){return this.m_bodyB},r.prototype.getNext=function(){return this.m_next},r.prototype.getUserData=function(){return this.m_userData},r.prototype.setUserData=function(t){this.m_userData=t},r.prototype.getCollideConnected=function(){return this.m_collideConnected},r.prototype.getAnchorA=function(){},r.prototype.getAnchorB=function(){},r.prototype.getReactionForce=function(t){},r.prototype.getReactionTorque=function(t){},r.prototype.shiftOrigin=function(t){},r.prototype.initVelocityConstraints=function(t){},r.prototype.solveVelocityConstraints=function(t){},r.prototype.solvePositionConstraints=function(t){}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=function(){this.v=s.zero(),this.w=0};var s=i(0)},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=n;var s=i(0),o=i(3);function n(){this.c=s.zero(),this.a=0}n.prototype.getTransform=function(t,e){return t.q.set(this.a),t.p.set(s.sub(this.c,o.mulVec2(t.q,e))),t}},function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=h;var n=i(2),r=(i(1),i(0)),a=i(10);function h(t,e,i){"object"==typeof t&&null!==t?(this.ex=a.clone(t),this.ey=a.clone(e),this.ez=a.clone(i)):(this.ex=a(),this.ey=a(),this.ez=a())}h.prototype.toString=function(){return JSON.stringify(this)},h.isValid=function(t){return t&&a.isValid(t.ex)&&a.isValid(t.ey)&&a.isValid(t.ez)},h.assert=function(t){if(o&&!h.isValid(t))throw s&&n.debug(t),new Error("Invalid Mat33!")},h.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},h.prototype.solve33=function(t){var e=a.dot(this.ex,a.cross(this.ey,this.ez));0!=e&&(e=1/e);var i=new a;return i.x=e*a.dot(t,a.cross(this.ey,this.ez)),i.y=e*a.dot(this.ex,a.cross(t,this.ez)),i.z=e*a.dot(this.ex,a.cross(this.ey,t)),i},h.prototype.solve22=function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-i*s;0!=n&&(n=1/n);var a=r.zero();return a.x=n*(o*t.x-i*t.y),a.y=n*(e*t.y-s*t.x),a},h.prototype.getInverse22=function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-i*s;0!=n&&(n=1/n),t.ex.x=n*o,t.ey.x=-n*i,t.ex.z=0,t.ex.y=-n*s,t.ey.y=n*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},h.prototype.getSymInverse33=function(t){var e=a.dot(this.ex,a.cross(this.ey,this.ez));0!=e&&(e=1/e);var i=this.ex.x,s=this.ey.x,o=this.ez.x,n=this.ey.y,r=this.ez.y,h=this.ez.z;t.ex.x=e*(n*h-r*r),t.ex.y=e*(o*r-s*h),t.ex.z=e*(s*r-o*n),t.ey.x=t.ex.y,t.ey.y=e*(i*h-o*o),t.ey.z=e*(o*s-i*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*n-s*s)},h.mul=function(t,e){if(o&&h.assert(t),e&&"z"in e&&"y"in e&&"x"in e){o&&a.assert(e);var i=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,s=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,m=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new a(i,s,m)}if(e&&"y"in e&&"x"in e){o&&r.assert(e);i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return r.neo(i,s)}o&&n.assert(!1)},h.mulVec3=function(t,e){o&&h.assert(t),o&&a.assert(e);var i=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,s=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,n=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new a(i,s,n)},h.mulVec2=function(t,e){o&&h.assert(t),o&&r.assert(e);var i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return r.neo(i,s)},h.add=function(t,e){return o&&h.assert(t),o&&h.assert(e),new h(a.add(t.ex,e.ex),a.add(t.ey,e.ey),a.add(t.ez,e.ez))}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=s;i(1);function s(){this.m_type,this.m_radius}s.prototype._reset=function(){},s.prototype._serialize=function(){return{}},s.TYPES={},s._deserialize=function(t,e,i){var o=s.TYPES[t.type];return o&&i(o,t)},s.isValid=function(t){return!!t},s.prototype.getRadius=function(){return this.m_radius},s.prototype.getType=function(){return this.m_type},s.prototype._clone=function(){},s.prototype.getChildCount=function(){},s.prototype.testPoint=function(t,e){},s.prototype.rayCast=function(t,e,i,s){},s.prototype.computeAABB=function(t,e,i){},s.prototype.computeMass=function(t,e){},s.prototype.computeDistanceProxy=function(t){}},function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT,n=(i(4),i(2)),r=i(1),a=i(0);function h(t,e){if(!(this instanceof h))return new h(t,e);this.lowerBound=a.zero(),this.upperBound=a.zero(),"object"==typeof t&&this.lowerBound.set(t),"object"==typeof e?this.upperBound.set(e):"object"==typeof t&&this.upperBound.set(t)}t.exports=h,h.prototype.isValid=function(){return h.isValid(this)},h.isValid=function(t){var e=a.sub(t.upperBound,t.lowerBound);return e.x>=0&&e.y>=0&&a.isValid(t.lowerBound)&&a.isValid(t.upperBound)},h.assert=function(t){if(o&&!h.isValid(t))throw s&&n.debug(t),new Error("Invalid AABB!")},h.prototype.getCenter=function(){return a.neo(.5*(this.lowerBound.x+this.upperBound.x),.5*(this.lowerBound.y+this.upperBound.y))},h.prototype.getExtents=function(){return a.neo(.5*(this.upperBound.x-this.lowerBound.x),.5*(this.upperBound.y-this.lowerBound.y))},h.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},h.prototype.combine=function(t,e){e=e||this;var i=t.lowerBound,s=t.upperBound,o=e.lowerBound,n=e.upperBound,a=r.min(i.x,o.x),h=r.min(i.y,o.y),m=r.max(n.x,s.x),c=r.max(n.y,s.y);this.lowerBound.set(a,h),this.upperBound.set(m,c)},h.prototype.combinePoints=function(t,e){this.lowerBound.set(r.min(t.x,e.x),r.min(t.y,e.y)),this.upperBound.set(r.max(t.x,e.x),r.max(t.y,e.y))},h.prototype.set=function(t){this.lowerBound.set(t.lowerBound.x,t.lowerBound.y),this.upperBound.set(t.upperBound.x,t.upperBound.y)},h.prototype.contains=function(t){var e=!0;return e=(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y},h.prototype.extend=function(t){return h.extend(this,t),this},h.extend=function(t,e){t.lowerBound.x-=e,t.lowerBound.y-=e,t.upperBound.x+=e,t.upperBound.y+=e},h.testOverlap=function(t,e){var i=e.lowerBound.x-t.upperBound.x,s=t.lowerBound.x-e.upperBound.x,o=e.lowerBound.y-t.upperBound.y,n=t.lowerBound.y-e.upperBound.y;return!(i>0||o>0||s>0||n>0)},h.areEqual=function(t,e){return a.areEqual(t.lowerBound,e.lowerBound)&&a.areEqual(t.upperBound,e.upperBound)},h.diff=function(t,e){var i=r.max(0,r.min(t.upperBound.x,e.upperBound.x)-r.max(e.lowerBound.x,t.lowerBound.x)),s=r.max(0,r.min(t.upperBound.y,e.upperBound.y)-r.max(e.lowerBound.y,t.lowerBound.y));return(t.upperBound.x-t.lowerBound.x)*(t.upperBound.y-t.lowerBound.y)+(e.upperBound.x-e.lowerBound.x)*(e.upperBound.y-e.lowerBound.y)-i*s},h.prototype.rayCast=function(t,e){for(var i=-1/0,s=1/0,o=e.p1,n=a.sub(e.p2,e.p1),h=a.abs(n),m=a.zero(),c="x";null!==c;c="x"===c?"y":null)if(h.x<r.EPSILON){if(o[c]<this.lowerBound[c]||this.upperBound[c]<o[c])return!1}else{var u=1/n[c],l=(this.lowerBound[c]-o[c])*u,_=(this.upperBound[c]-o[c])*u,p=-1;if(l>_){var y=l;l=_,_=y,p=1}if(l>i&&(m.setZero(),m[c]=p,i=l),i>(s=r.min(s,_)))return!1}return!(i<0||e.maxFraction<i)&&(t.fraction=i,t.normal=m,!0)},h.prototype.toString=function(){return JSON.stringify(this)}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(2),n=i(1),r=i(0),a=i(5),h=i(9),m=i(3),c=i(4),u=i(18),l=i(23);function _(t){this.contact=t,this.prev,this.next,this.other}function p(t,e,i,s,o){this.m_nodeA=new _(this),this.m_nodeB=new _(this),this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=s,this.m_evaluateFcn=o,this.m_manifold=new u,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=f(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=d(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution),this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.v_points=[],this.v_normal=r.zero(),this.v_normalMass=new h,this.v_K=new h,this.v_pointCount,this.v_tangentSpeed,this.v_friction,this.v_restitution,this.v_invMassA,this.v_invMassB,this.v_invIA,this.v_invIB,this.p_localPoints=[],this.p_localNormal=r.zero(),this.p_localPoint=r.zero(),this.p_localCenterA=r.zero(),this.p_localCenterB=r.zero(),this.p_type,this.p_radiusA,this.p_radiusB,this.p_pointCount,this.p_invMassA,this.p_invMassB,this.p_invIA,this.p_invIB}function y(){this.rA=r.zero(),this.rB=r.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}function f(t,e){return n.sqrt(t*e)}function d(t,e){return t>e?t:e}t.exports=p,p.prototype.initConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB,n=e.getShape(),a=i.getShape(),h=e.getBody(),m=i.getBody(),c=this.getManifold(),u=c.pointCount;s&&o.assert(u>0),this.v_invMassA=h.m_invMass,this.v_invMassB=m.m_invMass,this.v_invIA=h.m_invI,this.v_invIB=m.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=u,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=h.m_invMass,this.p_invMassB=m.m_invMass,this.p_invIA=h.m_invI,this.p_invIB=m.m_invI,this.p_localCenterA=r.clone(h.m_sweep.localCenter),this.p_localCenterB=r.clone(m.m_sweep.localCenter),this.p_radiusA=n.m_radius,this.p_radiusB=a.m_radius,this.p_type=c.type,this.p_localNormal=r.clone(c.localNormal),this.p_localPoint=r.clone(c.localPoint),this.p_pointCount=u;for(var l=0;l<u;++l){var _=c.points[l],p=this.v_points[l]=new y;t.warmStarting?(p.normalImpulse=t.dtRatio*_.normalImpulse,p.tangentImpulse=t.dtRatio*_.tangentImpulse):(p.normalImpulse=0,p.tangentImpulse=0),p.rA.setZero(),p.rB.setZero(),p.normalMass=0,p.tangentMass=0,p.velocityBias=0,this.p_localPoints[l]=r.clone(_.localPoint)}},p.prototype.getManifold=function(){return this.m_manifold},p.prototype.getWorldManifold=function(t){var e=this.m_fixtureA.getBody(),i=this.m_fixtureB.getBody(),s=this.m_fixtureA.getShape(),o=this.m_fixtureB.getShape();return this.m_manifold.getWorldManifold(t,e.getTransform(),s.m_radius,i.getTransform(),o.m_radius)},p.prototype.setEnabled=function(t){this.m_enabledFlag=!!t},p.prototype.isEnabled=function(){return this.m_enabledFlag},p.prototype.isTouching=function(){return this.m_touchingFlag},p.prototype.getNext=function(){return this.m_next},p.prototype.getFixtureA=function(){return this.m_fixtureA},p.prototype.getFixtureB=function(){return this.m_fixtureB},p.prototype.getChildIndexA=function(){return this.m_indexA},p.prototype.getChildIndexB=function(){return this.m_indexB},p.prototype.flagForFiltering=function(){this.m_filterFlag=!0},p.prototype.setFriction=function(t){this.m_friction=t},p.prototype.getFriction=function(){return this.m_friction},p.prototype.resetFriction=function(){this.m_friction=f(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},p.prototype.setRestitution=function(t){this.m_restitution=t},p.prototype.getRestitution=function(){return this.m_restitution},p.prototype.resetRestitution=function(){this.m_restitution=d(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},p.prototype.setTangentSpeed=function(t){this.m_tangentSpeed=t},p.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},p.prototype.evaluate=function(t,e,i){this.m_evaluateFcn(t,e,this.m_fixtureA,this.m_indexA,i,this.m_fixtureB,this.m_indexB)},p.prototype.update=function(t){this.m_enabledFlag=!0;var e=!1,i=this.m_touchingFlag,s=this.m_fixtureA.isSensor(),o=this.m_fixtureB.isSensor(),n=s||o,r=this.m_fixtureA.getBody(),a=this.m_fixtureB.getBody(),h=r.getTransform(),m=a.getTransform();if(n){var c=this.m_fixtureA.getShape(),_=this.m_fixtureB.getShape();e=l.testOverlap(c,this.m_indexA,_,this.m_indexB,h,m),this.m_manifold.pointCount=0}else{var p=this.m_manifold;this.m_manifold=new u,this.evaluate(this.m_manifold,h,m),e=this.m_manifold.pointCount>0;for(var y=0;y<this.m_manifold.pointCount;++y){var f=this.m_manifold.points[y];f.normalImpulse=0,f.tangentImpulse=0;for(var d=0;d<p.pointCount;++d){var v=p.points[d];if(v.id.key==f.id.key){f.normalImpulse=v.normalImpulse,f.tangentImpulse=v.tangentImpulse;break}}}e!=i&&(r.setAwake(!0),a.setAwake(!0))}this.m_touchingFlag=e,0==i&&1==e&&t&&t.beginContact(this),1==i&&0==e&&t&&t.endContact(this),0==n&&e&&t&&t.preSolve(this,p)},p.prototype.solvePositionConstraint=function(t){return this._solvePositionConstraint(t,!1)},p.prototype.solvePositionConstraintTOI=function(t,e,i){return this._solvePositionConstraint(t,!0,e,i)},p.prototype._solvePositionConstraint=function(t,e,i,s){var o=this.m_fixtureA,h=this.m_fixtureB,l=o.getBody(),_=h.getBody(),p=(l.c_velocity,_.c_velocity,l.c_position),y=_.c_position,f=r.clone(this.p_localCenterA),d=r.clone(this.p_localCenterB),v=0,x=0;e&&l!=i&&l!=s||(v=this.p_invMassA,x=this.p_invIA);var g=0,b=0;e&&_!=i&&_!=s||(g=this.p_invMassB,b=this.p_invIB);for(var A=r.clone(p.c),B=p.a,w=r.clone(y.c),S=y.a,M=0,C=0;C<this.p_pointCount;++C){var I,T,P,V=a.identity(),z=a.identity();switch(V.q.set(B),z.q.set(S),V.p=r.sub(A,m.mulVec2(V.q,f)),z.p=r.sub(w,m.mulVec2(z.q,d)),this.p_type){case u.e_circles:var E=a.mulVec2(V,this.p_localPoint),F=a.mulVec2(z,this.p_localPoints[0]);(I=r.sub(F,E)).normalize(),T=r.combine(.5,E,.5,F),P=r.dot(r.sub(F,E),I)-this.p_radiusA-this.p_radiusB;break;case u.e_faceA:I=m.mulVec2(V.q,this.p_localNormal);var L=a.mulVec2(V,this.p_localPoint),k=a.mulVec2(z,this.p_localPoints[C]);P=r.dot(r.sub(k,L),I)-this.p_radiusA-this.p_radiusB,T=k;break;case u.e_faceB:I=m.mulVec2(z.q,this.p_localNormal);L=a.mulVec2(z,this.p_localPoint),k=a.mulVec2(V,this.p_localPoints[C]);P=r.dot(r.sub(k,L),I)-this.p_radiusA-this.p_radiusB,T=k,I.mul(-1)}var D=r.sub(T,A),q=r.sub(T,w);M=n.min(M,P);var R=e?c.toiBaugarte:c.baumgarte,j=c.linearSlop,O=c.maxLinearCorrection,N=n.clamp(R*(P+j),-O,0),U=r.cross(D,I),G=r.cross(q,I),Y=v+g+x*U*U+b*G*G,J=Y>0?-N/Y:0,W=r.mul(J,I);A.subMul(v,W),B-=x*r.cross(D,W),w.addMul(g,W),S+=b*r.cross(q,W)}return p.c.set(A),p.a=B,y.c.set(w),y.a=S,M},p.prototype.initVelocityConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB,n=e.getBody(),h=i.getBody(),u=n.c_velocity,l=h.c_velocity,_=n.c_position,p=h.c_position,y=this.p_radiusA,f=this.p_radiusB,d=this.getManifold(),v=this.v_invMassA,x=this.v_invMassB,g=this.v_invIA,b=this.v_invIB,A=r.clone(this.p_localCenterA),B=r.clone(this.p_localCenterB),w=r.clone(_.c),S=_.a,M=r.clone(u.v),C=u.w,I=r.clone(p.c),T=p.a,P=r.clone(l.v),V=l.w;s&&o.assert(d.pointCount>0);var z=a.identity(),E=a.identity();z.q.set(S),E.q.set(T),z.p.setCombine(1,w,-1,m.mulVec2(z.q,A)),E.p.setCombine(1,I,-1,m.mulVec2(E.q,B));var F=d.getWorldManifold(null,z,y,E,f);this.v_normal.set(F.normal);for(var L=0;L<this.v_pointCount;++L){var k=this.v_points[L];k.rA.set(r.sub(F.points[L],w)),k.rB.set(r.sub(F.points[L],I));var D=r.cross(k.rA,this.v_normal),q=r.cross(k.rB,this.v_normal),R=v+x+g*D*D+b*q*q;k.normalMass=R>0?1/R:0;var j=r.cross(this.v_normal,1),O=r.cross(k.rA,j),N=r.cross(k.rB,j),U=v+x+g*O*O+b*N*N;k.tangentMass=U>0?1/U:0,k.velocityBias=0;var G=r.dot(this.v_normal,P)+r.dot(this.v_normal,r.cross(V,k.rB))-r.dot(this.v_normal,M)-r.dot(this.v_normal,r.cross(C,k.rA));G<-c.velocityThreshold&&(k.velocityBias=-this.v_restitution*G)}if(2==this.v_pointCount&&t.blockSolve){var Y=this.v_points[0],J=this.v_points[1],W=r.cross(Y.rA,this.v_normal),H=r.cross(Y.rB,this.v_normal),Z=r.cross(J.rA,this.v_normal),X=r.cross(J.rB,this.v_normal),K=v+x+g*W*W+b*H*H,Q=v+x+g*Z*Z+b*X*X,$=v+x+g*W*Z+b*H*X;K*K<1e3*(K*Q-$*$)?(this.v_K.ex.set(K,$),this.v_K.ey.set($,Q),this.v_normalMass.set(this.v_K.getInverse())):this.v_pointCount=1}_.c.set(w),_.a=S,u.v.set(M),u.w=C,p.c.set(I),p.a=T,l.v.set(P),l.w=V},p.prototype.warmStartConstraint=function(t){for(var e=this.m_fixtureA,i=this.m_fixtureB,s=e.getBody(),o=i.getBody(),n=s.c_velocity,a=o.c_velocity,h=(s.c_position,o.c_position,this.v_invMassA),m=this.v_invIA,c=this.v_invMassB,u=this.v_invIB,l=r.clone(n.v),_=n.w,p=r.clone(a.v),y=a.w,f=this.v_normal,d=r.cross(f,1),v=0;v<this.v_pointCount;++v){var x=this.v_points[v],g=r.combine(x.normalImpulse,f,x.tangentImpulse,d);_-=m*r.cross(x.rA,g),l.subMul(h,g),y+=u*r.cross(x.rB,g),p.addMul(c,g)}n.v.set(l),n.w=_,a.v.set(p),a.w=y},p.prototype.storeConstraintImpulses=function(t){for(var e=this.m_manifold,i=0;i<this.v_pointCount;++i)e.points[i].normalImpulse=this.v_points[i].normalImpulse,e.points[i].tangentImpulse=this.v_points[i].tangentImpulse},p.prototype.solveVelocityConstraint=function(t){var e=this.m_fixtureA.m_body,i=this.m_fixtureB.m_body,a=e.c_velocity,m=(e.c_position,i.c_velocity),c=(i.c_position,this.v_invMassA),u=this.v_invIA,l=this.v_invMassB,_=this.v_invIB,p=r.clone(a.v),y=a.w,f=r.clone(m.v),d=m.w,v=this.v_normal,x=r.cross(v,1),g=this.v_friction;s&&o.assert(1==this.v_pointCount||2==this.v_pointCount);for(var b=0;b<this.v_pointCount;++b){var A=this.v_points[b];(I=r.zero()).addCombine(1,f,1,r.cross(d,A.rB)),I.subCombine(1,p,1,r.cross(y,A.rA));var B=r.dot(I,x)-this.v_tangentSpeed,w=A.tangentMass*-B,S=g*A.normalImpulse;w=(T=n.clamp(A.tangentImpulse+w,-S,S))-A.tangentImpulse,A.tangentImpulse=T;var M=r.mul(w,x);p.subMul(c,M),y-=u*r.cross(A.rA,M),f.addMul(l,M),d+=_*r.cross(A.rB,M)}if(1==this.v_pointCount||0==t.blockSolve)for(var C=0;C<this.v_pointCount;++C){var I;A=this.v_points[C];(I=r.zero()).addCombine(1,f,1,r.cross(d,A.rB)),I.subCombine(1,p,1,r.cross(y,A.rA));var T,P=r.dot(I,v);w=-A.normalMass*(P-A.velocityBias);w=(T=n.max(A.normalImpulse+w,0))-A.normalImpulse,A.normalImpulse=T;M=r.mul(w,v);p.subMul(c,M),y-=u*r.cross(A.rA,M),f.addMul(l,M),d+=_*r.cross(A.rB,M)}else{var V=this.v_points[0],z=this.v_points[1],E=r.neo(V.normalImpulse,z.normalImpulse);s&&o.assert(E.x>=0&&E.y>=0);var F=r.zero().add(f).add(r.cross(d,V.rB)).sub(p).sub(r.cross(y,V.rA)),L=r.zero().add(f).add(r.cross(d,z.rB)).sub(p).sub(r.cross(y,z.rA)),k=r.dot(F,v),D=r.dot(L,v),q=r.neo(k-V.velocityBias,D-z.velocityBias);q.sub(h.mulVec2(this.v_K,E));for(;;){var R=h.mulVec2(this.v_normalMass,q).neg();if(R.x>=0&&R.y>=0){var j=r.sub(R,E),O=r.mul(j.x,v),N=r.mul(j.y,v);p.subCombine(c,O,c,N),y-=u*(r.cross(V.rA,O)+r.cross(z.rA,N)),f.addCombine(l,O,l,N),d+=_*(r.cross(V.rB,O)+r.cross(z.rB,N)),V.normalImpulse=R.x,z.normalImpulse=R.y;break}if(R.x=-V.normalMass*q.x,R.y=0,k=0,D=this.v_K.ex.y*R.x+q.y,R.x>=0&&D>=0){j=r.sub(R,E),O=r.mul(j.x,v),N=r.mul(j.y,v);p.subCombine(c,O,c,N),y-=u*(r.cross(V.rA,O)+r.cross(z.rA,N)),f.addCombine(l,O,l,N),d+=_*(r.cross(V.rB,O)+r.cross(z.rB,N)),V.normalImpulse=R.x,z.normalImpulse=R.y;break}if(R.x=0,R.y=-z.normalMass*q.y,k=this.v_K.ey.x*R.y+q.x,D=0,R.y>=0&&k>=0){j=r.sub(R,E),O=r.mul(j.x,v),N=r.mul(j.y,v);p.subCombine(c,O,c,N),y-=u*(r.cross(V.rA,O)+r.cross(z.rA,N)),f.addCombine(l,O,l,N),d+=_*(r.cross(V.rB,O)+r.cross(z.rB,N)),V.normalImpulse=R.x,z.normalImpulse=R.y;break}if(R.x=0,R.y=0,k=q.x,D=q.y,k>=0&&D>=0){j=r.sub(R,E),O=r.mul(j.x,v),N=r.mul(j.y,v);p.subCombine(c,O,c,N),y-=u*(r.cross(V.rA,O)+r.cross(z.rA,N)),f.addCombine(l,O,l,N),d+=_*(r.cross(V.rB,O)+r.cross(z.rB,N)),V.normalImpulse=R.x,z.normalImpulse=R.y;break}break}}a.v.set(p),a.w=y,m.v.set(f),m.w=d};var v=[];p.addType=function(t,e,i){v[t]=v[t]||{},v[t][e]=i},p.create=function(t,e,i,s){var o,n,r=t.getType(),a=i.getType();if(n=v[r]&&v[r][a])o=new p(t,e,i,s,n);else{if(!(n=v[a]&&v[a][r]))return null;o=new p(i,s,t,e,n)}t=o.getFixtureA(),i=o.getFixtureB(),e=o.getChildIndexA(),s=o.getChildIndexB();var h=t.getBody(),m=i.getBody();return o.m_nodeA.contact=o,o.m_nodeA.other=m,o.m_nodeA.prev=null,o.m_nodeA.next=h.m_contactList,null!=h.m_contactList&&(h.m_contactList.prev=o.m_nodeA),h.m_contactList=o.m_nodeA,o.m_nodeB.contact=o,o.m_nodeB.other=h,o.m_nodeB.prev=null,o.m_nodeB.next=m.m_contactList,null!=m.m_contactList&&(m.m_contactList.prev=o.m_nodeB),m.m_contactList=o.m_nodeB,0==t.isSensor()&&0==i.isSensor()&&(h.setAwake(!0),m.setAwake(!0)),o},p.destroy=function(t,e){var i=t.m_fixtureA,s=t.m_fixtureB,o=i.getBody(),n=s.getBody();t.isTouching()&&e.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==o.m_contactList&&(o.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&0==i.isSensor()&&0==s.isSensor()&&(o.setAwake(!0),n.setAwake(!0));var r=i.getType(),a=s.getType(),h=v[r][a].destroyFcn;"function"==typeof h&&h(t)}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,i(2);var s=i(0),o=i(5),n=i(1),r=i(3);function a(){this.type,this.localNormal=s.zero(),this.localPoint=s.zero(),this.points=[new h,new h],this.pointCount=0}function h(){this.localPoint=s.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.id=new m}function m(){this.cf=new c}function c(){this.indexA,this.indexB,this.typeA,this.typeB}function u(){this.normal,this.points=[],this.separations=[]}t.exports=a,t.exports.clipSegmentToLine=function(t,e,i,o,n){var r=0,h=s.dot(i,e[0].v)-o,m=s.dot(i,e[1].v)-o;h<=0&&t[r++].set(e[0]);m<=0&&t[r++].set(e[1]);if(h*m<0){var c=h/(h-m);t[r].v.setCombine(1-c,e[0].v,c,e[1].v),t[r].id.cf.indexA=n,t[r].id.cf.indexB=e[0].id.cf.indexB,t[r].id.cf.typeA=a.e_vertex,t[r].id.cf.typeB=a.e_face,++r}return r},t.exports.clipVertex=_,t.exports.getPointStates=function(t,e,i,s){for(var o=0;o<i.pointCount;++o){var n=i.points[o].id;t[o]=l.removeState;for(var r=0;r<s.pointCount;++r)if(s.points[r].id.key==n.key){t[o]=l.persistState;break}}for(o=0;o<s.pointCount;++o){n=s.points[o].id;e[o]=l.addState;for(r=0;r<i.pointCount;++r)if(i.points[r].id.key==n.key){e[o]=l.persistState;break}}},t.exports.PointState=l,a.e_circles=0,a.e_faceA=1,a.e_faceB=2,a.e_vertex=0,a.e_face=1,Object.defineProperty(m.prototype,"key",{get:function(){return this.cf.indexA+4*this.cf.indexB+16*this.cf.typeA+64*this.cf.typeB},enumerable:!0,configurable:!0}),m.prototype.set=function(t){this.cf.set(t.cf)},c.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB},a.prototype.getWorldManifold=function(t,e,i,h,m){if(0!=this.pointCount){var c=(t=t||new u).normal,l=t.points,_=t.separations;switch(this.type){case a.e_circles:c=s.neo(1,0);var p=o.mulVec2(e,this.localPoint),y=o.mulVec2(h,this.points[0].localPoint),f=s.sub(y,p);s.lengthSquared(f)>n.EPSILON*n.EPSILON&&(c.set(f),c.normalize());var d=p.clone().addMul(i,c),v=y.clone().addMul(-m,c);l[0]=s.mid(d,v),_[0]=s.dot(s.sub(v,d),c),l.length=1,_.length=1;break;case a.e_faceA:c=r.mulVec2(e.q,this.localNormal);for(var x=o.mulVec2(e,this.localPoint),g=0;g<this.pointCount;++g){var b=o.mulVec2(h,this.points[g].localPoint);d=s.clone(b).addMul(i-s.dot(s.sub(b,x),c),c),v=s.clone(b).subMul(m,c);l[g]=s.mid(d,v),_[g]=s.dot(s.sub(v,d),c)}l.length=this.pointCount,_.length=this.pointCount;break;case a.e_faceB:c=r.mulVec2(h.q,this.localNormal);for(x=o.mulVec2(h,this.localPoint),g=0;g<this.pointCount;++g){b=o.mulVec2(e,this.points[g].localPoint),v=s.combine(1,b,m-s.dot(s.sub(b,x),c),c),d=s.combine(1,b,-i,c);l[g]=s.mid(d,v),_[g]=s.dot(s.sub(d,v),c)}l.length=this.pointCount,_.length=this.pointCount,c.mul(-1)}return t.normal=c,t.points=l,t.separations=_,t}};var l={nullState:0,addState:1,persistState:2,removeState:3};function _(){this.v=s.zero(),this.id=new m}_.prototype.set=function(t){this.v.set(t.v),this.id.set(t.id)}},function(t,e){t.exports=require("phaser")},function(t,e,i){e.internal={},e.Serializer=i(40),e.Math=i(1),e.Vec2=i(0),e.Vec3=i(10),e.Mat22=i(9),e.Mat33=i(14),e.Transform=i(5),e.Rot=i(3),e.AABB=i(16),e.Shape=i(15),e.Fixture=i(33),e.Body=i(21),e.Contact=i(17),e.Joint=i(11),e.World=i(31),e.Circle=i(24),e.Edge=i(25),e.Polygon=i(22),e.Chain=i(28),e.Box=i(45),i(46),i(47),e.internal.CollidePolygons=i(48),i(49),i(50),e.DistanceJoint=i(51),e.FrictionJoint=i(52),e.GearJoint=i(53),e.MotorJoint=i(54),e.MouseJoint=i(55),e.PrismaticJoint=i(36),e.PulleyJoint=i(56),e.RevoluteJoint=i(35),e.RopeJoint=i(57),e.WeldJoint=i(58),e.WheelJoint=i(59),e.internal.Sweep=i(8),e.internal.stats=i(27),e.internal.Manifold=i(18),e.internal.Distance=i(23),e.internal.TimeOfImpact=i(34),e.internal.DynamicTree=i(32),e.internal.Settings=i(4)},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=v;var o=i(2),n=i(7),r=i(0),a=i(3),h=i(1),m=i(8),c=i(5),u=i(12),l=i(13),_=i(33),p=(i(15),v.STATIC="static"),y=v.KINEMATIC="kinematic",f=v.DYNAMIC="dynamic",d={type:p,position:r.zero(),angle:0,linearVelocity:r.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null};function v(t,e){e=n(e,d),s&&o.assert(r.isValid(e.position)),s&&o.assert(r.isValid(e.linearVelocity)),s&&o.assert(h.isFinite(e.angle)),s&&o.assert(h.isFinite(e.angularVelocity)),s&&o.assert(h.isFinite(e.angularDamping)&&e.angularDamping>=0),s&&o.assert(h.isFinite(e.linearDamping)&&e.linearDamping>=0),this.m_world=t,this.m_awakeFlag=e.awake,this.m_autoSleepFlag=e.allowSleep,this.m_bulletFlag=e.bullet,this.m_fixedRotationFlag=e.fixedRotation,this.m_activeFlag=e.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=e.userData,this.m_type=e.type,this.m_type==f?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=c.identity(),this.m_xf.p=r.clone(e.position),this.m_xf.q.setAngle(e.angle),this.m_sweep=new m,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new u,this.c_position=new l,this.m_force=r.zero(),this.m_torque=0,this.m_linearVelocity=r.clone(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1}function x(){this.mass=0,this.center=r.zero(),this.I=0}v.prototype._serialize=function(){for(var t=[],e=this.m_fixtureList;e;e=e.m_next)t.push(e);return{type:this.m_type,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:t}},v._deserialize=function(t,e,i){var s=new v(e,t);return t.fixtures.forEach((function(t){var e=i(_,t,s);s._addFixture(e)})),s},v.prototype.isWorldLocked=function(){return!(!this.m_world||!this.m_world.isLocked())},v.prototype.getWorld=function(){return this.m_world},v.prototype.getNext=function(){return this.m_next},v.prototype.setUserData=function(t){this.m_userData=t},v.prototype.getUserData=function(){return this.m_userData},v.prototype.getFixtureList=function(){return this.m_fixtureList},v.prototype.getJointList=function(){return this.m_jointList},v.prototype.getContactList=function(){return this.m_contactList},v.prototype.isStatic=function(){return this.m_type==p},v.prototype.isDynamic=function(){return this.m_type==f},v.prototype.isKinematic=function(){return this.m_type==y},v.prototype.setStatic=function(){return this.setType(p),this},v.prototype.setDynamic=function(){return this.setType(f),this},v.prototype.setKinematic=function(){return this.setType(y),this},v.prototype.getType=function(){return this.m_type},v.prototype.setType=function(t){if(s&&o.assert(t===p||t===y||t===f),s&&o.assert(0==this.isWorldLocked()),1!=this.isWorldLocked()&&this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==p&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e;e=e.next,this.m_world.destroyContact(i.contact)}this.m_contactList=null;for(var n=this.m_world.m_broadPhase,r=this.m_fixtureList;r;r=r.m_next)for(var a=r.m_proxyCount,h=0;h<a;++h)n.touchProxy(r.m_proxies[h].proxyId)}},v.prototype.isBullet=function(){return this.m_bulletFlag},v.prototype.setBullet=function(t){this.m_bulletFlag=!!t},v.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},v.prototype.setSleepingAllowed=function(t){this.m_autoSleepFlag=!!t,0==this.m_autoSleepFlag&&this.setAwake(!0)},v.prototype.isAwake=function(){return this.m_awakeFlag},v.prototype.setAwake=function(t){t?0==this.m_awakeFlag&&(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},v.prototype.isActive=function(){return this.m_activeFlag},v.prototype.setActive=function(t){if(s&&o.assert(0==this.isWorldLocked()),t!=this.m_activeFlag)if(this.m_activeFlag=!!t,this.m_activeFlag)for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.createProxies(e,this.m_xf);else{for(e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.destroyProxies(e);for(var n=this.m_contactList;n;){var r=n;n=n.next,this.m_world.destroyContact(r.contact)}this.m_contactList=null}},v.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},v.prototype.setFixedRotation=function(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())},v.prototype.getTransform=function(){return this.m_xf},v.prototype.setTransform=function(t,e){if(s&&o.assert(0==this.isWorldLocked()),1!=this.isWorldLocked()){this.m_xf.set(t,e),this.m_sweep.setTransform(this.m_xf);for(var i=this.m_world.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)n.synchronize(i,this.m_xf,this.m_xf)}},v.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},v.prototype.synchronizeFixtures=function(){var t=c.identity();this.m_sweep.getTransform(t,0);for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.synchronize(e,t,this.m_xf)},v.prototype.advance=function(t){this.m_sweep.advance(t),this.m_sweep.c.set(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},v.prototype.getPosition=function(){return this.m_xf.p},v.prototype.setPosition=function(t){this.setTransform(t,this.m_sweep.a)},v.prototype.getAngle=function(){return this.m_sweep.a},v.prototype.setAngle=function(t){this.setTransform(this.m_xf.p,t)},v.prototype.getWorldCenter=function(){return this.m_sweep.c},v.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},v.prototype.getLinearVelocity=function(){return this.m_linearVelocity},v.prototype.getLinearVelocityFromWorldPoint=function(t){var e=r.sub(t,this.m_sweep.c);return r.add(this.m_linearVelocity,r.cross(this.m_angularVelocity,e))},v.prototype.getLinearVelocityFromLocalPoint=function(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))},v.prototype.setLinearVelocity=function(t){this.m_type!=p&&(r.dot(t,t)>0&&this.setAwake(!0),this.m_linearVelocity.set(t))},v.prototype.getAngularVelocity=function(){return this.m_angularVelocity},v.prototype.setAngularVelocity=function(t){this.m_type!=p&&(t*t>0&&this.setAwake(!0),this.m_angularVelocity=t)},v.prototype.getLinearDamping=function(){return this.m_linearDamping},v.prototype.setLinearDamping=function(t){this.m_linearDamping=t},v.prototype.getAngularDamping=function(){return this.m_angularDamping},v.prototype.setAngularDamping=function(t){this.m_angularDamping=t},v.prototype.getGravityScale=function(){return this.m_gravityScale},v.prototype.setGravityScale=function(t){this.m_gravityScale=t},v.prototype.getMass=function(){return this.m_mass},v.prototype.getInertia=function(){return this.m_I+this.m_mass*r.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},v.prototype.getMassData=function(t){t.mass=this.m_mass,t.I=this.getInertia(),t.center.set(this.m_sweep.localCenter)},v.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.setZero(),this.isStatic()||this.isKinematic())return this.m_sweep.c0.set(this.m_xf.p),this.m_sweep.c.set(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);s&&o.assert(this.isDynamic());for(var t=r.zero(),e=this.m_fixtureList;e;e=e.m_next)if(0!=e.m_density){var i=new x;e.getMassData(i),this.m_mass+=i.mass,t.addMul(i.mass,i.center),this.m_I+=i.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,t.mul(this.m_invMass)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==this.m_fixedRotationFlag?(this.m_I-=this.m_mass*r.dot(t,t),s&&o.assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var n=r.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(t,this.m_xf),this.m_linearVelocity.add(r.cross(this.m_angularVelocity,r.sub(this.m_sweep.c,n)))},v.prototype.setMassData=function(t){if(s&&o.assert(0==this.isWorldLocked()),1!=this.isWorldLocked()&&this.m_type==f){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&0==this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*r.dot(t.center,t.center),s&&o.assert(this.m_I>0),this.m_invI=1/this.m_I);var e=r.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(t.center,this.m_xf),this.m_linearVelocity.add(r.cross(this.m_angularVelocity,r.sub(this.m_sweep.c,e)))}},v.prototype.applyForce=function(t,e,i){this.m_type==f&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=r.cross(r.sub(e,this.m_sweep.c),t)))},v.prototype.applyForceToCenter=function(t,e){this.m_type==f&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))},v.prototype.applyTorque=function(t,e){this.m_type==f&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},v.prototype.applyLinearImpulse=function(t,e,i){this.m_type==f&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*r.cross(r.sub(e,this.m_sweep.c),t)))},v.prototype.applyAngularImpulse=function(t,e){this.m_type==f&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},v.prototype.shouldCollide=function(t){if(this.m_type!=f&&t.m_type!=f)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&0==e.joint.m_collideConnected)return!1;return!0},v.prototype._addFixture=function(t){if(s&&o.assert(0==this.isWorldLocked()),1==this.isWorldLocked())return null;if(this.m_activeFlag){var e=this.m_world.m_broadPhase;t.createProxies(e,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,t.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,t},v.prototype.createFixture=function(t,e){if(s&&o.assert(0==this.isWorldLocked()),1==this.isWorldLocked())return null;var i=new _(this,t,e);return this._addFixture(i),i},v.prototype.destroyFixture=function(t){if(s&&o.assert(0==this.isWorldLocked()),1!=this.isWorldLocked()){s&&o.assert(t.m_body==this);var e=!1;if(this.m_fixtureList===t)this.m_fixtureList=t.m_next,e=!0;else for(var i=this.m_fixtureList;null!=i;){if(i.m_next===t){i.m_next=t.m_next,e=!0;break}i=i.m_next}s&&o.assert(e);for(var n=this.m_contactList;n;){var r=n.contact;n=n.next;var a=r.getFixtureA(),h=r.getFixtureB();t!=a&&t!=h||this.m_world.destroyContact(r)}if(this.m_activeFlag){var m=this.m_world.m_broadPhase;t.destroyProxies(m)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}},v.prototype.getWorldPoint=function(t){return c.mulVec2(this.m_xf,t)},v.prototype.getWorldVector=function(t){return a.mulVec2(this.m_xf.q,t)},v.prototype.getLocalPoint=function(t){return c.mulTVec2(this.m_xf,t)},v.prototype.getLocalVector=function(t){return a.mulTVec2(this.m_xf.q,t)}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=l;var o=i(2),n=i(6),r=(i(7),i(1)),a=i(5),h=i(3),m=i(0),c=(i(16),i(4)),u=i(15);function l(t){if(!(this instanceof l))return new l(t);l._super.call(this),this.m_type=l.TYPE,this.m_radius=c.polygonRadius,this.m_centroid=m.zero(),this.m_vertices=[],this.m_normals=[],this.m_count=0,t&&t.length&&this._set(t)}l._super=u,l.prototype=n(l._super.prototype),l.TYPE="polygon",u.TYPES[l.TYPE]=l,l.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}},l._deserialize=function(t){return new l(t.vertices)},l.prototype.getVertex=function(t){return s&&o.assert(0<=t&&t<this.m_count),this.m_vertices[t]},l.prototype._clone=function(){var t=new l;t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_count=this.m_count,t.m_centroid.set(this.m_centroid);for(var e=0;e<this.m_count;e++)t.m_vertices.push(this.m_vertices[e].clone());for(e=0;e<this.m_normals.length;e++)t.m_normals.push(this.m_normals[e].clone());return t},l.prototype.getChildCount=function(){return 1},l.prototype._reset=function(){this._set(this.m_vertices)},l.prototype._set=function(t){if(s&&o.assert(3<=t.length&&t.length<=c.maxPolygonVertices),t.length<3)this._setAsBox(1,1);else{for(var e=r.min(t.length,c.maxPolygonVertices),i=[],n=0,a=0;a<e;++a){for(var h=t[a],u=!0,l=0;l<n;++l)if(m.distanceSquared(h,i[l])<.25*c.linearSlopSquared){u=!1;break}u&&(i[n++]=h)}if((e=n)<3)return s&&o.assert(!1),void this._setAsBox(1,1);var _=0,p=i[0].x;for(a=1;a<e;++a){var y=i[a].x;(y>p||y==p&&i[a].y<i[_].y)&&(_=a,p=y)}for(var f=[],d=0,v=_;;){f[d]=v;var x=0;for(l=1;l<e;++l)if(x!=v){var g=m.sub(i[x],i[f[d]]),b=(h=m.sub(i[l],i[f[d]]),m.cross(g,h));b<0&&(x=l),0==b&&h.lengthSquared()>g.lengthSquared()&&(x=l)}else x=l;if(++d,v=x,x==_)break}if(d<3)return s&&o.assert(!1),void this._setAsBox(1,1);this.m_count=d;for(a=0;a<d;++a)this.m_vertices[a]=i[f[a]];for(a=0;a<d;++a){var A=a,B=a+1<d?a+1:0,w=m.sub(this.m_vertices[B],this.m_vertices[A]);s&&o.assert(w.lengthSquared()>r.EPSILON*r.EPSILON),this.m_normals[a]=m.cross(w,1),this.m_normals[a].normalize()}this.m_centroid=function(t,e){s&&o.assert(e>=3);for(var i=m.zero(),n=0,a=m.zero(),h=0;h<e;++h){var c=a,u=t[h],l=h+1<e?t[h+1]:t[0],_=m.sub(u,c),p=m.sub(l,c),y=.5*m.cross(_,p);n+=y,i.addMul(y*(1/3),c),i.addMul(y*(1/3),u),i.addMul(y*(1/3),l)}return s&&o.assert(n>r.EPSILON),i.mul(1/n),i}(this.m_vertices,d)}},l.prototype._setAsBox=function(t,e,i,s){if(this.m_vertices[0]=m.neo(-t,-e),this.m_vertices[1]=m.neo(t,-e),this.m_vertices[2]=m.neo(t,e),this.m_vertices[3]=m.neo(-t,e),this.m_normals[0]=m.neo(0,-1),this.m_normals[1]=m.neo(1,0),this.m_normals[2]=m.neo(0,1),this.m_normals[3]=m.neo(-1,0),this.m_count=4,m.isValid(i)){s=s||0,this.m_centroid.set(i);var o=a.identity();o.p.set(i),o.q.set(s);for(var n=0;n<this.m_count;++n)this.m_vertices[n]=a.mulVec2(o,this.m_vertices[n]),this.m_normals[n]=h.mulVec2(o.q,this.m_normals[n])}},l.prototype.testPoint=function(t,e){for(var i=h.mulTVec2(t.q,m.sub(e,t.p)),s=0;s<this.m_count;++s){if(m.dot(this.m_normals[s],m.sub(i,this.m_vertices[s]))>0)return!1}return!0},l.prototype.rayCast=function(t,e,i,n){for(var r=h.mulTVec2(i.q,m.sub(e.p1,i.p)),a=h.mulTVec2(i.q,m.sub(e.p2,i.p)),c=m.sub(a,r),u=0,l=e.maxFraction,_=-1,p=0;p<this.m_count;++p){var y=m.dot(this.m_normals[p],m.sub(this.m_vertices[p],r)),f=m.dot(this.m_normals[p],c);if(0==f){if(y<0)return!1}else f<0&&y<u*f?(u=y/f,_=p):f>0&&y<l*f&&(l=y/f);if(l<u)return!1}return s&&o.assert(0<=u&&u<=e.maxFraction),_>=0&&(t.fraction=u,t.normal=h.mulVec2(i.q,this.m_normals[_]),!0)},l.prototype.computeAABB=function(t,e,i){for(var s=1/0,o=1/0,n=-1/0,h=-1/0,m=0;m<this.m_count;++m){var c=a.mulVec2(e,this.m_vertices[m]);s=r.min(s,c.x),n=r.max(n,c.x),o=r.min(o,c.y),h=r.max(h,c.y)}t.lowerBound.set(s,o),t.upperBound.set(n,h),t.extend(this.m_radius)},l.prototype.computeMass=function(t,e){s&&o.assert(this.m_count>=3);for(var i=m.zero(),n=0,a=0,h=m.zero(),c=0;c<this.m_count;++c)h.add(this.m_vertices[c]);h.mul(1/this.m_count);for(c=0;c<this.m_count;++c){var u=m.sub(this.m_vertices[c],h),l=c+1<this.m_count?m.sub(this.m_vertices[c+1],h):m.sub(this.m_vertices[0],h),_=m.cross(u,l),p=.5*_;n+=p,i.addCombine(p*(1/3),u,p*(1/3),l);var y=u.x,f=u.y,d=l.x,v=l.y;a+=1/3*.25*_*(y*y+d*y+d*d+(f*f+v*f+v*v))}t.mass=e*n,s&&o.assert(n>r.EPSILON),i.mul(1/n),t.center.setCombine(1,i,1,h),t.I=e*a,t.I+=t.mass*(m.dot(t.center,t.center)-m.dot(i,i))},l.prototype.validate=function(){for(var t=0;t<this.m_count;++t)for(var e=t,i=t<this.m_count-1?e+1:0,s=this.m_vertices[e],o=m.sub(this.m_vertices[i],s),n=0;n<this.m_count;++n)if(n!=e&&n!=i){var r=m.sub(this.m_vertices[n],s);if(m.cross(o,r)<0)return!1}return!0},l.prototype.computeDistanceProxy=function(t){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=p,t.exports.Input=u,t.exports.Output=l,t.exports.Proxy=y,t.exports.Cache=_;var o=i(4),n=i(2),r=i(27),a=i(1),h=i(0),m=(i(10),i(9),i(14),i(3)),c=(i(8),i(5));i(12),i(13);function u(){this.proxyA=new y,this.proxyB=new y,this.transformA=null,this.transformB=null,this.useRadii=!1}function l(){this.pointA=h.zero(),this.pointB=h.zero(),this.distance,this.iterations}function _(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}function p(t,e,i){++r.gjkCalls;var s=i.proxyA,n=i.proxyB,u=i.transformA,l=i.transformB,_=new d;_.readCache(e,s,u,n,l);for(var p=_.m_v,y=o.maxDistnceIterations,f=[],v=[],x=0,g=0;g<y;){x=_.m_count;for(var b=0;b<x;++b)f[b]=p[b].indexA,v[b]=p[b].indexB;if(_.solve(),3==_.m_count)break;(I=_.getClosestPoint()).lengthSquared();var A=_.getSearchDirection();if(A.lengthSquared()<a.EPSILON*a.EPSILON)break;var B=p[_.m_count];B.indexA=s.getSupport(m.mulTVec2(u.q,h.neg(A))),B.wA=c.mulVec2(u,s.getVertex(B.indexA)),B.indexB=n.getSupport(m.mulTVec2(l.q,A)),B.wB=c.mulVec2(l,n.getVertex(B.indexB)),B.w=h.sub(B.wB,B.wA),++g,++r.gjkIters;var w=!1;for(b=0;b<x;++b)if(B.indexA==f[b]&&B.indexB==v[b]){w=!0;break}if(w)break;++_.m_count}if(r.gjkMaxIters=a.max(r.gjkMaxIters,g),_.getWitnessPoints(t.pointA,t.pointB),t.distance=h.distance(t.pointA,t.pointB),t.iterations=g,_.writeCache(e),i.useRadii){var S=s.m_radius,M=n.m_radius;if(t.distance>S+M&&t.distance>a.EPSILON){t.distance-=S+M;var C=h.sub(t.pointB,t.pointA);C.normalize(),t.pointA.addMul(S,C),t.pointB.subMul(M,C)}else{var I=h.mid(t.pointA,t.pointB);t.pointA.set(I),t.pointB.set(I),t.distance=0}}}function y(){this.m_buffer=[],this.m_vertices=[],this.m_count=0,this.m_radius=0}function f(){this.indexA,this.indexB,this.wA=h.zero(),this.wB=h.zero(),this.w=h.zero(),this.a}function d(){this.m_v1=new f,this.m_v2=new f,this.m_v3=new f,this.m_v=[this.m_v1,this.m_v2,this.m_v3],this.m_count}r.gjkCalls=0,r.gjkIters=0,r.gjkMaxIters=0,y.prototype.getVertexCount=function(){return this.m_count},y.prototype.getVertex=function(t){return s&&n.assert(0<=t&&t<this.m_count),this.m_vertices[t]},y.prototype.getSupport=function(t){for(var e=0,i=h.dot(this.m_vertices[0],t),s=0;s<this.m_count;++s){var o=h.dot(this.m_vertices[s],t);o>i&&(e=s,i=o)}return e},y.prototype.getSupportVertex=function(t){return this.m_vertices[this.getSupport(t)]},y.prototype.set=function(t,e){s&&n.assert("function"==typeof t.computeDistanceProxy),t.computeDistanceProxy(this,e)},f.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.wA=h.clone(t.wA),this.wB=h.clone(t.wB),this.w=h.clone(t.w),this.a=t.a},d.prototype.print=function(){return 3==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():2==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():1==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},d.prototype.readCache=function(t,e,i,o,r){s&&n.assert(t.count<=3),this.m_count=t.count;for(var m=0;m<this.m_count;++m){(y=this.m_v[m]).indexA=t.indexA[m],y.indexB=t.indexB[m];var u=e.getVertex(y.indexA),l=o.getVertex(y.indexB);y.wA=c.mulVec2(i,u),y.wB=c.mulVec2(r,l),y.w=h.sub(y.wB,y.wA),y.a=0}if(this.m_count>1){var _=t.metric,p=this.getMetric();(p<.5*_||2*_<p||p<a.EPSILON)&&(this.m_count=0)}if(0==this.m_count){var y;(y=this.m_v[0]).indexA=0,y.indexB=0;u=e.getVertex(0),l=o.getVertex(0);y.wA=c.mulVec2(i,u),y.wB=c.mulVec2(r,l),y.w=h.sub(y.wB,y.wA),y.a=1,this.m_count=1}},d.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.m_count;for(var e=0;e<this.m_count;++e)t.indexA[e]=this.m_v[e].indexA,t.indexB[e]=this.m_v[e].indexB},d.prototype.getSearchDirection=function(){switch(this.m_count){case 1:return h.neg(this.m_v1.w);case 2:var t=h.sub(this.m_v2.w,this.m_v1.w);return h.cross(t,h.neg(this.m_v1.w))>0?h.cross(1,t):h.cross(t,1);default:return s&&n.assert(!1),h.zero()}},d.prototype.getClosestPoint=function(){switch(this.m_count){case 0:return s&&n.assert(!1),h.zero();case 1:return h.clone(this.m_v1.w);case 2:return h.combine(this.m_v1.a,this.m_v1.w,this.m_v2.a,this.m_v2.w);case 3:return h.zero();default:return s&&n.assert(!1),h.zero()}},d.prototype.getWitnessPoints=function(t,e){switch(this.m_count){case 0:s&&n.assert(!1);break;case 1:t.set(this.m_v1.wA),e.set(this.m_v1.wB);break;case 2:t.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),e.setCombine(this.m_v1.a,this.m_v1.wB,this.m_v2.a,this.m_v2.wB);break;case 3:t.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),t.addMul(this.m_v3.a,this.m_v3.wA),e.set(t);break;default:s&&n.assert(!1)}},d.prototype.getMetric=function(){switch(this.m_count){case 0:return s&&n.assert(!1),0;case 1:return 0;case 2:return h.distance(this.m_v1.w,this.m_v2.w);case 3:return h.cross(h.sub(this.m_v2.w,this.m_v1.w),h.sub(this.m_v3.w,this.m_v1.w));default:return s&&n.assert(!1),0}},d.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3();break;default:s&&n.assert(!1)}},d.prototype.solve2=function(){var t=this.m_v1.w,e=this.m_v2.w,i=h.sub(e,t),s=-h.dot(t,i);if(s<=0)return this.m_v1.a=1,void(this.m_count=1);var o=h.dot(e,i);if(o<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);var n=1/(o+s);this.m_v1.a=o*n,this.m_v2.a=s*n,this.m_count=2},d.prototype.solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,s=h.sub(e,t),o=h.dot(t,s),n=h.dot(e,s),r=-o,a=h.sub(i,t),m=h.dot(t,a),c=h.dot(i,a),u=-m,l=h.sub(i,e),_=h.dot(e,l),p=h.dot(i,l),y=-_,f=h.cross(s,a),d=f*h.cross(e,i),v=f*h.cross(i,t),x=f*h.cross(t,e);if(r<=0&&u<=0)return this.m_v1.a=1,void(this.m_count=1);if(n>0&&r>0&&x<=0){var g=1/(n+r);return this.m_v1.a=n*g,this.m_v2.a=r*g,void(this.m_count=2)}if(c>0&&u>0&&v<=0){var b=1/(c+u);return this.m_v1.a=c*b,this.m_v3.a=u*b,this.m_count=2,void this.m_v2.set(this.m_v3)}if(n<=0&&y<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);if(c<=0&&p<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.set(this.m_v3);if(p>0&&y>0&&d<=0){var A=1/(p+y);return this.m_v2.a=p*A,this.m_v3.a=y*A,this.m_count=2,void this.m_v1.set(this.m_v3)}var B=1/(d+v+x);this.m_v1.a=d*B,this.m_v2.a=v*B,this.m_v3.a=x*B,this.m_count=3},p.testOverlap=function(t,e,i,s,o,n){var r=new u;r.proxyA.set(t,e),r.proxyB.set(i,s),r.transformA=o,r.transformB=n,r.useRadii=!0;var h=new _,m=new l;return p(m,h,r),m.distance<10*a.EPSILON}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=c;var o=i(2),n=i(6),r=(i(7),i(1)),a=(i(5),i(3)),h=i(0),m=(i(16),i(4),i(15));function c(t,e){if(!(this instanceof c))return new c(t,e);c._super.call(this),this.m_type=c.TYPE,this.m_p=h.zero(),this.m_radius=1,"object"==typeof t&&h.isValid(t)?(this.m_p.set(t),"number"==typeof e&&(this.m_radius=e)):"number"==typeof t&&(this.m_radius=t)}c._super=m,c.prototype=n(c._super.prototype),c.TYPE="circle",m.TYPES[c.TYPE]=c,c.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}},c._deserialize=function(t){return new c(t.p,t.radius)},c.prototype.getRadius=function(){return this.m_radius},c.prototype.getCenter=function(){return this.m_p},c.prototype.getVertex=function(t){return s&&o.assert(0==t),this.m_p},c.prototype.getVertexCount=function(t){return 1},c.prototype._clone=function(){var t=new c;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_p=this.m_p.clone(),t},c.prototype.getChildCount=function(){return 1},c.prototype.testPoint=function(t,e){var i=h.add(t.p,a.mulVec2(t.q,this.m_p)),s=h.sub(e,i);return h.dot(s,s)<=this.m_radius*this.m_radius},c.prototype.rayCast=function(t,e,i,s){var o=h.add(i.p,a.mulVec2(i.q,this.m_p)),n=h.sub(e.p1,o),m=h.dot(n,n)-this.m_radius*this.m_radius,c=h.sub(e.p2,e.p1),u=h.dot(n,c),l=h.dot(c,c),_=u*u-l*m;if(_<0||l<r.EPSILON)return!1;var p=-(u+r.sqrt(_));return 0<=p&&p<=e.maxFraction*l&&(p/=l,t.fraction=p,t.normal=h.add(n,h.mul(p,c)),t.normal.normalize(),!0)},c.prototype.computeAABB=function(t,e,i){var s=h.add(e.p,a.mulVec2(e.q,this.m_p));t.lowerBound.set(s.x-this.m_radius,s.y-this.m_radius),t.upperBound.set(s.x+this.m_radius,s.y+this.m_radius)},c.prototype.computeMass=function(t,e){t.mass=e*r.PI*this.m_radius*this.m_radius,t.center=this.m_p,t.I=t.mass*(.5*this.m_radius*this.m_radius+h.dot(this.m_p,this.m_p))},c.prototype.computeDistanceProxy=function(t){t.m_vertices.push(this.m_p),t.m_count=1,t.m_radius=this.m_radius}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=m;var s=i(6),o=(i(7),i(4)),n=i(15),r=(i(1),i(5)),a=i(3),h=i(0);i(16);function m(t,e){if(!(this instanceof m))return new m(t,e);m._super.call(this),this.m_type=m.TYPE,this.m_radius=o.polygonRadius,this.m_vertex1=t?h.clone(t):h.zero(),this.m_vertex2=e?h.clone(e):h.zero(),this.m_vertex0=h.zero(),this.m_vertex3=h.zero(),this.m_hasVertex0=!1,this.m_hasVertex3=!1}m._super=n,m.prototype=s(m._super.prototype),m.TYPE="edge",n.TYPES[m.TYPE]=m,m.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}},m._deserialize=function(t){var e=new m(t.vertex1,t.vertex2);return e.hasVertex0&&e.setPrev(t.vertex0),e.hasVertex3&&e.setNext(t.vertex3),e},m.prototype.setNext=function(t){return t?(this.m_vertex3.set(t),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},m.prototype.setPrev=function(t){return t?(this.m_vertex0.set(t),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},m.prototype._set=function(t,e){return this.m_vertex1.set(t),this.m_vertex2.set(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},m.prototype._clone=function(){var t=new m;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_vertex1.set(this.m_vertex1),t.m_vertex2.set(this.m_vertex2),t.m_vertex0.set(this.m_vertex0),t.m_vertex3.set(this.m_vertex3),t.m_hasVertex0=this.m_hasVertex0,t.m_hasVertex3=this.m_hasVertex3,t},m.prototype.getChildCount=function(){return 1},m.prototype.testPoint=function(t,e){return!1},m.prototype.rayCast=function(t,e,i,s){var o=a.mulTVec2(i.q,h.sub(e.p1,i.p)),n=a.mulTVec2(i.q,h.sub(e.p2,i.p)),r=h.sub(n,o),m=this.m_vertex1,c=this.m_vertex2,u=h.sub(c,m),l=h.neo(u.y,-u.x);l.normalize();var _=h.dot(l,h.sub(m,o)),p=h.dot(l,r);if(0==p)return!1;var y=_/p;if(y<0||e.maxFraction<y)return!1;var f=h.add(o,h.mul(y,r)),d=h.sub(c,m),v=h.dot(d,d);if(0==v)return!1;var x=h.dot(h.sub(f,m),d)/v;return!(x<0||1<x)&&(t.fraction=y,t.normal=_>0?a.mulVec2(i.q,l).neg():a.mulVec2(i.q,l),!0)},m.prototype.computeAABB=function(t,e,i){var s=r.mulVec2(e,this.m_vertex1),o=r.mulVec2(e,this.m_vertex2);t.combinePoints(s,o),t.extend(this.m_radius)},m.prototype.computeMass=function(t,e){t.mass=0,t.center.setCombine(.5,this.m_vertex1,.5,this.m_vertex2),t.I=0},m.prototype.computeDistanceProxy=function(t){t.m_vertices.push(this.m_vertex1),t.m_vertices.push(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}},function(t,e,i){"use strict";var s=i(30),o=i(37),n=i(38),r=i(71);function a(t,e){for(var i=new Array(t.length-1),s=1;s<t.length;++s)for(var o=i[s-1]=new Array(t.length-1),n=0,r=0;n<t.length;++n)n!==e&&(o[r++]=t[s][n]);return i}function h(t){if(1===t.length)return t[0];if(2===t.length)return["sum(",t[0],",",t[1],")"].join("");var e=t.length>>1;return["sum(",h(t.slice(0,e)),",",h(t.slice(e)),")"].join("")}function m(t){if(2===t.length)return[["sum(prod(",t[0][0],",",t[1][1],"),prod(-",t[0][1],",",t[1][0],"))"].join("")];for(var e=[],i=0;i<t.length;++i)e.push(["scale(",h(m(a(t,i))),",",(s=i,1&s?"-":""),t[0][i],")"].join(""));return e;var s}function c(t){for(var e=[],i=[],c=function(t){for(var e=new Array(t),i=0;i<t;++i){e[i]=new Array(t);for(var s=0;s<t;++s)e[i][s]=["m",s,"[",t-i-1,"]"].join("")}return e}(t),u=[],l=0;l<t;++l)0==(1&l)?e.push.apply(e,m(a(c,l))):i.push.apply(i,m(a(c,l))),u.push("m"+l);var _=h(e),p=h(i),y="orientation"+t+"Exact",f=["function ",y,"(",u.join(),"){var p=",_,",n=",p,",d=sub(p,n);return d[d.length-1];};return ",y].join("");return new Function("sum","prod","scale","sub",f)(o,s,n,r)}var u=c(3),l=c(4),_=[function(){return 0},function(){return 0},function(t,e){return e[0]-t[0]},function(t,e,i){var s,o=(t[1]-i[1])*(e[0]-i[0]),n=(t[0]-i[0])*(e[1]-i[1]),r=o-n;if(o>0){if(n<=0)return r;s=o+n}else{if(!(o<0))return r;if(n>=0)return r;s=-(o+n)}var a=33306690738754716e-32*s;return r>=a||r<=-a?r:u(t,e,i)},function(t,e,i,s){var o=t[0]-s[0],n=e[0]-s[0],r=i[0]-s[0],a=t[1]-s[1],h=e[1]-s[1],m=i[1]-s[1],c=t[2]-s[2],u=e[2]-s[2],_=i[2]-s[2],p=n*m,y=r*h,f=r*a,d=o*m,v=o*h,x=n*a,g=c*(p-y)+u*(f-d)+_*(v-x),b=7771561172376103e-31*((Math.abs(p)+Math.abs(y))*Math.abs(c)+(Math.abs(f)+Math.abs(d))*Math.abs(u)+(Math.abs(v)+Math.abs(x))*Math.abs(_));return g>b||-g>b?g:l(t,e,i,s)}];function p(t){var e=_[t.length];return e||(e=_[t.length]=c(t.length)),e.apply(void 0,t)}!function(){for(;_.length<=5;)_.push(c(_.length));for(var e=[],i=["slow"],s=0;s<=5;++s)e.push("a"+s),i.push("o"+s);var o=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(s=2;s<=5;++s)o.push("case ",s,":return o",s,"(",e.slice(0,s).join(),");");o.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),i.push(o.join(""));var n=Function.apply(void 0,i);for(t.exports=n.apply(void 0,[p].concat(_)),s=0;s<=5;++s)t.exports[s]=_[s]}()},function(t,e){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;e.toString=function(t){t="string"==typeof t?t:"\n";var e="";for(var i in this)"function"!=typeof this[i]&&"object"!=typeof this[i]&&(e+=i+": "+this[i]+t);return e}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=u;var o=i(2),n=i(6),r=(i(7),i(1),i(5)),a=(i(3),i(0)),h=(i(16),i(4)),m=i(15),c=i(25);function u(t,e){if(!(this instanceof u))return new u(t,e);u._super.call(this),this.m_type=u.TYPE,this.m_radius=h.polygonRadius,this.m_vertices=[],this.m_count=0,this.m_prevVertex=null,this.m_nextVertex=null,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_isLoop=e,t&&t.length&&(e?this._createLoop(t):this._createChain(t))}u._super=m,u.prototype=n(u._super.prototype),u.TYPE="chain",m.TYPES[u.TYPE]=u,u.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices,isLoop:this.m_isLoop,prevVertex:this.m_prevVertex,nextVertex:this.m_nextVertex,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex}},u._deserialize=function(t){return new u(t.vertices.map(a._deserialize),t.isLoop)},u.prototype._createLoop=function(t){s&&o.assert(0==this.m_vertices.length&&0==this.m_count),s&&o.assert(t.length>=3);for(var e=1;e<t.length;++e){var i=t[e-1],n=t[e];s&&o.assert(a.distanceSquared(i,n)>h.linearSlopSquared)}this.m_vertices.length=0,this.m_count=t.length+1;for(e=0;e<t.length;++e)this.m_vertices[e]=t[e].clone();return this.m_vertices[t.length]=t[0].clone(),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},u.prototype._createChain=function(t){s&&o.assert(0==this.m_vertices.length&&0==this.m_count),s&&o.assert(t.length>=2);for(var e=1;e<t.length;++e){var i=t[e-1],n=t[e];s&&o.assert(a.distanceSquared(i,n)>h.linearSlopSquared)}this.m_count=t.length;for(e=0;e<t.length;++e)this.m_vertices[e]=t[e].clone();return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex=null,this.m_nextVertex=null,this},u.prototype._setPrevVertex=function(t){this.m_prevVertex=t,this.m_hasPrevVertex=!0},u.prototype._setNextVertex=function(t){this.m_nextVertex=t,this.m_hasNextVertex=!0},u.prototype._clone=function(){var t=new u;return t.createChain(this.m_vertices),t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_prevVertex=this.m_prevVertex,t.m_nextVertex=this.m_nextVertex,t.m_hasPrevVertex=this.m_hasPrevVertex,t.m_hasNextVertex=this.m_hasNextVertex,t},u.prototype.getChildCount=function(){return this.m_count-1},u.prototype.getChildEdge=function(t,e){s&&o.assert(0<=e&&e<this.m_count-1),t.m_type=c.TYPE,t.m_radius=this.m_radius,t.m_vertex1=this.m_vertices[e],t.m_vertex2=this.m_vertices[e+1],e>0?(t.m_vertex0=this.m_vertices[e-1],t.m_hasVertex0=!0):(t.m_vertex0=this.m_prevVertex,t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3=this.m_vertices[e+2],t.m_hasVertex3=!0):(t.m_vertex3=this.m_nextVertex,t.m_hasVertex3=this.m_hasNextVertex)},u.prototype.getVertex=function(t){return s&&o.assert(0<=t&&t<=this.m_count),t<this.m_count?this.m_vertices[t]:this.m_vertices[0]},u.prototype.testPoint=function(t,e){return!1},u.prototype.rayCast=function(t,e,i,n){return s&&o.assert(0<=n&&n<this.m_count),new c(this.getVertex(n),this.getVertex(n+1)).rayCast(t,e,i,0)},u.prototype.computeAABB=function(t,e,i){s&&o.assert(0<=i&&i<this.m_count);var n=r.mulVec2(e,this.getVertex(i)),a=r.mulVec2(e,this.getVertex(i+1));t.combinePoints(n,a)},u.prototype.computeMass=function(t,e){t.mass=0,t.center=a.neo(),t.I=0},u.prototype.computeDistanceProxy=function(t,e){s&&o.assert(0<=e&&e<this.m_count),t.m_buffer[0]=this.getVertex(e),t.m_buffer[1]=this.getVertex(e+1),t.m_vertices=t.m_buffer,t.m_count=2,t.m_radius=this.m_radius}},function(t,e,i){function s(t,e,i,s,o,n,r,a){if(4===arguments.length){var h=t,m=e,c=i,u=s;h.length&&2===h.length?(t=h[0],e=h[1],i=m[0],s=m[1],o=c[0],n=c[1],r=u[0],a=u[1]):(t=h.x,e=h.y,i=m.x,s=m.y,o=c.x,n=c.y,r=u.x,a=u.y)}var l,_,p,y,f,d,v,x,g,b,A;if(b=(l=s-e)*r+(p=t-i)*a+(f=i*e-t*s),!(0!==(g=l*o+p*n+f)&&0!==b&&(g>=0&&b>=0||g<0&&b<0)||(x=(_=a-n)*i+(y=o-r)*s+(d=r*n-o*a),0!==(v=_*t+y*e+d)&&0!==x&&(v>=0&&x>=0||v<0&&x<0))))return 0===(A=l*y-_*p)||(A<0?-A/2:A/2,[(p*d-y*f)/A,(_*f-l*d)/A])}t.exports&&(t.exports=s),"undefined"!=typeof window&&(window.segseg=window.segseg||s)},function(t,e,i){"use strict";t.exports=function(t,e,i){var o=t*e,n=s*t,r=n-(n-t),a=t-r,h=s*e,m=h-(h-e),c=e-m,u=a*c-(o-r*m-a*m-r*c);if(i)return i[0]=u,i[1]=o,i;return[u,o]};var s=+(Math.pow(2,27)+1)},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=_;var o=i(7),n=i(2),r=i(0),a=i(41),h=i(43),m=i(21),c=i(11),u=i(17),l={gravity:r.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3};function _(t){if(!(this instanceof _))return new _(t);t&&r.isValid(t)&&(t={gravity:t}),t=o(t,l),this.m_solver=new h(this),this.m_broadPhase=new a,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=t.allowSleep,this.m_gravity=r.clone(t.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=t.warmStarting,this.m_continuousPhysics=t.continuousPhysics,this.m_subStepping=t.subStepping,this.m_blockSolve=t.blockSolve,this.m_velocityIterations=t.velocityIterations,this.m_positionIterations=t.positionIterations,this.m_t=0,this.m_stepCount=0,this.addPair=this.createContact.bind(this)}_.prototype._serialize=function(){for(var t=[],e=[],i=this.getBodyList();i;i=i.getNext())t.push(i);for(var s=this.getJointList();s;s=s.getNext())"function"==typeof s._serialize&&e.push(s);return{gravity:this.m_gravity,bodies:t,joints:e}},_._deserialize=function(t,e,i){if(!t)return new _;var s=new _(t.gravity);return t.bodies&&t.bodies.reverse().forEach((function(t){s._addBody(i(m,t,s))})),t.joints&&t.joints.reverse().forEach((function(t){s.createJoint(i(c,t,s))})),s},_.prototype.getBodyList=function(){return this.m_bodyList},_.prototype.getJointList=function(){return this.m_jointList},_.prototype.getContactList=function(){return this.m_contactList},_.prototype.getBodyCount=function(){return this.m_bodyCount},_.prototype.getJointCount=function(){return this.m_jointCount},_.prototype.getContactCount=function(){return this.m_contactCount},_.prototype.setGravity=function(t){this.m_gravity=t},_.prototype.getGravity=function(){return this.m_gravity},_.prototype.isLocked=function(){return this.m_locked},_.prototype.setAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,0==this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.setAwake(!0)},_.prototype.getAllowSleeping=function(){return this.m_allowSleep},_.prototype.setWarmStarting=function(t){this.m_warmStarting=t},_.prototype.getWarmStarting=function(){return this.m_warmStarting},_.prototype.setContinuousPhysics=function(t){this.m_continuousPhysics=t},_.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},_.prototype.setSubStepping=function(t){this.m_subStepping=t},_.prototype.getSubStepping=function(){return this.m_subStepping},_.prototype.setAutoClearForces=function(t){this.m_clearForces=t},_.prototype.getAutoClearForces=function(){return this.m_clearForces},_.prototype.clearForces=function(){for(var t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0},_.prototype.queryAABB=function(t,e){s&&n.assert("function"==typeof e);var i=this.m_broadPhase;this.m_broadPhase.query(t,(function(t){var s=i.getUserData(t);return e(s.fixture)}))},_.prototype.rayCast=function(t,e,i){s&&n.assert("function"==typeof i);var o=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:e},(function(t,e){var s=o.getUserData(e),n=s.fixture,a=s.childIndex,h={};if(n.rayCast(h,t,a)){var m=h.fraction,c=r.add(r.mul(1-m,t.p1),r.mul(m,t.p2));return i(n,c,h.normal,m)}return t.maxFraction}))},_.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},_.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},_.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},_.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},_.prototype.shiftOrigin=function(t){if(s&&n.assert(0==this.m_locked),!this.m_locked){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.sub(t),e.m_sweep.c0.sub(t),e.m_sweep.c.sub(t);for(var i=this.m_jointList;i;i=i.m_next)i.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}},_.prototype._addBody=function(t){s&&n.assert(!1===this.isLocked()),this.isLocked()||(t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount)},_.prototype.createBody=function(t,e){if(s&&n.assert(0==this.isLocked()),this.isLocked())return null;t&&r.isValid(t)&&(t={position:t,angle:e});var i=new m(this,t);return this._addBody(i),i},_.prototype.createDynamicBody=function(t,e){return t?r.isValid(t)&&(t={position:t,angle:e}):t={},t.type="dynamic",this.createBody(t)},_.prototype.createKinematicBody=function(t,e){return t?r.isValid(t)&&(t={position:t,angle:e}):t={},t.type="kinematic",this.createBody(t)},_.prototype.destroyBody=function(t){if(s&&n.assert(this.m_bodyCount>0),s&&n.assert(0==this.isLocked()),!this.isLocked()){if(t.m_destroyed)return!1;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.publish("remove-joint",i.joint),this.destroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var o=t.m_contactList;o;){var r=o;o=o.next,this.destroyContact(r.contact),t.m_contactList=o}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var h=a;a=a.m_next,this.publish("remove-fixture",h),h.destroyProxies(this.m_broadPhase),t.m_fixtureList=a}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",t),!0}},_.prototype.createJoint=function(t){if(s&&n.assert(!!t.m_bodyA),s&&n.assert(!!t.m_bodyB),s&&n.assert(0==this.isLocked()),this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,0==t.m_collideConnected)for(var e=t.m_bodyB.getContactList();e;e=e.next)e.other==t.m_bodyA&&e.contact.flagForFiltering();return t},_.prototype.destroyJoint=function(t){if(s&&n.assert(0==this.isLocked()),!this.isLocked()){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var e=t.m_bodyA,i=t.m_bodyB;if(e.setAwake(!0),i.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,s&&n.assert(this.m_jointCount>0),--this.m_jointCount,0==t.m_collideConnected)for(var o=i.getContactList();o;)o.other==e&&o.contact.flagForFiltering(),o=o.next;this.publish("remove-joint",t)}};var p=new h.TimeStep;_.prototype.step=function(t,e,i){if((0|e)!==e&&(e=0),e=e||this.m_velocityIterations,i=i||this.m_positionIterations,this.m_stepCount++,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,p.reset(t),p.velocityIterations=e,p.positionIterations=i,p.warmStarting=this.m_warmStarting,p.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&t>0){this.m_solver.solveWorld(p);for(var s=this.m_bodyList;s;s=s.getNext())0!=s.m_islandFlag&&(s.isStatic()||s.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&t>0&&this.m_solver.solveWorldTOI(p),this.m_clearForces&&this.clearForces(),this.m_locked=!1},_.prototype.findNewContacts=function(){this.m_broadPhase.updatePairs(this.addPair)},_.prototype.createContact=function(t,e){var i=t.fixture,s=e.fixture,o=t.childIndex,n=e.childIndex,r=i.getBody(),a=s.getBody();if(r!=a){for(var h=a.getContactList();h;){if(h.other==r){var m=h.contact.getFixtureA(),c=h.contact.getFixtureB(),l=h.contact.getChildIndexA(),_=h.contact.getChildIndexB();if(m==i&&c==s&&l==o&&_==n)return;if(m==s&&c==i&&l==n&&_==o)return}h=h.next}if(0!=a.shouldCollide(r)&&0!=s.shouldCollide(i)){var p=u.create(i,o,s,n);null!=p&&(p.m_prev=null,null!=this.m_contactList&&(p.m_next=this.m_contactList,this.m_contactList.m_prev=p),this.m_contactList=p,++this.m_contactCount)}}},_.prototype.updateContacts=function(){for(var t,e=this.m_contactList;t=e;){e=t.getNext();var i=t.getFixtureA(),s=t.getFixtureB(),o=t.getChildIndexA(),n=t.getChildIndexB(),r=i.getBody(),a=s.getBody();if(t.m_filterFlag){if(0==a.shouldCollide(r)){this.destroyContact(t);continue}if(0==s.shouldCollide(i)){this.destroyContact(t);continue}t.m_filterFlag=!1}var h=r.isAwake()&&!r.isStatic(),m=a.isAwake()&&!a.isStatic();if(0!=h||0!=m){var c=i.m_proxies[o].proxyId,u=s.m_proxies[n].proxyId;0!=this.m_broadPhase.testOverlap(c,u)?t.update(this):this.destroyContact(t)}}},_.prototype.destroyContact=function(t){u.destroy(t,this),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),--this.m_contactCount},_.prototype._listeners=null,_.prototype.on=function(t,e){return"string"!=typeof t||"function"!=typeof e||(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)),this},_.prototype.off=function(t,e){if("string"!=typeof t||"function"!=typeof e)return this;var i=this._listeners&&this._listeners[t];if(!i||!i.length)return this;var s=i.indexOf(e);return s>=0&&i.splice(s,1),this},_.prototype.publish=function(t,e,i,s){var o=this._listeners&&this._listeners[t];if(!o||!o.length)return 0;for(var n=0;n<o.length;n++)o[n].call(this,e,i,s);return o.length},_.prototype.beginContact=function(t){this.publish("begin-contact",t)},_.prototype.endContact=function(t){this.publish("end-contact",t)},_.prototype.preSolve=function(t,e){this.publish("pre-solve",t,e)},_.prototype.postSolve=function(t,e){this.publish("post-solve",t,e)}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(4),n=i(2),r=i(42),a=i(0),h=i(1),m=i(16);function c(t){this.id=t,this.aabb=new m,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.toString=function(){return this.id+": "+this.userData}}function u(){this.m_root=null,this.m_nodes={},this.m_lastProxyId=0,this.m_pool=new r({create:function(){return new c}})}t.exports=u,c.prototype.isLeaf=function(){return null==this.child1},u.prototype.getUserData=function(t){var e=this.m_nodes[t];return s&&n.assert(!!e),e.userData},u.prototype.getFatAABB=function(t){var e=this.m_nodes[t];return s&&n.assert(!!e),e.aabb},u.prototype.allocateNode=function(){var t=this.m_pool.allocate();return t.id=++this.m_lastProxyId,t.userData=null,t.parent=null,t.child1=null,t.child2=null,t.height=-1,this.m_nodes[t.id]=t,t},u.prototype.freeNode=function(t){this.m_pool.release(t),t.height=-1,delete this.m_nodes[t.id]},u.prototype.createProxy=function(t,e){s&&n.assert(m.isValid(t));var i=this.allocateNode();return i.aabb.set(t),m.extend(i.aabb,o.aabbExtension),i.userData=e,i.height=0,this.insertLeaf(i),i.id},u.prototype.destroyProxy=function(t){var e=this.m_nodes[t];s&&n.assert(!!e),s&&n.assert(e.isLeaf()),this.removeLeaf(e),this.freeNode(e)},u.prototype.moveProxy=function(t,e,i){s&&n.assert(m.isValid(e)),s&&n.assert(!i||a.isValid(i));var r=this.m_nodes[t];return s&&n.assert(!!r),s&&n.assert(r.isLeaf()),!r.aabb.contains(e)&&(this.removeLeaf(r),r.aabb.set(e),e=r.aabb,m.extend(e,o.aabbExtension),i.x<0?e.lowerBound.x+=i.x*o.aabbMultiplier:e.upperBound.x+=i.x*o.aabbMultiplier,i.y<0?e.lowerBound.y+=i.y*o.aabbMultiplier:e.upperBound.y+=i.y*o.aabbMultiplier,this.insertLeaf(r),!0)},u.prototype.insertLeaf=function(t){if(s&&n.assert(m.isValid(t.aabb)),null==this.m_root)return this.m_root=t,void(this.m_root.parent=null);for(var e=t.aabb,i=this.m_root;0==i.isLeaf();){var o=i.child1,r=i.child2,a=i.aabb.getPerimeter(),c=new m;c.combine(i.aabb,e);var u,l,_=c.getPerimeter(),p=2*_,y=2*(_-a);if(o.isLeaf()){(d=new m).combine(e,o.aabb),u=d.getPerimeter()+y}else{(d=new m).combine(e,o.aabb);var f=o.aabb.getPerimeter();u=d.getPerimeter()-f+y}if(r.isLeaf()){(d=new m).combine(e,r.aabb),l=d.getPerimeter()+y}else{var d;(d=new m).combine(e,r.aabb);f=r.aabb.getPerimeter();l=d.getPerimeter()-f+y}if(p<u&&p<l)break;i=u<l?o:r}var v=i,x=v.parent,g=this.allocateNode();for(g.parent=x,g.userData=null,g.aabb.combine(e,v.aabb),g.height=v.height+1,null!=x?(x.child1==v?x.child1=g:x.child2=g,g.child1=v,g.child2=t,v.parent=g,t.parent=g):(g.child1=v,g.child2=t,v.parent=g,t.parent=g,this.m_root=g),i=t.parent;null!=i;){o=(i=this.balance(i)).child1,r=i.child2;s&&n.assert(null!=o),s&&n.assert(null!=r),i.height=1+h.max(o.height,r.height),i.aabb.combine(o.aabb,r.aabb),i=i.parent}},u.prototype.removeLeaf=function(t){if(t!=this.m_root){var e,i=t.parent,s=i.parent;if(e=i.child1==t?i.child2:i.child1,null!=s){s.child1==i?s.child1=e:s.child2=e,e.parent=s,this.freeNode(i);for(var o=s;null!=o;){var n=(o=this.balance(o)).child1,r=o.child2;o.aabb.combine(n.aabb,r.aabb),o.height=1+h.max(n.height,r.height),o=o.parent}}else this.m_root=e,e.parent=null,this.freeNode(i)}else this.m_root=null},u.prototype.balance=function(t){s&&n.assert(null!=t);var e=t;if(e.isLeaf()||e.height<2)return t;var i=e.child1,o=e.child2,r=o.height-i.height;if(r>1){var a=o.child1,m=o.child2;return o.child1=e,o.parent=e.parent,e.parent=o,null!=o.parent?o.parent.child1==t?o.parent.child1=o:o.parent.child2=o:this.m_root=o,a.height>m.height?(o.child2=a,e.child2=m,m.parent=e,e.aabb.combine(i.aabb,m.aabb),o.aabb.combine(e.aabb,a.aabb),e.height=1+h.max(i.height,m.height),o.height=1+h.max(e.height,a.height)):(o.child2=m,e.child2=a,a.parent=e,e.aabb.combine(i.aabb,a.aabb),o.aabb.combine(e.aabb,m.aabb),e.height=1+h.max(i.height,a.height),o.height=1+h.max(e.height,m.height)),o}if(r<-1){var c=i.child1,u=i.child2;return i.child1=e,i.parent=e.parent,e.parent=i,null!=i.parent?i.parent.child1==e?i.parent.child1=i:i.parent.child2=i:this.m_root=i,c.height>u.height?(i.child2=c,e.child1=u,u.parent=e,e.aabb.combine(o.aabb,u.aabb),i.aabb.combine(e.aabb,c.aabb),e.height=1+h.max(o.height,u.height),i.height=1+h.max(e.height,c.height)):(i.child2=u,e.child1=c,c.parent=e,e.aabb.combine(o.aabb,c.aabb),i.aabb.combine(e.aabb,u.aabb),e.height=1+h.max(o.height,c.height),i.height=1+h.max(e.height,u.height)),i}return e},u.prototype.getHeight=function(){return null==this.m_root?0:this.m_root.height},u.prototype.getAreaRatio=function(){if(null==this.m_root)return 0;for(var t,e=this.m_root.aabb.getPerimeter(),i=0,s=p.allocate().preorder(this.m_root);t=s.next();)t.height<0||(i+=t.aabb.getPerimeter());return p.release(s),i/e},u.prototype.computeHeight=function(t){var e;if((e=void 0!==t?this.m_nodes[t]:this.m_root).isLeaf())return 0;var i=this.computeHeight(e.child1.id),s=this.computeHeight(e.child2.id);return 1+h.max(i,s)},u.prototype.validateStructure=function(t){if(null!=t){t==this.m_root&&s&&n.assert(null==t.parent);var e=t.child1,i=t.child2;if(t.isLeaf())return s&&n.assert(null==e),s&&n.assert(null==i),void(s&&n.assert(0==t.height));s&&n.assert(e.parent==t),s&&n.assert(i.parent==t),this.validateStructure(e),this.validateStructure(i)}},u.prototype.validateMetrics=function(t){if(null!=t){var e=t.child1,i=t.child2;if(t.isLeaf())return s&&n.assert(null==e),s&&n.assert(null==i),void(s&&n.assert(0==t.height));var o=e.height,r=i.height,a=1+h.max(o,r);s&&n.assert(t.height==a);var c=new m;c.combine(e.aabb,i.aabb),s&&n.assert(m.areEqual(c,t.aabb)),this.validateMetrics(e),this.validateMetrics(i)}},u.prototype.validate=function(){this.validateStructure(this.m_root),this.validateMetrics(this.m_root),s&&n.assert(this.getHeight()==this.computeHeight())},u.prototype.getMaxBalance=function(){for(var t,e=0,i=p.allocate().preorder(this.m_root);t=i.next();)if(!(t.height<=1)){s&&n.assert(0==t.isLeaf());var o=h.abs(t.child2.height-t.child1.height);e=h.max(e,o)}return p.release(i),e},u.prototype.rebuildBottomUp=function(){for(var t,e=[],i=0,s=p.allocate().preorder(this.m_root);t=s.next();)t.height<0||(t.isLeaf()?(t.parent=null,e[i]=t,++i):this.freeNode(t));for(p.release(s);i>1;){for(var o=1/0,n=-1,r=-1,a=0;a<i;++a)for(var c=e[a].aabb,u=a+1;u<i;++u){var l=e[u].aabb,_=new m;_.combine(c,l);var y=_.getPerimeter();y<o&&(n=a,r=u,o=y)}var f=e[n],d=e[r],v=this.allocateNode();v.child1=f,v.child2=d,v.height=1+h.max(f.height,d.height),v.aabb.combine(f.aabb,d.aabb),v.parent=null,f.parent=v,d.parent=v,e[r]=e[i-1],e[n]=v,--i}this.m_root=e[0],this.validate()},u.prototype.shiftOrigin=function(t){for(var e,i=p.allocate().preorder(this.m_root);e=i.next();){var s=e.aabb;s.lowerBound.x-=t.x,s.lowerBound.y-=t.y,s.upperBound.x-=t.x,s.upperBound.y-=t.y}p.release(i)},u.prototype.query=function(t,e){s&&n.assert("function"==typeof e);var i=_.allocate();for(i.push(this.m_root);i.length>0;){var o=i.pop();if(null!=o)if(m.testOverlap(o.aabb,t))if(o.isLeaf()){if(0==e(o.id))return}else i.push(o.child1),i.push(o.child2)}_.release(i)},u.prototype.rayCast=function(t,e){s&&n.assert("function"==typeof e);var i=t.p1,o=t.p2,r=a.sub(o,i);s&&n.assert(r.lengthSquared()>0),r.normalize();var c=a.cross(1,r),u=a.abs(c),p=t.maxFraction,y=new m,f=a.combine(1-p,i,p,o);y.combinePoints(i,f);var d=_.allocate(),v=l.allocate();for(d.push(this.m_root);d.length>0;){var x=d.pop();if(null!=x&&0!=m.testOverlap(x.aabb,y)){var g=x.aabb.getCenter(),b=x.aabb.getExtents();if(!(h.abs(a.dot(c,a.sub(i,g)))-a.dot(u,b)>0))if(x.isLeaf()){v.p1=a.clone(t.p1),v.p2=a.clone(t.p2),v.maxFraction=p;var A=e(v,x.id);if(0==A)return;A>0&&(p=A,f=a.combine(1-p,i,p,o),y.combinePoints(i,f))}else d.push(x.child1),d.push(x.child2)}}_.release(d),l.release(v)};var l=new r({create:function(){return{}},release:function(t){}}),_=new r({create:function(){return[]},release:function(t){t.length=0}}),p=new r({create:function(){return new y},release:function(t){t.close()}});function y(){var t=[],e=[];return{preorder:function(i){return t.length=0,t.push(i),e.length=0,e.push(0),this},next:function(){for(;t.length>0;){var i=t.length-1,s=t[i];if(0===e[i])return e[i]=1,s;if(1===e[i]&&(e[i]=2,s.child1))return t.push(s.child1),e.push(1),s.child1;if(2===e[i]&&(e[i]=3,s.child2))return t.push(s.child2),e.push(1),s.child2;t.pop(),e.pop()}},close:function(){t.length=0}}}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=l;var o=i(2),n=i(7),r=i(1),a=i(0),h=i(16),m=i(15),c={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535};function u(t,e){this.aabb=new h,this.fixture=t,this.childIndex=e,this.proxyId}function l(t,e,i){e.shape?(i=e,e=e.shape):"number"==typeof i&&(i={density:i}),i=n(i,c),this.m_body=t,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_density=i.density,this.m_isSensor=i.isSensor,this.m_filterGroupIndex=i.filterGroupIndex,this.m_filterCategoryBits=i.filterCategoryBits,this.m_filterMaskBits=i.filterMaskBits,this.m_shape=e,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var s=this.m_shape.getChildCount(),o=0;o<s;++o)this.m_proxies[o]=new u(this,o);this.m_userData=i.userData}l.prototype._reset=function(){var t=this.getBody(),e=t.m_world.m_broadPhase;this.destroyProxies(e),this.m_shape._reset&&this.m_shape._reset();for(var i=this.m_shape.getChildCount(),s=0;s<i;++s)this.m_proxies[s]=new u(this,s);this.createProxies(e,t.m_xf),t.resetMassData()},l.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}},l._deserialize=function(t,e,i){var s=i(m,t.shape);return s&&new l(e,s,t)},l.prototype.getType=function(){return this.m_shape.getType()},l.prototype.getShape=function(){return this.m_shape},l.prototype.isSensor=function(){return this.m_isSensor},l.prototype.setSensor=function(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)},l.prototype.getUserData=function(){return this.m_userData},l.prototype.setUserData=function(t){this.m_userData=t},l.prototype.getBody=function(){return this.m_body},l.prototype.getNext=function(){return this.m_next},l.prototype.getDensity=function(){return this.m_density},l.prototype.setDensity=function(t){s&&o.assert(r.isFinite(t)&&t>=0),this.m_density=t},l.prototype.getFriction=function(){return this.m_friction},l.prototype.setFriction=function(t){this.m_friction=t},l.prototype.getRestitution=function(){return this.m_restitution},l.prototype.setRestitution=function(t){this.m_restitution=t},l.prototype.testPoint=function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},l.prototype.rayCast=function(t,e,i){return this.m_shape.rayCast(t,e,this.m_body.getTransform(),i)},l.prototype.getMassData=function(t){this.m_shape.computeMass(t,this.m_density)},l.prototype.getAABB=function(t){return s&&o.assert(0<=t&&t<this.m_proxyCount),this.m_proxies[t].aabb},l.prototype.createProxies=function(t,e){s&&o.assert(0==this.m_proxyCount),this.m_proxyCount=this.m_shape.getChildCount();for(var i=0;i<this.m_proxyCount;++i){var n=this.m_proxies[i];this.m_shape.computeAABB(n.aabb,e,i),n.proxyId=t.createProxy(n.aabb,n)}},l.prototype.destroyProxies=function(t){for(var e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];t.destroyProxy(i.proxyId),i.proxyId=null}this.m_proxyCount=0},l.prototype.synchronize=function(t,e,i){for(var s=0;s<this.m_proxyCount;++s){var o=this.m_proxies[s],n=new h,r=new h;this.m_shape.computeAABB(n,e,o.childIndex),this.m_shape.computeAABB(r,i,o.childIndex),o.aabb.combine(n,r);var m=a.sub(i.p,e.p);t.moveProxy(o.proxyId,o.aabb,m)}},l.prototype.setFilterData=function(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()},l.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},l.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},l.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},l.prototype.refilter=function(){if(null!=this.m_body){for(var t=this.m_body.getContactList();t;){var e=t.contact,i=e.getFixtureA(),s=e.getFixtureB();i!=this&&s!=this||e.flagForFiltering(),t=t.next}var o=this.m_body.getWorld();if(null!=o)for(var n=o.m_broadPhase,r=0;r<this.m_proxyCount;++r)n.touchProxy(this.m_proxies[r].proxyId)}},l.prototype.shouldCollide=function(t){return t.m_filterGroupIndex==this.m_filterGroupIndex&&0!=t.m_filterGroupIndex?t.m_filterGroupIndex>0:0!=(t.m_filterMaskBits&this.m_filterCategoryBits)&&0!=(t.m_filterCategoryBits&this.m_filterMaskBits)}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=function(t,e){var i=r.now();++a.toiCalls,t.state=v.e_unknown,t.t=e.tMax;var m=e.proxyA,c=e.proxyB,u=e.sweepA,f=e.sweepB;u.normalize(),f.normalize();var g=e.tMax,b=m.m_radius+c.m_radius,A=h.max(o.linearSlop,b-3*o.linearSlop),B=.25*o.linearSlop;s&&n.assert(A>B);var w=0,S=o.maxTOIIterations,M=0,C=new d,I=new p;for(I.proxyA=e.proxyA,I.proxyB=e.proxyB,I.useRadii=!1;;){var T=l.identity(),P=l.identity();u.getTransform(T,w),f.getTransform(P,w),I.transformA=T,I.transformB=P;var V=new y;if(_(V,C,I),V.distance<=0){t.state=v.e_overlapped,t.t=0;break}if(V.distance<A+B){t.state=v.e_touching,t.t=w;break}var z=new x;z.initialize(C,m,u,c,f,w);for(var E=!1,F=g,L=0;;){var k=z.findMinSeparation(F);z.indexA,z.indexB;if(k>A+B){t.state=v.e_separated,t.t=g,E=!0;break}if(k>A-B){w=F;break}var D=z.evaluate(w);z.indexA,z.indexB;if(D<A-B){t.state=v.e_failed,t.t=w,E=!0;break}if(D<=A+B){t.state=v.e_touching,t.t=w,E=!0;break}for(var q=0,R=w,j=F;;){var O;O=1&q?R+(A-D)*(j-R)/(k-D):.5*(R+j),++q,++a.toiRootIters;var N=z.evaluate(O);z.indexA,z.indexB;if(h.abs(N-A)<B){F=O;break}if(N>A?(R=O,D=N):(j=O,k=N),50==q)break}if(a.toiMaxRootIters=h.max(a.toiMaxRootIters,q),++L==o.maxPolygonVertices)break}if(++M,++a.toiIters,E)break;if(M==S){t.state=v.e_failed,t.t=w;break}}a.toiMaxIters=h.max(a.toiMaxIters,M);var U=r.diff(i);a.toiMaxTime=h.max(a.toiMaxTime,U),a.toiTime+=U},t.exports.Input=function(){this.proxyA=new f,this.proxyB=new f,this.sweepA=new u,this.sweepB=new u,this.tMax},t.exports.Output=v;var o=i(4),n=i(2),r=i(44),a=i(27),h=i(1),m=i(0),c=(i(10),i(9),i(14),i(3)),u=i(8),l=i(5),_=(i(12),i(13),i(23)),p=_.Input,y=_.Output,f=_.Proxy,d=_.Cache;function v(){this.state,this.t}v.e_unknown=0,v.e_failed=1,v.e_overlapped=2,v.e_touching=3,v.e_separated=4,a.toiTime=0,a.toiMaxTime=0,a.toiCalls=0,a.toiIters=0,a.toiMaxIters=0,a.toiRootIters=0,a.toiMaxRootIters=0;function x(){this.m_proxyA=new f,this.m_proxyB=new f,this.m_sweepA,this.m_sweepB,this.indexA,this.indexB,this.m_type,this.m_localPoint=m.zero(),this.m_axis=m.zero()}x.prototype.initialize=function(t,e,i,o,r,a){this.m_proxyA=e,this.m_proxyB=o;var h=t.count;s&&n.assert(0<h&&h<3),this.m_sweepA=i,this.m_sweepB=r;var u=l.identity(),_=l.identity();if(this.m_sweepA.getTransform(u,a),this.m_sweepB.getTransform(_,a),1==h){this.m_type=1;var p=this.m_proxyA.getVertex(t.indexA[0]),y=this.m_proxyB.getVertex(t.indexB[0]),f=l.mulVec2(u,p),d=l.mulVec2(_,y);return this.m_axis.setCombine(1,d,-1,f),B=this.m_axis.normalize()}if(t.indexA[0]==t.indexA[1]){this.m_type=3;var v=o.getVertex(t.indexB[0]),x=o.getVertex(t.indexB[1]);this.m_axis=m.cross(m.sub(x,v),1),this.m_axis.normalize();var g=c.mulVec2(_.q,this.m_axis);this.m_localPoint=m.mid(v,x);d=l.mulVec2(_,this.m_localPoint),p=e.getVertex(t.indexA[0]),f=l.mulVec2(u,p);return(B=m.dot(f,g)-m.dot(d,g))<0&&(this.m_axis=m.neg(this.m_axis),B=-B),B}this.m_type=2;var b=this.m_proxyA.getVertex(t.indexA[0]),A=this.m_proxyA.getVertex(t.indexA[1]);this.m_axis=m.cross(m.sub(A,b),1),this.m_axis.normalize();g=c.mulVec2(u.q,this.m_axis);this.m_localPoint=m.mid(b,A);var B;f=l.mulVec2(u,this.m_localPoint),y=this.m_proxyB.getVertex(t.indexB[0]),d=l.mulVec2(_,y);return(B=m.dot(d,g)-m.dot(f,g))<0&&(this.m_axis=m.neg(this.m_axis),B=-B),B},x.prototype.compute=function(t,e){var i=l.identity(),o=l.identity();switch(this.m_sweepA.getTransform(i,e),this.m_sweepB.getTransform(o,e),this.m_type){case 1:if(t){var r=c.mulTVec2(i.q,this.m_axis),a=c.mulTVec2(o.q,m.neg(this.m_axis));this.indexA=this.m_proxyA.getSupport(r),this.indexB=this.m_proxyB.getSupport(a)}var h=this.m_proxyA.getVertex(this.indexA),u=this.m_proxyB.getVertex(this.indexB),_=l.mulVec2(i,h),p=l.mulVec2(o,u);return m.dot(p,this.m_axis)-m.dot(_,this.m_axis);case 2:var y=c.mulVec2(i.q,this.m_axis);_=l.mulVec2(i,this.m_localPoint);if(t){a=c.mulTVec2(o.q,m.neg(y));this.indexA=-1,this.indexB=this.m_proxyB.getSupport(a)}u=this.m_proxyB.getVertex(this.indexB),p=l.mulVec2(o,u);return m.dot(p,y)-m.dot(_,y);case 3:y=c.mulVec2(o.q,this.m_axis),p=l.mulVec2(o,this.m_localPoint);if(t){r=c.mulTVec2(i.q,m.neg(y));this.indexB=-1,this.indexA=this.m_proxyA.getSupport(r)}h=this.m_proxyA.getVertex(this.indexA),_=l.mulVec2(i,h);return m.dot(_,y)-m.dot(p,y);default:return s&&n.assert(!1),t&&(this.indexA=-1,this.indexB=-1),0}},x.prototype.findMinSeparation=function(t){return this.compute(!0,t)},x.prototype.evaluate=function(t){return this.compute(!1,t)}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=f;var o=i(2),n=i(7),r=i(6),a=i(4),h=i(1),m=i(0),c=i(10),u=i(9),l=i(14),_=i(3),p=(i(8),i(5),i(12),i(13),i(11));f.TYPE="revolute-joint",f._super=p,f.prototype=r(f._super.prototype);var y={lowerAngle:0,upperAngle:0,maxMotorTorque:0,motorSpeed:0,enableLimit:!1,enableMotor:!1};function f(t,e,i,s){if(!(this instanceof f))return new f(t,e,i,s);t=n(t,y),p.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=f.TYPE,this.m_localAnchorA=s?e.getLocalPoint(s):t.localAnchorA||m.zero(),this.m_localAnchorB=s?i.getLocalPoint(s):t.localAnchorB||m.zero(),this.m_referenceAngle=h.isFinite(t.referenceAngle)?t.referenceAngle:i.getAngle()-e.getAngle(),this.m_impulse=c(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new l,this.m_motorMass,this.m_limitState=0}f.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},f.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},f.prototype.getReferenceAngle=function(){return this.m_referenceAngle},f.prototype.getJointAngle=function(){var t=this.m_bodyA;return this.m_bodyB.m_sweep.a-t.m_sweep.a-this.m_referenceAngle},f.prototype.getJointSpeed=function(){var t=this.m_bodyA;return this.m_bodyB.m_angularVelocity-t.m_angularVelocity},f.prototype.isMotorEnabled=function(){return this.m_enableMotor},f.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},f.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},f.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},f.prototype.getMotorSpeed=function(){return this.m_motorSpeed},f.prototype.setMaxMotorTorque=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t},f.prototype.isLimitEnabled=function(){return this.m_enableLimit},f.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},f.prototype.getLowerLimit=function(){return this.m_lowerAngle},f.prototype.getUpperLimit=function(){return this.m_upperAngle},f.prototype.setLimits=function(t,e){s&&o.assert(t<=e),t==this.m_lowerAngle&&e==this.m_upperAngle||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)},f.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},f.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},f.prototype.getReactionForce=function(t){return m.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},f.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},f.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,c=_.neo(e),u=_.neo(o);this.m_rA=_.mulVec2(c,m.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=_.mulVec2(u,m.sub(this.m_localAnchorB,this.m_localCenterB));var l=this.m_invMassA,p=this.m_invMassB,y=this.m_invIA,f=this.m_invIB,d=y+f===0;if(this.m_mass.ex.x=l+p+this.m_rA.y*this.m_rA.y*y+this.m_rB.y*this.m_rB.y*f,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*y-this.m_rB.y*this.m_rB.x*f,this.m_mass.ez.x=-this.m_rA.y*y-this.m_rB.y*f,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=l+p+this.m_rA.x*this.m_rA.x*y+this.m_rB.x*this.m_rB.x*f,this.m_mass.ez.y=this.m_rA.x*y+this.m_rB.x*f,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=y+f,this.m_motorMass=y+f,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(0==this.m_enableMotor||d)&&(this.m_motorImpulse=0),this.m_enableLimit&&0==d){var v=o-e-this.m_referenceAngle;h.abs(this.m_upperAngle-this.m_lowerAngle)<2*a.angularSlop?this.m_limitState=3:v<=this.m_lowerAngle?(1!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=1):v>=this.m_upperAngle?(2!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=2):(this.m_limitState=0,this.m_impulse.z=0)}else this.m_limitState=0;if(t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var x=m.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(l,x),s-=y*(m.cross(this.m_rA,x)+this.m_motorImpulse+this.m_impulse.z),n.addMul(p,x),r+=f*(m.cross(this.m_rB,x)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},f.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,u=this.m_invIB,l=a+u===0;if(this.m_enableMotor&&3!=this.m_limitState&&0==l){var _=o-i-this.m_motorSpeed,p=-this.m_motorMass*_,y=this.m_motorImpulse,f=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=h.clamp(this.m_motorImpulse+p,-f,f),i-=a*(p=this.m_motorImpulse-y),o+=u*p}if(this.m_enableLimit&&0!=this.m_limitState&&0==l){var d=m.zero();d.addCombine(1,s,1,m.cross(o,this.m_rB)),d.subCombine(1,e,1,m.cross(i,this.m_rA));var v=o-i;_=c(d.x,d.y,v),p=c.neg(this.m_mass.solve33(_));if(3==this.m_limitState)this.m_impulse.add(p);else if(1==this.m_limitState){if(this.m_impulse.z+p.z<0){var x=m.combine(-1,d,this.m_impulse.z,m.neo(this.m_mass.ez.x,this.m_mass.ez.y)),g=this.m_mass.solve22(x);p.x=g.x,p.y=g.y,p.z=-this.m_impulse.z,this.m_impulse.x+=g.x,this.m_impulse.y+=g.y,this.m_impulse.z=0}else this.m_impulse.add(p)}else if(2==this.m_limitState){if(this.m_impulse.z+p.z>0){x=m.combine(-1,d,this.m_impulse.z,m.neo(this.m_mass.ez.x,this.m_mass.ez.y)),g=this.m_mass.solve22(x);p.x=g.x,p.y=g.y,p.z=-this.m_impulse.z,this.m_impulse.x+=g.x,this.m_impulse.y+=g.y,this.m_impulse.z=0}else this.m_impulse.add(p)}var b=m.neo(p.x,p.y);e.subMul(n,b),i-=a*(m.cross(this.m_rA,b)+p.z),s.addMul(r,b),o+=u*(m.cross(this.m_rB,b)+p.z)}else{(_=m.zero()).addCombine(1,s,1,m.cross(o,this.m_rB)),_.subCombine(1,e,1,m.cross(i,this.m_rA));p=this.m_mass.solve22(m.neg(_));this.m_impulse.x+=p.x,this.m_impulse.y+=p.y,e.subMul(n,p),i-=a*m.cross(this.m_rA,p),s.addMul(r,p),o+=u*m.cross(this.m_rB,p)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},f.prototype.solvePositionConstraints=function(t){var e,i=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,r=_.neo(s),c=_.neo(n),l=0,p=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&0!=this.m_limitState&&0==p){var y=n-s-this.m_referenceAngle,f=0;if(3==this.m_limitState){var d=h.clamp(y-this.m_lowerAngle,-a.maxAngularCorrection,a.maxAngularCorrection);f=-this.m_motorMass*d,l=h.abs(d)}else if(1==this.m_limitState){l=-(d=y-this.m_lowerAngle),d=h.clamp(d+a.angularSlop,-a.maxAngularCorrection,0),f=-this.m_motorMass*d}else if(2==this.m_limitState){l=d=y-this.m_upperAngle,d=h.clamp(d-a.angularSlop,0,a.maxAngularCorrection),f=-this.m_motorMass*d}s-=this.m_invIA*f,n+=this.m_invIB*f}r.set(s),c.set(n);var v=_.mulVec2(r,m.sub(this.m_localAnchorA,this.m_localCenterA)),x=_.mulVec2(c,m.sub(this.m_localAnchorB,this.m_localCenterB));(d=m.zero()).addCombine(1,o,1,x),d.subCombine(1,i,1,v),e=d.length();var g=this.m_invMassA,b=this.m_invMassB,A=this.m_invIA,B=this.m_invIB,w=new u;w.ex.x=g+b+A*v.y*v.y+B*x.y*x.y,w.ex.y=-A*v.x*v.y-B*x.x*x.y,w.ey.x=w.ex.y,w.ey.y=g+b+A*v.x*v.x+B*x.x*x.x;var S=m.neg(w.solve(d));return i.subMul(g,S),s-=A*m.cross(v,S),o.addMul(b,S),n+=B*m.cross(x,S),this.m_bodyA.c_position.c.set(i),this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c.set(o),this.m_bodyB.c_position.a=n,e<=a.linearSlop&&l<=a.angularSlop}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=f;var o=i(2),n=i(7),r=i(6),a=i(4),h=i(1),m=i(0),c=i(10),u=i(9),l=i(14),_=i(3),p=(i(8),i(5),i(12),i(13),i(11));f.TYPE="prismatic-joint",f._super=p,f.prototype=r(f._super.prototype);var y={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0};function f(t,e,i,s,o){if(!(this instanceof f))return new f(t,e,i,s,o);t=n(t,y),p.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=f.TYPE,this.m_localAnchorA=s?e.getLocalPoint(s):t.localAnchorA||m.zero(),this.m_localAnchorB=s?i.getLocalPoint(s):t.localAnchorB||m.zero(),this.m_localXAxisA=o?e.getLocalVector(o):t.localAxisA||m.neo(1,0),this.m_localXAxisA.normalize(),this.m_localYAxisA=m.cross(1,this.m_localXAxisA),this.m_referenceAngle=h.isFinite(t.referenceAngle)?t.referenceAngle:i.getAngle()-e.getAngle(),this.m_impulse=c(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=0,this.m_axis=m.zero(),this.m_perp=m.zero(),this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_axis,this.m_perp,this.m_s1,this.m_s2,this.m_a1,this.m_a2,this.m_K=new l,this.m_motorMass}f.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},f.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},f.prototype.getLocalAxisA=function(){return this.m_localXAxisA},f.prototype.getReferenceAngle=function(){return this.m_referenceAngle},f.prototype.getJointTranslation=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_bodyB.getWorldPoint(this.m_localAnchorB),i=m.sub(e,t),s=this.m_bodyA.getWorldVector(this.m_localXAxisA);return m.dot(i,s)},f.prototype.getJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB,i=_.mulVec2(t.m_xf.q,m.sub(this.m_localAnchorA,t.m_sweep.localCenter)),s=_.mulVec2(e.m_xf.q,m.sub(this.m_localAnchorB,e.m_sweep.localCenter)),o=m.add(t.m_sweep.c,i),n=m.add(e.m_sweep.c,s),r=m.sub(n,o),a=_.mulVec2(t.m_xf.q,this.m_localXAxisA),h=t.m_linearVelocity,c=e.m_linearVelocity,u=t.m_angularVelocity,l=e.m_angularVelocity;return m.dot(r,m.cross(u,a))+m.dot(a,m.sub(m.addCross(c,l,s),m.addCross(h,u,i)))},f.prototype.isLimitEnabled=function(){return this.m_enableLimit},f.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},f.prototype.getLowerLimit=function(){return this.m_lowerTranslation},f.prototype.getUpperLimit=function(){return this.m_upperTranslation},f.prototype.setLimits=function(t,e){s&&o.assert(t<=e),t==this.m_lowerTranslation&&e==this.m_upperTranslation||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)},f.prototype.isMotorEnabled=function(){return this.m_enableMotor},f.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},f.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},f.prototype.setMaxMotorForce=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=t},f.prototype.getMotorSpeed=function(){return this.m_motorSpeed},f.prototype.getMotorForce=function(t){return t*this.m_motorImpulse},f.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},f.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},f.prototype.getReactionForce=function(t){return m.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(t)},f.prototype.getReactionTorque=function(t){return t*this.m_impulse.y},f.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,u=this.m_bodyB.c_velocity.w,l=_.neo(i),p=_.neo(r),y=_.mulVec2(l,m.sub(this.m_localAnchorA,this.m_localCenterA)),f=_.mulVec2(p,m.sub(this.m_localAnchorB,this.m_localCenterB)),d=m.zero();d.addCombine(1,n,1,f),d.subCombine(1,e,1,y);var v=this.m_invMassA,x=this.m_invMassB,g=this.m_invIA,b=this.m_invIB;this.m_axis=_.mulVec2(l,this.m_localXAxisA),this.m_a1=m.cross(m.add(d,y),this.m_axis),this.m_a2=m.cross(f,this.m_axis),this.m_motorMass=v+x+g*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_perp=_.mulVec2(l,this.m_localYAxisA),this.m_s1=m.cross(m.add(d,y),this.m_perp),this.m_s2=m.cross(f,this.m_perp);m.cross(y,this.m_perp);var A=v+x+g*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2,B=g*this.m_s1+b*this.m_s2,w=g*this.m_s1*this.m_a1+b*this.m_s2*this.m_a2,S=g+b;0==S&&(S=1);var M=g*this.m_a1+b*this.m_a2,C=v+x+g*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2;if(this.m_K.ex.set(A,B,w),this.m_K.ey.set(B,S,M),this.m_K.ez.set(w,M,C),this.m_enableLimit){var I=m.dot(this.m_axis,d);h.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*a.linearSlop?this.m_limitState=3:I<=this.m_lowerTranslation?1!=this.m_limitState&&(this.m_limitState=1,this.m_impulse.z=0):I>=this.m_upperTranslation?2!=this.m_limitState&&(this.m_limitState=2,this.m_impulse.z=0):(this.m_limitState=0,this.m_impulse.z=0)}else this.m_limitState=0,this.m_impulse.z=0;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var T=m.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),P=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,V=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;s.subMul(v,T),o-=g*P,c.addMul(x,T),u+=b*V}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.set(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.set(c),this.m_bodyB.c_velocity.w=u},f.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,u=this.m_invIB;if(this.m_enableMotor&&3!=this.m_limitState){var l=m.dot(this.m_axis,m.sub(s,e))+this.m_a2*o-this.m_a1*i,_=this.m_motorMass*(this.m_motorSpeed-l),p=this.m_motorImpulse,y=t.dt*this.m_maxMotorForce;this.m_motorImpulse=h.clamp(this.m_motorImpulse+_,-y,y),_=this.m_motorImpulse-p;var f=m.mul(_,this.m_axis),d=_*this.m_a1,v=_*this.m_a2;e.subMul(n,f),i-=a*d,s.addMul(r,f),o+=u*v}var x=m.zero();if(x.x+=m.dot(this.m_perp,s)+this.m_s2*o,x.x-=m.dot(this.m_perp,e)+this.m_s1*i,x.y=o-i,this.m_enableLimit&&0!=this.m_limitState){var g=0;g+=m.dot(this.m_axis,s)+this.m_a2*o,g-=m.dot(this.m_axis,e)+this.m_a1*i;l=c(x.x,x.y,g);var b=c(this.m_impulse),A=this.m_K.solve33(c.neg(l));this.m_impulse.add(A),1==this.m_limitState?this.m_impulse.z=h.max(this.m_impulse.z,0):2==this.m_limitState&&(this.m_impulse.z=h.min(this.m_impulse.z,0));var B=m.combine(-1,x,-(this.m_impulse.z-b.z),m.neo(this.m_K.ez.x,this.m_K.ez.y)),w=m.add(this.m_K.solve22(B),m.neo(b.x,b.y));this.m_impulse.x=w.x,this.m_impulse.y=w.y,A=c.sub(this.m_impulse,b);f=m.combine(A.x,this.m_perp,A.z,this.m_axis),d=A.x*this.m_s1+A.y+A.z*this.m_a1,v=A.x*this.m_s2+A.y+A.z*this.m_a2;e.subMul(n,f),i-=a*d,s.addMul(r,f),o+=u*v}else{A=this.m_K.solve22(m.neg(x));this.m_impulse.x+=A.x,this.m_impulse.y+=A.y;f=m.mul(A.x,this.m_perp),d=A.x*this.m_s1+A.y,v=A.x*this.m_s2+A.y;e.subMul(n,f),i-=a*d,s.addMul(r,f),o+=u*v}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},f.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,n=_.neo(i),r=_.neo(o),p=this.m_invMassA,y=this.m_invMassB,f=this.m_invIA,d=this.m_invIB,v=_.mulVec2(n,m.sub(this.m_localAnchorA,this.m_localCenterA)),x=_.mulVec2(r,m.sub(this.m_localAnchorB,this.m_localCenterB)),g=m.sub(m.add(s,x),m.add(e,v)),b=_.mulVec2(n,this.m_localXAxisA),A=m.cross(m.add(g,v),b),B=m.cross(x,b),w=_.mulVec2(n,this.m_localYAxisA),S=m.cross(m.add(g,v),w),M=m.cross(x,w),C=c(),I=m.zero();I.x=m.dot(w,g),I.y=o-i-this.m_referenceAngle;var T=h.abs(I.x),P=h.abs(I.y),V=a.linearSlop,z=a.maxLinearCorrection,E=!1,F=0;if(this.m_enableLimit){var L=m.dot(b,g);h.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*V?(F=h.clamp(L,-z,z),T=h.max(T,h.abs(L)),E=!0):L<=this.m_lowerTranslation?(F=h.clamp(L-this.m_lowerTranslation+V,-z,0),T=h.max(T,this.m_lowerTranslation-L),E=!0):L>=this.m_upperTranslation&&(F=h.clamp(L-this.m_upperTranslation-V,0,z),T=h.max(T,L-this.m_upperTranslation),E=!0)}if(E){var k=p+y+f*S*S+d*M*M,D=f*S+d*M,q=f*S*A+d*M*B;0==(N=f+d)&&(N=1);var R=f*A+d*B,j=p+y+f*A*A+d*B*B;(U=new l).ex.set(k,D,q),U.ey.set(D,N,R),U.ez.set(q,R,j);var O=c();O.x=I.x,O.y=I.y,O.z=F,C=U.solve33(c.neg(O))}else{var N,U;k=p+y+f*S*S+d*M*M,D=f*S+d*M;0==(N=f+d)&&(N=1),(U=new u).ex.set(k,D),U.ey.set(D,N);var G=U.solve(m.neg(I));C.x=G.x,C.y=G.y,C.z=0}var Y=m.combine(C.x,w,C.z,b),J=C.x*S+C.y+C.z*A,W=C.x*M+C.y+C.z*B;return e.subMul(p,Y),i-=f*J,s.addMul(y,Y),o+=d*W,this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=s,this.m_bodyB.c_position.a=o,T<=a.linearSlop&&P<=a.angularSlop}},function(t,e,i){"use strict";t.exports=function(t,e){var i=0|t.length,s=0|e.length;if(1===i&&1===s)return function(t,e){var i=t+e,s=i-t,o=t-(i-s)+(e-s);if(o)return[o,i];return[i]}(t[0],e[0]);var o,n,r=new Array(i+s),a=0,h=0,m=0,c=Math.abs,u=t[h],l=c(u),_=e[m],p=c(_);l<p?(n=u,(h+=1)<i&&(u=t[h],l=c(u))):(n=_,(m+=1)<s&&(_=e[m],p=c(_)));h<i&&l<p||m>=s?(o=u,(h+=1)<i&&(u=t[h],l=c(u))):(o=_,(m+=1)<s&&(_=e[m],p=c(_)));var y,f,d=o+n,v=d-o,x=n-v,g=x,b=d;for(;h<i&&m<s;)l<p?(o=u,(h+=1)<i&&(u=t[h],l=c(u))):(o=_,(m+=1)<s&&(_=e[m],p=c(_))),(x=(n=g)-(v=(d=o+n)-o))&&(r[a++]=x),g=b-((y=b+d)-(f=y-b))+(d-f),b=y;for(;h<i;)(x=(n=g)-(v=(d=(o=u)+n)-o))&&(r[a++]=x),g=b-((y=b+d)-(f=y-b))+(d-f),b=y,(h+=1)<i&&(u=t[h]);for(;m<s;)(x=(n=g)-(v=(d=(o=_)+n)-o))&&(r[a++]=x),g=b-((y=b+d)-(f=y-b))+(d-f),b=y,(m+=1)<s&&(_=e[m]);g&&(r[a++]=g);b&&(r[a++]=b);a||(r[a++]=0);return r.length=a,r}},function(t,e,i){"use strict";var s=i(30),o=i(70);t.exports=function(t,e){var i=t.length;if(1===i){var n=s(t[0],e);return n[0]?n:[n[1]]}var r=new Array(2*i),a=[.1,.1],h=[.1,.1],m=0;s(t[0],e,a),a[0]&&(r[m++]=a[0]);for(var c=1;c<i;++c){s(t[c],e,h);var u=a[1];o(u,h[0],a),a[0]&&(r[m++]=a[0]);var l=h[1],_=a[1],p=l+_,y=_-(p-l);a[1]=p,y&&(r[m++]=y)}a[1]&&(r[m++]=a[1]);0===m&&(r[m++]=0);return r.length=m,r}},function(t,e,i){"use strict";var s,o=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var h=r(i(19)),m=a(i(20)),c=a(i(60)),u=a(i(61)),l=a(i(62)),_=a(i(63)),p={gravity:{x:0,y:3},scaleFactor:30},y=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.config=n(n({},p),s.game.config.physics.planck),s.gravity=s.config.gravity,s.scaleFactor=s.config.scaleFactor,h.Physics.Planck=s,s}return o(e,t),e.prototype.boot=function(){var t=this;this.world=new m.default.World(m.default.Vec2(this.gravity.x,this.gravity.y)),this.add={box:function(e,i,s,o,n,r){return new c.default(t.scene,e,i,s,o,n,r)},circle:function(e,i,s,o,n){return new u.default(t.scene,e,i,s,o,n)},edge:function(e,i,s,o,n){return new l.default(t.scene,e,i,s,o,n)},polygon:function(e,i,s,o,n){return new _.default(t.scene,e,i,s,o,n)}};var e=this.systems.events;e.on("postupdate",this.postUpdate,this),e.on("shutdown",this.shutdown,this),e.on("destroy",this.destroy,this),this.scene.planck=this},e.prototype.postUpdate=function(){this.world.step(1/60),this.world.clearForces()},e.prototype.shutdown=function(){},e.prototype.destroy=function(){this.shutdown()},e}(h.Plugins.ScenePlugin);e.default=y},function(t,e,i){var s=i(31),o=i(21),n=i(11),r=(i(15),0),a={Body:o,Joint:n};e.toJson=function(t,e){e=e||JSON.stringify;for(var i=[],s=[t],a={},h=function(t,e){if(t.__sid=t.__sid||++r,a[t.__sid])return a[t.__sid];s.push(t);var o={refIndex:i.length+s.length,refType:e};return a[t.__sid]=o};s.length;){var m=s.shift(),c=e(m,(function(t,e){return"object"==typeof e&&null!==e&&"function"==typeof e._serialize&&(e=e!==m&&e instanceof o?h(e,"Body"):e!==m&&e instanceof n?h(e,"Joint"):e._serialize()),e}),"  ");i.push(c)}return"["+i.join(",")+"]"},e.fromJson=function(t,e){var i=(e=e||JSON.parse)(t),o={};return s._deserialize(i[0],null,(function t(e,s,n){if(!s.refIndex)return e&&e._deserialize&&e._deserialize(s,n,t);var r=s.refIndex;if(e=a[s.refType]||e,o[r])return o[r];var h=i[r];return o[r]=e._deserialize(h,n,t)}))}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=(i(4),i(2)),n=i(1),r=i(16),a=i(32);function h(){this.m_tree=new a,this.m_proxyCount=0,this.m_moveBuffer=[],this.queryCallback=this.queryCallback.bind(this)}t.exports=h,h.prototype.getUserData=function(t){return this.m_tree.getUserData(t)},h.prototype.testOverlap=function(t,e){var i=this.m_tree.getFatAABB(t),s=this.m_tree.getFatAABB(e);return r.testOverlap(i,s)},h.prototype.getFatAABB=function(t){return this.m_tree.getFatAABB(t)},h.prototype.getProxyCount=function(){return this.m_proxyCount},h.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},h.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},h.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},h.prototype.query=function(t,e){this.m_tree.query(t,e)},h.prototype.rayCast=function(t,e){this.m_tree.rayCast(t,e)},h.prototype.shiftOrigin=function(t){this.m_tree.shiftOrigin(t)},h.prototype.createProxy=function(t,e){s&&o.assert(r.isValid(t));var i=this.m_tree.createProxy(t,e);return this.m_proxyCount++,this.bufferMove(i),i},h.prototype.destroyProxy=function(t){this.unbufferMove(t),this.m_proxyCount--,this.m_tree.destroyProxy(t)},h.prototype.moveProxy=function(t,e,i){s&&o.assert(r.isValid(e)),this.m_tree.moveProxy(t,e,i)&&this.bufferMove(t)},h.prototype.touchProxy=function(t){this.bufferMove(t)},h.prototype.bufferMove=function(t){this.m_moveBuffer.push(t)},h.prototype.unbufferMove=function(t){for(var e=0;e<this.m_moveBuffer.length;++e)this.m_moveBuffer[e]==t&&(this.m_moveBuffer[e]=null)},h.prototype.updatePairs=function(t){for(s&&o.assert("function"==typeof t),this.m_callback=t;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),null!==this.m_queryProxyId){var e=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(e,this.queryCallback)}},h.prototype.queryCallback=function(t){if(t==this.m_queryProxyId)return!0;var e=n.min(t,this.m_queryProxyId),i=n.max(t,this.m_queryProxyId),s=this.m_tree.getUserData(e),o=this.m_tree.getUserData(i);return this.m_callback(s,o),!0}},function(t,e){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=function(t){var e=[],i=t.max||1/0,s=t.create,o=t.allocate,n=t.release,r=t.discard,a=0,h=0,m=0,c=0;this.max=function(t){return"number"==typeof t?(i=t,this):i},this.size=function(){return e.length},this.allocate=function(){var t;return e.length>0?t=e.shift():(a++,t="function"==typeof s?s():{}),h++,"function"==typeof o&&o(t),t},this.release=function(t){e.length<i?(m++,"function"==typeof n&&n(t),e.push(t)):(c++,"function"==typeof r&&(t=r(t)))},this.toString=function(){return" +"+a+" >"+h+" <"+m+" -"+c+" ="+e.length+"/"+i}}},function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=d,t.exports.TimeStep=f;var n=i(4),r=i(2),a=i(0),h=i(1),m=i(21),c=i(17),u=i(11),l=i(34),_=l.Input,p=l.Output,y=i(23);y.Input,y.Output,y.Proxy,y.Cache;function f(t){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}function d(t){this.m_world=t,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}f.prototype.reset=function(t){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=0==t?0:1/t,this.dtRatio=t*this.inv_dt0},d.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},d.prototype.addBody=function(t){o&&r.assert(t instanceof m,"Not a Body!",t),this.m_bodies.push(t)},d.prototype.addContact=function(t){o&&r.assert(t instanceof c,"Not a Contact!",t),this.m_contacts.push(t)},d.prototype.addJoint=function(t){o&&r.assert(t instanceof u,"Not a Joint!",t),this.m_joints.push(t)},d.prototype.solveWorld=function(t){for(var e=this.m_world,i=e.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1;for(var s=e.m_contactList;s;s=s.m_next)s.m_islandFlag=!1;for(var n=e.m_jointList;n;n=n.m_next)n.m_islandFlag=!1;for(var a=this.m_stack,h=e.m_bodyList;h;h=h.m_next)if(!h.m_islandFlag&&0!=h.isAwake()&&0!=h.isActive()&&!h.isStatic()){for(this.clear(),a.push(h),h.m_islandFlag=!0;a.length>0;){i=a.pop();if(o&&r.assert(1==i.isActive()),this.addBody(i),i.setAwake(!0),!i.isStatic()){for(var m=i.m_contactList;m;m=m.next){var c=m.contact;if(!c.m_islandFlag&&(0!=c.isEnabled()&&0!=c.isTouching())){var u=c.m_fixtureA.m_isSensor,l=c.m_fixtureB.m_isSensor;if(!u&&!l)this.addContact(c),c.m_islandFlag=!0,(p=m.other).m_islandFlag||(a.push(p),p.m_islandFlag=!0)}}for(var _=i.m_jointList;_;_=_.next){var p;if(1!=_.joint.m_islandFlag)0!=(p=_.other).isActive()&&(this.addJoint(_.joint),_.joint.m_islandFlag=!0,p.m_islandFlag||(a.push(p),p.m_islandFlag=!0))}}}this.solveIsland(t);for(var y=0;y<this.m_bodies.length;++y){(i=this.m_bodies[y]).isStatic()&&(i.m_islandFlag=!1)}}},d.prototype.solveIsland=function(t){for(var e=this.m_world,i=e.m_gravity,o=e.m_allowSleep,r=t.dt,m=0;m<this.m_bodies.length;++m){var c=this.m_bodies[m],u=a.clone(c.m_sweep.c),l=c.m_sweep.a,_=a.clone(c.m_linearVelocity),p=c.m_angularVelocity;c.m_sweep.c0.set(c.m_sweep.c),c.m_sweep.a0=c.m_sweep.a,c.isDynamic()&&(_.addMul(r*c.m_gravityScale,i),_.addMul(r*c.m_invMass,c.m_force),p+=r*c.m_invI*c.m_torque,_.mul(1/(1+r*c.m_linearDamping)),p*=1/(1+r*c.m_angularDamping)),c.c_position.c=u,c.c_position.a=l,c.c_velocity.v=_,c.c_velocity.w=p}for(m=0;m<this.m_contacts.length;++m){this.m_contacts[m].initConstraint(t)}s&&this.printBodies("M: ");for(m=0;m<this.m_contacts.length;++m){this.m_contacts[m].initVelocityConstraint(t)}if(s&&this.printBodies("R: "),t.warmStarting)for(m=0;m<this.m_contacts.length;++m){this.m_contacts[m].warmStartConstraint(t)}s&&this.printBodies("Q: ");for(m=0;m<this.m_joints.length;++m){this.m_joints[m].initVelocityConstraints(t)}s&&this.printBodies("E: ");for(m=0;m<t.velocityIterations;++m){for(var y=0;y<this.m_joints.length;++y){this.m_joints[y].solveVelocityConstraints(t)}for(y=0;y<this.m_contacts.length;++y){this.m_contacts[y].solveVelocityConstraint(t)}}s&&this.printBodies("D: ");for(m=0;m<this.m_contacts.length;++m){this.m_contacts[m].storeConstraintImpulses(t)}s&&this.printBodies("C: ");for(m=0;m<this.m_bodies.length;++m){c=this.m_bodies[m],u=a.clone(c.c_position.c),l=c.c_position.a,_=a.clone(c.c_velocity.v),p=c.c_velocity.w;var f=a.mul(r,_);if(a.lengthSquared(f)>n.maxTranslationSquared){var d=n.maxTranslation/f.length();_.mul(d)}var v=r*p;if(v*v>n.maxRotationSquared)p*=d=n.maxRotation/h.abs(v);u.addMul(r,_),l+=r*p,c.c_position.c.set(u),c.c_position.a=l,c.c_velocity.v.set(_),c.c_velocity.w=p}s&&this.printBodies("B: ");var x=!1;for(m=0;m<t.positionIterations;++m){var g=0;for(y=0;y<this.m_contacts.length;++y){var b=this.m_contacts[y].solvePositionConstraint(t);g=h.min(g,b)}var A=g>=-3*n.linearSlop,B=!0;for(y=0;y<this.m_joints.length;++y){var w=this.m_joints[y].solvePositionConstraints(t);B=B&&w}if(A&&B){x=!0;break}}s&&this.printBodies("L: ");for(m=0;m<this.m_bodies.length;++m){(c=this.m_bodies[m]).m_sweep.c.set(c.c_position.c),c.m_sweep.a=c.c_position.a,c.m_linearVelocity.set(c.c_velocity.v),c.m_angularVelocity=c.c_velocity.w,c.synchronizeTransform()}if(this.postSolveIsland(),o){var S=1/0,M=n.linearSleepToleranceSqr,C=n.angularSleepToleranceSqr;for(m=0;m<this.m_bodies.length;++m){(c=this.m_bodies[m]).isStatic()||(0==c.m_autoSleepFlag||c.m_angularVelocity*c.m_angularVelocity>C||a.lengthSquared(c.m_linearVelocity)>M?(c.m_sleepTime=0,S=0):(c.m_sleepTime+=r,S=h.min(S,c.m_sleepTime)))}if(S>=n.timeToSleep&&x)for(m=0;m<this.m_bodies.length;++m){(c=this.m_bodies[m]).setAwake(!1)}}},d.prototype.printBodies=function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[e];r.debug(t,i.c_position.a,i.c_position.c.x,i.c_position.c.y,i.c_velocity.w,i.c_velocity.v.x,i.c_velocity.v.y)}};var v=new f;function x(){this.normalImpulses=[],this.tangentImpulses=[]}d.prototype.solveWorldTOI=function(t){var e=this.m_world;if(e.m_stepComplete){for(var i=e.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1,i.m_sweep.alpha0=0;for(var a=e.m_contactList;a;a=a.m_next)a.m_toiFlag=!1,a.m_islandFlag=!1,a.m_toiCount=0,a.m_toi=1}for(;;){var m=null,c=1;for(a=e.m_contactList;a;a=a.m_next)if(0!=a.isEnabled()&&!(a.m_toiCount>n.maxSubSteps)){var u=1;if(a.m_toiFlag)u=a.m_toi;else{var y=a.getFixtureA(),f=a.getFixtureB();if(y.isSensor()||f.isSensor())continue;var d=y.getBody(),x=f.getBody();o&&r.assert(d.isDynamic()||x.isDynamic());var g=d.isAwake()&&!d.isStatic(),b=x.isAwake()&&!x.isStatic();if(0==g&&0==b)continue;var A=d.isBullet()||!d.isDynamic(),B=x.isBullet()||!x.isDynamic();if(0==A&&0==B)continue;var w=d.m_sweep.alpha0;d.m_sweep.alpha0<x.m_sweep.alpha0?(w=x.m_sweep.alpha0,d.m_sweep.advance(w)):x.m_sweep.alpha0<d.m_sweep.alpha0&&(w=d.m_sweep.alpha0,x.m_sweep.advance(w)),o&&r.assert(w<1);var S=a.getChildIndexA(),M=a.getChildIndexB(),C=(d.m_sweep,x.m_sweep,new _);C.proxyA.set(y.getShape(),S),C.proxyB.set(f.getShape(),M),C.sweepA.set(d.m_sweep),C.sweepB.set(x.m_sweep),C.tMax=1;var I=new p;l(I,C);var T=I.t;u=I.state==p.e_touching?h.min(w+(1-w)*T,1):1,a.m_toi=u,a.m_toiFlag=!0}u<c&&(m=a,c=u)}if(null==m||1-10*h.EPSILON<c){e.m_stepComplete=!0;break}y=m.getFixtureA(),f=m.getFixtureB(),d=y.getBody(),x=f.getBody();var P=d.m_sweep.clone(),V=x.m_sweep.clone();if(d.advance(c),x.advance(c),m.update(e),m.m_toiFlag=!1,++m.m_toiCount,0!=m.isEnabled()&&0!=m.isTouching()){d.setAwake(!0),x.setAwake(!0),this.clear(),this.addBody(d),this.addBody(x),this.addContact(m),d.m_islandFlag=!0,x.m_islandFlag=!0,m.m_islandFlag=!0;for(var z=[d,x],E=0;E<z.length;++E){if((j=z[E]).isDynamic())for(var F=j.m_contactList;F;F=F.next){var L=F.contact;if(!L.m_islandFlag){var k=F.other;if(!k.isDynamic()||j.isBullet()||k.isBullet()){var D=L.m_fixtureA.m_isSensor,q=L.m_fixtureB.m_isSensor;if(!D&&!q){var R=k.m_sweep.clone();0==k.m_islandFlag&&k.advance(c),L.update(e),0!=L.isEnabled()&&0!=L.isTouching()?(L.m_islandFlag=!0,this.addContact(L),k.m_islandFlag||(k.m_islandFlag=!0,k.isStatic()||k.setAwake(!0),this.addBody(k))):(k.m_sweep.set(R),k.synchronizeTransform())}}}}}v.reset((1-c)*t.dt),v.dtRatio=1,v.positionIterations=20,v.velocityIterations=t.velocityIterations,v.warmStarting=!1,this.solveIslandTOI(v,d,x);for(E=0;E<this.m_bodies.length;++E){var j;if((j=this.m_bodies[E]).m_islandFlag=!1,j.isDynamic()){j.synchronizeFixtures();for(F=j.m_contactList;F;F=F.next)F.contact.m_toiFlag=!1,F.contact.m_islandFlag=!1}}if(e.findNewContacts(),e.m_subStepping){e.m_stepComplete=!1;break}}else m.setEnabled(!1),d.m_sweep.set(P),x.m_sweep.set(V),d.synchronizeTransform(),x.synchronizeTransform()}if(s)for(i=e.m_bodyList;i;i=i.m_next)a=i.m_sweep.c,i.m_sweep.a,i.m_linearVelocity,i.m_angularVelocity},d.prototype.solveIslandTOI=function(t,e,i){this.m_world;for(var s=0;s<this.m_bodies.length;++s){(u=this.m_bodies[s]).c_position.c.set(u.m_sweep.c),u.c_position.a=u.m_sweep.a,u.c_velocity.v.set(u.m_linearVelocity),u.c_velocity.w=u.m_angularVelocity}for(var s=0;s<this.m_contacts.length;++s){this.m_contacts[s].initConstraint(t)}for(s=0;s<t.positionIterations;++s){for(var o=0,r=0;r<this.m_contacts.length;++r){var m=this.m_contacts[r].solvePositionConstraintTOI(t,e,i);o=h.min(o,m)}if(o>=-1.5*n.linearSlop)break}e.m_sweep.c0.set(e.c_position.c),e.m_sweep.a0=e.c_position.a,i.m_sweep.c0.set(i.c_position.c),i.m_sweep.a0=i.c_position.a;for(s=0;s<this.m_contacts.length;++s){this.m_contacts[s].initVelocityConstraint(t)}for(s=0;s<t.velocityIterations;++s)for(r=0;r<this.m_contacts.length;++r){this.m_contacts[r].solveVelocityConstraint(t)}var c=t.dt;for(s=0;s<this.m_bodies.length;++s){var u=this.m_bodies[s],l=a.clone(u.c_position.c),_=u.c_position.a,p=a.clone(u.c_velocity.v),y=u.c_velocity.w,f=a.mul(c,p);if(a.dot(f,f)>n.maxTranslationSquared){var d=n.maxTranslation/f.length();p.mul(d)}var v=c*y;if(v*v>n.maxRotationSquared)y*=d=n.maxRotation/h.abs(v);l.addMul(c,p),_+=c*y,u.c_position.c=l,u.c_position.a=_,u.c_velocity.v=p,u.c_velocity.w=y,u.m_sweep.c=l,u.m_sweep.a=_,u.m_linearVelocity=p,u.m_angularVelocity=y,u.synchronizeTransform()}this.postSolveIsland()},d.prototype.postSolveIsland=function(){for(var t=new x,e=0;e<this.m_contacts.length;++e){for(var i=this.m_contacts[e],s=0;s<i.v_points.length;++s)t.normalImpulses.push(i.v_points[s].normalImpulse),t.tangentImpulses.push(i.v_points[s].tangentImpulse);this.m_world.postSolve(i,t)}}},function(t,e){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports.now=function(){return Date.now()},t.exports.diff=function(t){return Date.now()-t}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=n;i(2);var s=i(6),o=i(22);function n(t,e,i,s){if(!(this instanceof n))return new n(t,e,i,s);n._super.call(this),this._setAsBox(t,e,i,s)}n._super=o,n.prototype=s(n._super.prototype),n.TYPE="polygon"},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(2),n=(i(6),i(1),i(5)),r=i(0),a=(i(4),i(15),i(17)),h=i(18),m=i(24);function c(t,e,i,s,o){t.pointCount=0;var a=n.mulVec2(i,e.m_p),m=n.mulVec2(o,s.m_p),c=r.distanceSquared(m,a),u=e.m_radius+s.m_radius;c>u*u||(t.type=h.e_circles,t.localPoint.set(e.m_p),t.localNormal.setZero(),t.pointCount=1,t.points[0].localPoint.set(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex)}a.addType(m.TYPE,m.TYPE,(function(t,e,i,n,r,a,h){s&&o.assert(i.getType()==m.TYPE),s&&o.assert(a.getType()==m.TYPE),c(t,i.getShape(),e,a.getShape(),r)})),e.CollideCircles=c},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(2),n=(i(6),i(1),i(5)),r=i(0),a=(i(3),i(4),i(15),i(17)),h=i(18),m=i(25),c=i(28),u=i(24);function l(t,e,i,a,m){t.pointCount=0;var c=n.mulTVec2(i,n.mulVec2(m,a.m_p)),u=e.m_vertex1,l=e.m_vertex2,_=r.sub(l,u),p=r.dot(_,r.sub(l,c)),y=r.dot(_,r.sub(c,u)),f=e.m_radius+a.m_radius;if(y<=0){var d=r.clone(u),v=r.sub(c,d);if(r.dot(v,v)>f*f)return;if(e.m_hasVertex0){var x=e.m_vertex0,g=u,b=r.sub(g,x);if(r.dot(b,r.sub(g,c))>0)return}return t.type=h.e_circles,t.localNormal.setZero(),t.localPoint.set(d),t.pointCount=1,t.points[0].localPoint.set(a.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,void(t.points[0].id.cf.typeB=h.e_vertex)}if(p<=0){d=r.clone(l),v=r.sub(c,d);if(r.dot(v,v)>f*f)return;if(e.m_hasVertex3){var A=e.m_vertex3,B=l,w=r.sub(A,B);if(r.dot(w,r.sub(c,B))>0)return}return t.type=h.e_circles,t.localNormal.setZero(),t.localPoint.set(d),t.pointCount=1,t.points[0].localPoint.set(a.m_p),t.points[0].id.cf.indexA=1,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,void(t.points[0].id.cf.typeB=h.e_vertex)}var S=r.dot(_,_);s&&o.assert(S>0);d=r.combine(p/S,u,y/S,l),v=r.sub(c,d);if(!(r.dot(v,v)>f*f)){var M=r.neo(-_.y,_.x);r.dot(M,r.sub(c,u))<0&&M.set(-M.x,-M.y),M.normalize(),t.type=h.e_faceA,t.localNormal=M,t.localPoint.set(u),t.pointCount=1,t.points[0].localPoint.set(a.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_face,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex}}a.addType(m.TYPE,u.TYPE,(function(t,e,i,n,r,a,h){s&&o.assert(i.getType()==m.TYPE),s&&o.assert(a.getType()==u.TYPE);var c=i.getShape(),_=a.getShape();l(t,c,e,_,r)})),a.addType(c.TYPE,u.TYPE,(function(t,e,i,n,r,a,h){s&&o.assert(i.getType()==c.TYPE),s&&o.assert(a.getType()==u.TYPE);var _=i.getShape(),p=new m;_.getChildEdge(p,n);var y=p,f=a.getShape();l(t,y,e,f,r)}))},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(2),n=(i(1),i(5)),r=i(3),a=i(0),h=(i(16),i(4)),m=i(18),c=i(17),u=(i(15),i(22));function l(t,e,i,s){for(var o=t.m_count,h=i.m_count,m=t.m_normals,c=t.m_vertices,u=i.m_vertices,_=n.mulTXf(s,e),p=0,y=-1/0,f=0;f<o;++f){for(var d=r.mulVec2(_.q,m[f]),v=n.mulVec2(_,c[f]),x=1/0,g=0;g<h;++g){var b=a.dot(d,u[g])-a.dot(d,v);b<x&&(x=b)}x>y&&(y=x,p=f)}l._maxSeparation=y,l._bestIndex=p}function _(t,e,i,c,u){t.pointCount=0;var _=e.m_radius+c.m_radius;l(e,i,c,u);var p=l._bestIndex,y=l._maxSeparation;if(!(y>_)){l(c,u,e,i);var f=l._bestIndex,d=l._maxSeparation;if(!(d>_)){var v,x,g,b,A,B;d>y+.1*h.linearSlop?(v=c,x=e,g=u,b=i,A=f,t.type=m.e_faceB,B=1):(v=e,x=c,g=i,b=u,A=p,t.type=m.e_faceA,B=0);var w=[new m.clipVertex,new m.clipVertex];!function(t,e,i,h,c,u){var l=e.m_normals,_=c.m_count,p=c.m_vertices,y=c.m_normals;s&&o.assert(0<=h&&h<e.m_count);for(var f=r.mulT(u.q,r.mulVec2(i.q,l[h])),d=0,v=1/0,x=0;x<_;++x){var g=a.dot(f,y[x]);g<v&&(v=g,d=x)}var b=d,A=b+1<_?b+1:0;t[0].v=n.mulVec2(u,p[b]),t[0].id.cf.indexA=h,t[0].id.cf.indexB=b,t[0].id.cf.typeA=m.e_face,t[0].id.cf.typeB=m.e_vertex,t[1].v=n.mulVec2(u,p[A]),t[1].id.cf.indexA=h,t[1].id.cf.indexB=A,t[1].id.cf.typeA=m.e_face,t[1].id.cf.typeB=m.e_vertex}(w,v,g,A,x,b);var S=v.m_count,M=v.m_vertices,C=A,I=A+1<S?A+1:0,T=M[C],P=M[I],V=a.sub(P,T);V.normalize();var z=a.cross(V,1),E=a.combine(.5,T,.5,P),F=r.mulVec2(g.q,V),L=a.cross(F,1);T=n.mulVec2(g,T),P=n.mulVec2(g,P);var k=a.dot(L,T),D=-a.dot(F,T)+_,q=a.dot(F,P)+_,R=[new m.clipVertex,new m.clipVertex],j=[new m.clipVertex,new m.clipVertex];if(!(m.clipSegmentToLine(R,w,a.neg(F),D,C)<2||m.clipSegmentToLine(j,R,F,q,I)<2)){t.localNormal=z,t.localPoint=E;for(var O=0,N=0;N<j.length;++N){if(a.dot(L,j[N].v)-k<=_){var U=t.points[O];if(U.localPoint.set(n.mulTVec2(b,j[N].v)),U.id=j[N].id,B){var G=U.id.cf,Y=G.indexA,J=G.indexB,W=G.typeA,H=G.typeB;G.indexA=J,G.indexB=Y,G.typeA=H,G.typeB=W}++O}}t.pointCount=O}}}}t.exports=_,c.addType(u.TYPE,u.TYPE,(function(t,e,i,n,r,a,h){s&&o.assert(i.getType()==u.TYPE),s&&o.assert(a.getType()==u.TYPE),_(t,i.getShape(),e,a.getShape(),r)}))},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(2),n=i(1),r=i(5),a=(i(3),i(0)),h=(i(16),i(4),i(18)),m=i(17),c=(i(15),i(24)),u=i(22);m.addType(u.TYPE,c.TYPE,(function(t,e,i,m,l,_,p){s&&o.assert(i.getType()==u.TYPE),s&&o.assert(_.getType()==c.TYPE),function(t,e,i,s,o){t.pointCount=0;for(var m=r.mulVec2(o,s.m_p),c=r.mulTVec2(i,m),u=0,l=-1/0,_=e.m_radius+s.m_radius,p=e.m_count,y=e.m_vertices,f=e.m_normals,d=0;d<p;++d){var v=a.dot(f[d],a.sub(c,y[d]));if(v>_)return;v>l&&(l=v,u=d)}var x=u,g=x+1<p?x+1:0,b=y[x],A=y[g];if(l<n.EPSILON)return t.pointCount=1,t.type=h.e_faceA,t.localNormal.set(f[u]),t.localPoint.setCombine(.5,b,.5,A),t.points[0].localPoint=s.m_p,t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,void(t.points[0].id.cf.typeB=h.e_vertex);var B=a.dot(a.sub(c,b),a.sub(A,b)),w=a.dot(a.sub(c,A),a.sub(b,A));if(B<=0){if(a.distanceSquared(c,b)>_*_)return;t.pointCount=1,t.type=h.e_faceA,t.localNormal.setCombine(1,c,-1,b),t.localNormal.normalize(),t.localPoint=b,t.points[0].localPoint.set(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex}else if(w<=0){if(a.distanceSquared(c,A)>_*_)return;t.pointCount=1,t.type=h.e_faceA,t.localNormal.setCombine(1,c,-1,A),t.localNormal.normalize(),t.localPoint.set(A),t.points[0].localPoint.set(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex}else{var S=a.mid(b,A);if((l=a.dot(c,f[x])-a.dot(S,f[x]))>_)return;t.pointCount=1,t.type=h.e_faceA,t.localNormal.set(f[x]),t.localPoint.set(S),t.points[0].localPoint.set(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex}}(t,i.getShape(),e,_.getShape(),l)}))},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(2),n=(i(6),i(1)),r=i(5),a=i(0),h=i(3),m=i(4),c=(i(15),i(17)),u=i(18),l=i(25),_=i(28),p=i(22);c.addType(l.TYPE,p.TYPE,(function(t,e,i,n,r,a,h){s&&o.assert(i.getType()==l.TYPE),s&&o.assert(a.getType()==p.TYPE),g(t,i.getShape(),e,a.getShape(),r)})),c.addType(_.TYPE,p.TYPE,(function(t,e,i,n,r,a,h){s&&o.assert(i.getType()==_.TYPE),s&&o.assert(a.getType()==p.TYPE);var m=i.getShape(),c=new l;m.getChildEdge(c,n),g(t,c,e,a.getShape(),r)}));function y(){this.type,this.index,this.separation}var f=new y,d=new y,v=new function(){this.vertices=[],this.normals=[],this.count=0},x=new function(){this.i1,this.i2,this.v1,this.v2,this.normal=a.zero(),this.sideNormal1=a.zero(),this.sideOffset1,this.sideNormal2=a.zero(),this.sideOffset2};function g(t,e,i,s,o){var c=r.mulTXf(i,o),l=r.mulVec2(c,s.m_centroid),_=e.m_vertex0,p=e.m_vertex1,y=e.m_vertex2,g=e.m_vertex3,b=e.m_hasVertex0,A=e.m_hasVertex3,B=a.sub(y,p);B.normalize();var w,S=a.neo(B.y,-B.x),M=a.dot(S,a.sub(l,p)),C=0,I=0,T=!1,P=!1;if(b){var V=a.sub(p,_);V.normalize();var z=a.neo(V.y,-V.x);T=a.cross(V,B)>=0,C=a.dot(z,l)-a.dot(z,_)}if(A){var E=a.sub(g,y);E.normalize();var F=a.neo(E.y,-E.x);P=a.cross(B,E)>0,I=a.dot(F,l)-a.dot(F,y)}var L=a.zero(),k=a.zero(),D=a.zero();b&&A?T&&P?(w=C>=0||M>=0||I>=0)?(L.set(S),k.set(z),D.set(F)):(L.setMul(-1,S),k.setMul(-1,S),D.setMul(-1,S)):T?(w=C>=0||M>=0&&I>=0)?(L.set(S),k.set(z),D.set(S)):(L.setMul(-1,S),k.setMul(-1,F),D.setMul(-1,S)):P?(w=I>=0||C>=0&&M>=0)?(L.set(S),k.set(S),D.set(F)):(L.setMul(-1,S),k.setMul(-1,S),D.setMul(-1,z)):(w=C>=0&&M>=0&&I>=0)?(L.set(S),k.set(S),D.set(S)):(L.setMul(-1,S),k.setMul(-1,F),D.setMul(-1,z)):b?T?(w=C>=0||M>=0)?(L.set(S),k.set(z),D.setMul(-1,S)):(L.setMul(-1,S),k.set(S),D.setMul(-1,S)):(w=C>=0&&M>=0)?(L.set(S),k.set(S),D.setMul(-1,S)):(L.setMul(-1,S),k.set(S),D.setMul(-1,z)):A?P?(w=M>=0||I>=0)?(L.set(S),k.setMul(-1,S),D.set(F)):(L.setMul(-1,S),k.setMul(-1,S),D.set(S)):(w=M>=0&&I>=0)?(L.set(S),k.setMul(-1,S),D.set(S)):(L.setMul(-1,S),k.setMul(-1,F),D.set(S)):(w=M>=0)?(L.set(S),k.setMul(-1,S),D.setMul(-1,S)):(L.setMul(-1,S),k.set(S),D.set(S)),v.count=s.m_count;for(var q=0;q<s.m_count;++q)v.vertices[q]=r.mulVec2(c,s.m_vertices[q]),v.normals[q]=h.mulVec2(c.q,s.m_normals[q]);var R=2*m.polygonRadius;t.pointCount=0,f.type=1,f.index=w?0:1,f.separation=1/0;for(q=0;q<v.count;++q){(O=a.dot(L,a.sub(v.vertices[q],p)))<f.separation&&(f.separation=O)}if(-1!=f.type&&!(f.separation>R)){d.type=-1,d.index=-1,d.separation=-1/0;var j=a.neo(-L.y,L.x);for(q=0;q<v.count;++q){var O,N=a.neg(v.normals[q]),U=a.dot(N,a.sub(v.vertices[q],p)),G=a.dot(N,a.sub(v.vertices[q],y));if((O=n.min(U,G))>R){d.type=2,d.index=q,d.separation=O;break}if(a.dot(N,j)>=0){if(a.dot(a.sub(N,D),L)<-m.angularSlop)continue}else if(a.dot(a.sub(N,k),L)<-m.angularSlop)continue;O>d.separation&&(d.type=2,d.index=q,d.separation=O)}if(!(-1!=d.type&&d.separation>R)){var Y;Y=-1==d.type?f:d.separation>.98*f.separation+.001?d:f;var J=[new u.clipVertex,new u.clipVertex];if(1==Y.type){t.type=u.e_faceA;var W=0,H=a.dot(L,v.normals[0]);for(q=1;q<v.count;++q){var Z=a.dot(L,v.normals[q]);Z<H&&(H=Z,W=q)}var X=W,K=X+1<v.count?X+1:0;J[0].v=v.vertices[X],J[0].id.cf.indexA=0,J[0].id.cf.indexB=X,J[0].id.cf.typeA=u.e_face,J[0].id.cf.typeB=u.e_vertex,J[1].v=v.vertices[K],J[1].id.cf.indexA=0,J[1].id.cf.indexB=K,J[1].id.cf.typeA=u.e_face,J[1].id.cf.typeB=u.e_vertex,w?(x.i1=0,x.i2=1,x.v1=p,x.v2=y,x.normal.set(S)):(x.i1=1,x.i2=0,x.v1=y,x.v2=p,x.normal.setMul(-1,S))}else t.type=u.e_faceB,J[0].v=p,J[0].id.cf.indexA=0,J[0].id.cf.indexB=Y.index,J[0].id.cf.typeA=u.e_vertex,J[0].id.cf.typeB=u.e_face,J[1].v=y,J[1].id.cf.indexA=0,J[1].id.cf.indexB=Y.index,J[1].id.cf.typeA=u.e_vertex,J[1].id.cf.typeB=u.e_face,x.i1=Y.index,x.i2=x.i1+1<v.count?x.i1+1:0,x.v1=v.vertices[x.i1],x.v2=v.vertices[x.i2],x.normal.set(v.normals[x.i1]);x.sideNormal1.set(x.normal.y,-x.normal.x),x.sideNormal2.setMul(-1,x.sideNormal1),x.sideOffset1=a.dot(x.sideNormal1,x.v1),x.sideOffset2=a.dot(x.sideNormal2,x.v2);var Q=[new u.clipVertex,new u.clipVertex],$=[new u.clipVertex,new u.clipVertex];if(!(u.clipSegmentToLine(Q,J,x.sideNormal1,x.sideOffset1,x.i1)<m.maxManifoldPoints||u.clipSegmentToLine($,Q,x.sideNormal2,x.sideOffset2,x.i2)<m.maxManifoldPoints)){1==Y.type?(t.localNormal=a.clone(x.normal),t.localPoint=a.clone(x.v1)):(t.localNormal=a.clone(s.m_normals[x.i1]),t.localPoint=a.clone(s.m_vertices[x.i1]));var tt=0;for(q=0;q<m.maxManifoldPoints;++q){if(a.dot(x.normal,a.sub($[q].v,x.v1))<=R){var et=t.points[tt];1==Y.type?(et.localPoint=r.mulT(c,$[q].v),et.id=$[q].id):(et.localPoint=$[q].v,et.id.cf.typeA=$[q].id.cf.typeB,et.id.cf.typeB=$[q].id.cf.typeA,et.id.cf.indexA=$[q].id.cf.indexB,et.id.cf.indexB=$[q].id.cf.indexA),++tt}}t.pointCount=tt}}}}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=l;var s=i(7),o=i(6),n=i(4),r=i(1),a=i(0),h=(i(10),i(9),i(14),i(3)),m=(i(8),i(5),i(12),i(13),i(11)),c=i(21);l.TYPE="distance-joint",m.TYPES[l.TYPE]=l,l._super=m,l.prototype=o(l._super.prototype);var u={frequencyHz:0,dampingRatio:0};function l(t,e,i,o,n){if(!(this instanceof l))return new l(t,e,i,o,n);if(i&&o&&"m_type"in o&&"x"in i&&"y"in i){var h=i;i=o,o=h}t=s(t,u),m.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=l.TYPE,this.m_localAnchorA=o?e.getLocalPoint(o):t.localAnchorA||a.zero(),this.m_localAnchorB=n?i.getLocalPoint(n):t.localAnchorB||a.zero(),this.m_length=r.isFinite(t.length)?t.length:a.distance(e.getWorldPoint(this.m_localAnchorA),i.getWorldPoint(this.m_localAnchorB)),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0,this.m_u,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}l.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}},l._deserialize=function(t,e,i){return t.bodyA=i(c,t.bodyA,e),t.bodyB=i(c,t.bodyB,e),new l(t)},l.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},l.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},l.prototype.setLength=function(t){this.m_length=t},l.prototype.getLength=function(){return this.m_length},l.prototype.setFrequency=function(t){this.m_frequencyHz=t},l.prototype.getFrequency=function(){return this.m_frequencyHz},l.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},l.prototype.getDampingRatio=function(){return this.m_dampingRatio},l.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},l.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},l.prototype.getReactionForce=function(t){return a.mul(this.m_impulse,this.m_u).mul(t)},l.prototype.getReactionTorque=function(t){return 0},l.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_position.c,c=this.m_bodyB.c_position.a,u=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,_=h.neo(i),p=h.neo(c);this.m_rA=h.mulVec2(_,a.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=h.mulVec2(p,a.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=a.sub(a.add(m,this.m_rB),a.add(e,this.m_rA));var y=this.m_u.length();y>n.linearSlop?this.m_u.mul(1/y):this.m_u.set(0,0);var f=a.cross(this.m_rA,this.m_u),d=a.cross(this.m_rB,this.m_u),v=this.m_invMassA+this.m_invIA*f*f+this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=0!=v?1/v:0,this.m_frequencyHz>0){var x=y-this.m_length,g=2*r.PI*this.m_frequencyHz,b=2*this.m_mass*this.m_dampingRatio*g,A=this.m_mass*g*g,B=t.dt;this.m_gamma=B*(b+B*A),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=x*B*A*this.m_gamma,v+=this.m_gamma,this.m_mass=0!=v?1/v:0}else this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse*=t.dtRatio;var w=a.mul(this.m_impulse,this.m_u);s.subMul(this.m_invMassA,w),o-=this.m_invIA*a.cross(this.m_rA,w),u.addMul(this.m_invMassB,w),l+=this.m_invIB*a.cross(this.m_rB,w)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.set(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.set(u),this.m_bodyB.c_velocity.w=l},l.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=a.add(e,a.cross(i,this.m_rA)),r=a.add(s,a.cross(o,this.m_rB)),h=a.dot(this.m_u,r)-a.dot(this.m_u,n),m=-this.m_mass*(h+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=m;var c=a.mul(m,this.m_u);e.subMul(this.m_invMassA,c),i-=this.m_invIA*a.cross(this.m_rA,c),s.addMul(this.m_invMassB,c),o+=this.m_invIB*a.cross(this.m_rB,c),this.m_bodyA.c_velocity.v.set(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.set(s),this.m_bodyB.c_velocity.w=o},l.prototype.solvePositionConstraints=function(t){if(this.m_frequencyHz>0)return!0;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,m=h.neo(i),c=h.neo(o),u=h.mulSub(m,this.m_localAnchorA,this.m_localCenterA),l=h.mulSub(c,this.m_localAnchorB,this.m_localCenterB),_=a.sub(a.add(s,l),a.add(e,u)),p=_.normalize()-this.m_length;p=r.clamp(p,-n.maxLinearCorrection,n.maxLinearCorrection);var y=-this.m_mass*p,f=a.mul(y,_);return e.subMul(this.m_invMassA,f),i-=this.m_invIA*a.cross(u,f),s.addMul(this.m_invMassB,f),o+=this.m_invIB*a.cross(l,f),this.m_bodyA.c_position.c.set(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.set(s),this.m_bodyB.c_position.a=o,r.abs(p)<n.linearSlop}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=_;var o=i(2),n=i(7),r=i(6),a=(i(4),i(1)),h=i(0),m=(i(10),i(9)),c=(i(14),i(3)),u=(i(8),i(5),i(12),i(13),i(11));_.TYPE="friction-joint",_._super=u,_.prototype=r(_._super.prototype);var l={maxForce:0,maxTorque:0};function _(t,e,i,s){if(!(this instanceof _))return new _(t,e,i,s);t=n(t,l),u.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=_.TYPE,this.m_localAnchorA=s?e.getLocalPoint(s):t.localAnchorA||h.zero(),this.m_localAnchorB=s?i.getLocalPoint(s):t.localAnchorB||h.zero(),this.m_linearImpulse=h.zero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_linearMass,this.m_angularMass}_.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},_.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},_.prototype.setMaxForce=function(t){s&&o.assert(a.isFinite(t)&&t>=0),this.m_maxForce=t},_.prototype.getMaxForce=function(){return this.m_maxForce},_.prototype.setMaxTorque=function(t){s&&o.assert(a.isFinite(t)&&t>=0),this.m_maxTorque=t},_.prototype.getMaxTorque=function(){return this.m_maxTorque},_.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},_.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},_.prototype.getReactionForce=function(t){return h.mul(t,this.m_linearImpulse)},_.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},_.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=c.neo(e),u=c.neo(o);this.m_rA=c.mulVec2(a,h.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=c.mulVec2(u,h.sub(this.m_localAnchorB,this.m_localCenterB));var l=this.m_invMassA,_=this.m_invMassB,p=this.m_invIA,y=this.m_invIB,f=new m;if(f.ex.x=l+_+p*this.m_rA.y*this.m_rA.y+y*this.m_rB.y*this.m_rB.y,f.ex.y=-p*this.m_rA.x*this.m_rA.y-y*this.m_rB.x*this.m_rB.y,f.ey.x=f.ex.y,f.ey.y=l+_+p*this.m_rA.x*this.m_rA.x+y*this.m_rB.x*this.m_rB.x,this.m_linearMass=f.getInverse(),this.m_angularMass=p+y,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var d=h.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);i.subMul(l,d),s-=p*(h.cross(this.m_rA,d)+this.m_angularImpulse),n.addMul(_,d),r+=y*(h.cross(this.m_rB,d)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},_.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,c=this.m_invIA,u=this.m_invIB,l=t.dt,_=o-i,p=-this.m_angularMass*_,y=this.m_angularImpulse,f=l*this.m_maxTorque;this.m_angularImpulse=a.clamp(this.m_angularImpulse+p,-f,f),i-=c*(p=this.m_angularImpulse-y),o+=u*p;_=h.sub(h.add(s,h.cross(o,this.m_rB)),h.add(e,h.cross(i,this.m_rA))),p=h.neg(m.mulVec2(this.m_linearMass,_)),y=this.m_linearImpulse;this.m_linearImpulse.add(p);f=l*this.m_maxForce;this.m_linearImpulse.lengthSquared()>f*f&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(f)),p=h.sub(this.m_linearImpulse,y),e.subMul(n,p),i-=c*h.cross(this.m_rA,p),s.addMul(r,p),o+=u*h.cross(this.m_rB,p),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},_.prototype.solvePositionConstraints=function(t){return!0}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=y;var o=i(2),n=i(7),r=i(6),a=i(4),h=i(1),m=i(0),c=(i(10),i(9),i(14),i(3)),u=(i(8),i(5),i(12),i(13),i(11)),l=i(35),_=i(36);y.TYPE="gear-joint",y._super=u,y.prototype=r(y._super.prototype);var p={ratio:1};function y(t,e,i,r,a,f){if(!(this instanceof y))return new y(t,e,i,r,a,f);var d,v;t=n(t,p),u.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=y.TYPE,s&&o.assert(r.m_type===l.TYPE||r.m_type===_.TYPE),s&&o.assert(a.m_type===l.TYPE||a.m_type===_.TYPE),this.m_joint1=r||t.joint1,this.m_joint2=a||t.joint2,this.m_ratio=h.isFinite(f)?f:t.ratio,this.m_type1=this.m_joint1.getType(),this.m_type2=this.m_joint2.getType(),this.m_bodyC=this.m_joint1.getBodyA(),this.m_bodyA=this.m_joint1.getBodyB();var x=this.m_bodyA.m_xf,g=this.m_bodyA.m_sweep.a,b=this.m_bodyC.m_xf,A=this.m_bodyC.m_sweep.a;if(this.m_type1===l.TYPE){var B=this.m_joint1;this.m_localAnchorC=B.m_localAnchorA,this.m_localAnchorA=B.m_localAnchorB,this.m_referenceAngleA=B.m_referenceAngle,this.m_localAxisC=m.zero(),d=g-A-this.m_referenceAngleA}else{var w=this.m_joint1;this.m_localAnchorC=w.m_localAnchorA,this.m_localAnchorA=w.m_localAnchorB,this.m_referenceAngleA=w.m_referenceAngle,this.m_localAxisC=w.m_localXAxisA;var S=this.m_localAnchorC,M=c.mulTVec2(b.q,m.add(c.mul(x.q,this.m_localAnchorA),m.sub(x.p,b.p)));d=m.dot(M,this.m_localAxisC)-m.dot(S,this.m_localAxisC)}this.m_bodyD=this.m_joint2.getBodyA(),this.m_bodyB=this.m_joint2.getBodyB();var C=this.m_bodyB.m_xf,I=this.m_bodyB.m_sweep.a,T=this.m_bodyD.m_xf,P=this.m_bodyD.m_sweep.a;if(this.m_type2===l.TYPE){B=this.m_joint2;this.m_localAnchorD=B.m_localAnchorA,this.m_localAnchorB=B.m_localAnchorB,this.m_referenceAngleB=B.m_referenceAngle,this.m_localAxisD=m.zero(),v=I-P-this.m_referenceAngleB}else{w=this.m_joint2;this.m_localAnchorD=w.m_localAnchorA,this.m_localAnchorB=w.m_localAnchorB,this.m_referenceAngleB=w.m_referenceAngle,this.m_localAxisD=w.m_localXAxisA;var V=this.m_localAnchorD,z=c.mulTVec2(T.q,m.add(c.mul(C.q,this.m_localAnchorB),m.sub(C.p,T.p)));v=m.dot(z,this.m_localAxisD)-m.dot(V,this.m_localAxisD)}this.m_constant=d+this.m_ratio*v,this.m_impulse=0,this.m_lcA,this.m_lcB,this.m_lcC,this.m_lcD,this.m_mA,this.m_mB,this.m_mC,this.m_mD,this.m_iA,this.m_iB,this.m_iC,this.m_iD,this.m_JvAC,this.m_JvBD,this.m_JwA,this.m_JwB,this.m_JwC,this.m_JwD,this.m_mass}y.prototype.getJoint1=function(){return this.m_joint1},y.prototype.getJoint2=function(){return this.m_joint2},y.prototype.setRatio=function(t){s&&o.assert(h.isFinite(t)),this.m_ratio=t},y.prototype.getRatio=function(){return this.m_ratio},y.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},y.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},y.prototype.getReactionForce=function(t){return m.mul(this.m_impulse,this.m_JvAC).mul(t)},y.prototype.getReactionTorque=function(t){return t*(this.m_impulse*this.m_JwA)},y.prototype.initVelocityConstraints=function(t){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=this.m_bodyC.c_position.a,h=this.m_bodyC.c_velocity.v,u=this.m_bodyC.c_velocity.w,_=this.m_bodyD.c_position.a,p=this.m_bodyD.c_velocity.v,y=this.m_bodyD.c_velocity.w,f=c.neo(e),d=c.neo(o),v=c.neo(a),x=c.neo(_);if(this.m_mass=0,this.m_type1==l.TYPE)this.m_JvAC=m.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var g=c.mulVec2(v,this.m_localAxisC),b=c.mulSub(v,this.m_localAnchorC,this.m_lcC),A=c.mulSub(f,this.m_localAnchorA,this.m_lcA);this.m_JvAC=g,this.m_JwC=m.cross(b,g),this.m_JwA=m.cross(A,g),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==l.TYPE)this.m_JvBD=m.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{g=c.mulVec2(x,this.m_localAxisD);var B=c.mulSub(x,this.m_localAnchorD,this.m_lcD),w=c.mulSub(d,this.m_localAnchorB,this.m_lcB);this.m_JvBD=m.mul(this.m_ratio,g),this.m_JwD=this.m_ratio*m.cross(B,g),this.m_JwB=this.m_ratio*m.cross(w,g),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.warmStarting?(i.addMul(this.m_mA*this.m_impulse,this.m_JvAC),s+=this.m_iA*this.m_impulse*this.m_JwA,n.addMul(this.m_mB*this.m_impulse,this.m_JvBD),r+=this.m_iB*this.m_impulse*this.m_JwB,h.subMul(this.m_mC*this.m_impulse,this.m_JvAC),u-=this.m_iC*this.m_impulse*this.m_JwC,p.subMul(this.m_mD*this.m_impulse,this.m_JvBD),y-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.set(i),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.set(n),this.m_bodyB.c_velocity.w=r,this.m_bodyC.c_velocity.v.set(h),this.m_bodyC.c_velocity.w=u,this.m_bodyD.c_velocity.v.set(p),this.m_bodyD.c_velocity.w=y},y.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_bodyC.c_velocity.v,r=this.m_bodyC.c_velocity.w,a=this.m_bodyD.c_velocity.v,h=this.m_bodyD.c_velocity.w,c=m.dot(this.m_JvAC,e)-m.dot(this.m_JvAC,n)+m.dot(this.m_JvBD,s)-m.dot(this.m_JvBD,a);c+=this.m_JwA*i-this.m_JwC*r+(this.m_JwB*o-this.m_JwD*h);var u=-this.m_mass*c;this.m_impulse+=u,e.addMul(this.m_mA*u,this.m_JvAC),i+=this.m_iA*u*this.m_JwA,s.addMul(this.m_mB*u,this.m_JvBD),o+=this.m_iB*u*this.m_JwB,n.subMul(this.m_mC*u,this.m_JvAC),r-=this.m_iC*u*this.m_JwC,a.subMul(this.m_mD*u,this.m_JvBD),h-=this.m_iD*u*this.m_JwD,this.m_bodyA.c_velocity.v.set(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.set(s),this.m_bodyB.c_velocity.w=o,this.m_bodyC.c_velocity.v.set(n),this.m_bodyC.c_velocity.w=r,this.m_bodyD.c_velocity.v.set(a),this.m_bodyD.c_velocity.w=h},y.prototype.solvePositionConstraints=function(t){var e,i,s,o,n,r,h,u,_=this.m_bodyA.c_position.c,p=this.m_bodyA.c_position.a,y=this.m_bodyB.c_position.c,f=this.m_bodyB.c_position.a,d=this.m_bodyC.c_position.c,v=this.m_bodyC.c_position.a,x=this.m_bodyD.c_position.c,g=this.m_bodyD.c_position.a,b=c.neo(p),A=c.neo(f),B=c.neo(v),w=c.neo(g),S=0;if(this.m_type1==l.TYPE)s=m.zero(),n=1,h=1,S+=this.m_iA+this.m_iC,e=p-v-this.m_referenceAngleA;else{var M=c.mulVec2(B,this.m_localAxisC),C=c.mulSub(B,this.m_localAnchorC,this.m_lcC),I=c.mulSub(b,this.m_localAnchorA,this.m_lcA);s=M,h=m.cross(C,M),n=m.cross(I,M),S+=this.m_mC+this.m_mA+this.m_iC*h*h+this.m_iA*n*n;var T=m.sub(this.m_localAnchorC,this.m_lcC),P=c.mulTVec2(B,m.add(I,m.sub(_,d)));e=m.dot(m.sub(P,T),this.m_localAxisC)}if(this.m_type2==l.TYPE)o=m.zero(),r=this.m_ratio,u=this.m_ratio,S+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),i=f-g-this.m_referenceAngleB;else{M=c.mulVec2(w,this.m_localAxisD);var V=c.mulSub(w,this.m_localAnchorD,this.m_lcD),z=c.mulSub(A,this.m_localAnchorB,this.m_lcB);o=m.mul(this.m_ratio,M),u=this.m_ratio*m.cross(V,M),r=this.m_ratio*m.cross(z,M),S+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*u*u+this.m_iB*r*r;var E=m.sub(this.m_localAnchorD,this.m_lcD),F=c.mulTVec2(w,m.add(z,m.sub(y,x)));i=m.dot(F,this.m_localAxisD)-m.dot(E,this.m_localAxisD)}var L=e+this.m_ratio*i-this.m_constant,k=0;return S>0&&(k=-L/S),_.addMul(this.m_mA*k,s),p+=this.m_iA*k*n,y.addMul(this.m_mB*k,o),f+=this.m_iB*k*r,d.subMul(this.m_mC*k,s),v-=this.m_iC*k*h,x.subMul(this.m_mD*k,o),g-=this.m_iD*k*u,this.m_bodyA.c_position.c.set(_),this.m_bodyA.c_position.a=p,this.m_bodyB.c_position.c.set(y),this.m_bodyB.c_position.a=f,this.m_bodyC.c_position.c.set(d),this.m_bodyC.c_position.a=v,this.m_bodyD.c_position.c.set(x),this.m_bodyD.c_position.a=g,0<a.linearSlop}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=_;var o=i(2),n=i(7),r=i(6),a=(i(4),i(1)),h=i(0),m=(i(10),i(9)),c=(i(14),i(3)),u=(i(8),i(5),i(12),i(13),i(11));_.TYPE="motor-joint",_._super=u,_.prototype=r(_._super.prototype);var l={maxForce:1,maxTorque:1,correctionFactor:.3};function _(t,e,i){if(!(this instanceof _))return new _(t,e,i);t=n(t,l),u.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=_.TYPE,this.m_linearOffset=t.linearOffset?t.linearOffset:e.getLocalPoint(i.getPosition());var s=e.getAngle(),o=i.getAngle();this.m_angularOffset=o-s,this.m_linearImpulse=h.zero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_correctionFactor=t.correctionFactor,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_linearError,this.m_angularError,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_linearMass,this.m_angularMass}_.prototype.setMaxForce=function(t){s&&o.assert(a.isFinite(t)&&t>=0),this.m_maxForce=t},_.prototype.getMaxForce=function(){return this.m_maxForce},_.prototype.setMaxTorque=function(t){s&&o.assert(a.isFinite(t)&&t>=0),this.m_maxTorque=t},_.prototype.getMaxTorque=function(){return this.m_maxTorque},_.prototype.setCorrectionFactor=function(t){s&&o.assert(a.isFinite(t)&&0<=t&&t<=1),this.m_correctionFactor=t},_.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},_.prototype.setLinearOffset=function(t){t.x==this.m_linearOffset.x&&t.y==this.m_linearOffset.y||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset=t)},_.prototype.getLinearOffset=function(){return this.m_linearOffset},_.prototype.setAngularOffset=function(t){t!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=t)},_.prototype.getAngularOffset=function(){return this.m_angularOffset},_.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},_.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},_.prototype.getReactionForce=function(t){return h.mul(t,this.m_linearImpulse)},_.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},_.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,u=this.m_bodyB.c_velocity.w,l=c.neo(i),_=c.neo(r);this.m_rA=c.mulVec2(l,h.neg(this.m_localCenterA)),this.m_rB=c.mulVec2(_,h.neg(this.m_localCenterB));var p=this.m_invMassA,y=this.m_invMassB,f=this.m_invIA,d=this.m_invIB,v=new m;if(v.ex.x=p+y+f*this.m_rA.y*this.m_rA.y+d*this.m_rB.y*this.m_rB.y,v.ex.y=-f*this.m_rA.x*this.m_rA.y-d*this.m_rB.x*this.m_rB.y,v.ey.x=v.ex.y,v.ey.y=p+y+f*this.m_rA.x*this.m_rA.x+d*this.m_rB.x*this.m_rB.x,this.m_linearMass=v.getInverse(),this.m_angularMass=f+d,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=h.zero(),this.m_linearError.addCombine(1,n,1,this.m_rB),this.m_linearError.subCombine(1,e,1,this.m_rA),this.m_linearError.sub(c.mulVec2(l,this.m_linearOffset)),this.m_angularError=r-i-this.m_angularOffset,t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var x=h.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);s.subMul(p,x),o-=f*(h.cross(this.m_rA,x)+this.m_angularImpulse),a.addMul(y,x),u+=d*(h.cross(this.m_rB,x)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=u},_.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,c=this.m_invIA,u=this.m_invIB,l=t.dt,_=t.inv_dt,p=o-i+_*this.m_correctionFactor*this.m_angularError,y=-this.m_angularMass*p,f=this.m_angularImpulse,d=l*this.m_maxTorque;this.m_angularImpulse=a.clamp(this.m_angularImpulse+y,-d,d),i-=c*(y=this.m_angularImpulse-f),o+=u*y,(p=h.zero()).addCombine(1,s,1,h.cross(o,this.m_rB)),p.subCombine(1,e,1,h.cross(i,this.m_rA)),p.addMul(_*this.m_correctionFactor,this.m_linearError);y=h.neg(m.mulVec2(this.m_linearMass,p)),f=h.clone(this.m_linearImpulse);this.m_linearImpulse.add(y);d=l*this.m_maxForce;this.m_linearImpulse.clamp(d),y=h.sub(this.m_linearImpulse,f),e.subMul(n,y),i-=c*h.cross(this.m_rA,y),s.addMul(r,y),o+=u*h.cross(this.m_rB,y),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},_.prototype.solvePositionConstraints=function(t){return!0}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=p;var o=i(2),n=i(7),r=i(6),a=i(1),h=i(0),m=(i(10),i(9)),c=(i(14),i(3)),u=(i(8),i(5)),l=(i(12),i(13),i(11));p.TYPE="mouse-joint",p._super=l,p.prototype=r(p._super.prototype);var _={maxForce:0,frequencyHz:5,dampingRatio:.7};function p(t,e,i,r){if(!(this instanceof p))return new p(t,e,i,r);t=n(t,_),l.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=p.TYPE,s&&o.assert(a.isFinite(t.maxForce)&&t.maxForce>=0),s&&o.assert(a.isFinite(t.frequencyHz)&&t.frequencyHz>=0),s&&o.assert(a.isFinite(t.dampingRatio)&&t.dampingRatio>=0),this.m_targetA=r?h.clone(r):t.target||h.zero(),this.m_localAnchorB=u.mulTVec2(i.getTransform(),this.m_targetA),this.m_maxForce=t.maxForce,this.m_impulse=h.zero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_beta=0,this.m_gamma=0,this.m_rB=h.zero(),this.m_localCenterB=h.zero(),this.m_invMassB=0,this.m_invIB=0,this.mass=new m,this.m_C=h.zero()}p.prototype.setTarget=function(t){0==this.m_bodyB.isAwake()&&this.m_bodyB.setAwake(!0),this.m_targetA=h.clone(t)},p.prototype.getTarget=function(){return this.m_targetA},p.prototype.setMaxForce=function(t){this.m_maxForce=t},p.getMaxForce=function(){return this.m_maxForce},p.prototype.setFrequency=function(t){this.m_frequencyHz=t},p.prototype.getFrequency=function(){return this.m_frequencyHz},p.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},p.prototype.getDampingRatio=function(){return this.m_dampingRatio},p.prototype.getAnchorA=function(){return h.clone(this.m_targetA)},p.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},p.prototype.getReactionForce=function(t){return h.mul(t,this.m_impulse)},p.prototype.getReactionTorque=function(t){return 0*t},p.prototype.shiftOrigin=function(t){this.m_targetA.sub(t)},p.prototype.initVelocityConstraints=function(t){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyB.c_position,i=this.m_bodyB.c_velocity,n=e.c,r=e.a,u=i.v,l=i.w,_=c.neo(r),p=this.m_bodyB.getMass(),y=2*a.PI*this.m_frequencyHz,f=2*p*this.m_dampingRatio*y,d=p*(y*y),v=t.dt;s&&o.assert(f+v*d>a.EPSILON),this.m_gamma=v*(f+v*d),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=v*d*this.m_gamma,this.m_rB=c.mulVec2(_,h.sub(this.m_localAnchorB,this.m_localCenterB));var x=new m;x.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,x.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,x.ey.x=x.ex.y,x.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=x.getInverse(),this.m_C.set(n),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),l*=.98,t.warmStarting?(this.m_impulse.mul(t.dtRatio),u.addMul(this.m_invMassB,this.m_impulse),l+=this.m_invIB*h.cross(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),i.v.set(u),i.w=l},p.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyB.c_velocity,i=h.clone(e.v),s=e.w,o=h.cross(s,this.m_rB);o.add(i),o.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),o.neg();var n=m.mulVec2(this.m_mass,o),r=h.clone(this.m_impulse);this.m_impulse.add(n);var a=t.dt*this.m_maxForce;this.m_impulse.clamp(a),n=h.sub(this.m_impulse,r),i.addMul(this.m_invMassB,n),s+=this.m_invIB*h.cross(this.m_rB,n),e.v.set(i),e.w=s},p.prototype.solvePositionConstraints=function(t){return!0}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=_;var o=i(2),n=i(7),r=i(6),a=i(4),h=i(1),m=i(0),c=(i(10),i(9),i(14),i(3)),u=(i(8),i(5),i(12),i(13),i(11));_.TYPE="pulley-joint",_.MIN_PULLEY_LENGTH=2,_._super=u,_.prototype=r(_._super.prototype);var l={collideConnected:!0};function _(t,e,i,r,a,c,p,y){if(!(this instanceof _))return new _(t,e,i,r,a,c,p,y);t=n(t,l),u.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=_.TYPE,this.m_groundAnchorA=r||(t.groundAnchorA||m.neo(-1,1)),this.m_groundAnchorB=a||(t.groundAnchorB||m.neo(1,1)),this.m_localAnchorA=c?e.getLocalPoint(c):t.localAnchorA||m.neo(-1,0),this.m_localAnchorB=p?i.getLocalPoint(p):t.localAnchorB||m.neo(1,0),this.m_lengthA=h.isFinite(t.lengthA)?t.lengthA:m.distance(c,r),this.m_lengthB=h.isFinite(t.lengthB)?t.lengthB:m.distance(p,a),this.m_ratio=h.isFinite(y)?y:t.ratio,s&&o.assert(y>h.EPSILON),this.m_constant=this.m_lengthA+this.m_ratio*this.m_lengthB,this.m_impulse=0,this.m_uA,this.m_uB,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}_.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},_.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},_.prototype.getLengthA=function(){return this.m_lengthA},_.prototype.getLengthB=function(){return this.m_lengthB},_.prototype.getRatio=function(){return this.m_ratio},_.prototype.getCurrentLengthA=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_groundAnchorA;return m.distance(t,e)},_.prototype.getCurrentLengthB=function(){var t=this.m_bodyB.getWorldPoint(this.m_localAnchorB),e=this.m_groundAnchorB;return m.distance(t,e)},_.prototype.shiftOrigin=function(t){this.m_groundAnchorA.sub(t),this.m_groundAnchorB.sub(t)},_.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},_.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},_.prototype.getReactionForce=function(t){return m.mul(this.m_impulse,this.m_uB).mul(t)},_.prototype.getReactionTorque=function(t){return 0},_.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v,u=this.m_bodyB.c_velocity.w,l=c.neo(i),_=c.neo(r);this.m_rA=c.mulVec2(l,m.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=c.mulVec2(_,m.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=m.sub(m.add(e,this.m_rA),this.m_groundAnchorA),this.m_uB=m.sub(m.add(n,this.m_rB),this.m_groundAnchorB);var p=this.m_uA.length(),y=this.m_uB.length();p>10*a.linearSlop?this.m_uA.mul(1/p):this.m_uA.setZero(),y>10*a.linearSlop?this.m_uB.mul(1/y):this.m_uB.setZero();var f=m.cross(this.m_rA,this.m_uA),d=m.cross(this.m_rB,this.m_uB),v=this.m_invMassA+this.m_invIA*f*f,x=this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=v+this.m_ratio*this.m_ratio*x,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.warmStarting){this.m_impulse*=t.dtRatio;var g=m.mul(-this.m_impulse,this.m_uA),b=m.mul(-this.m_ratio*this.m_impulse,this.m_uB);s.addMul(this.m_invMassA,g),o+=this.m_invIA*m.cross(this.m_rA,g),h.addMul(this.m_invMassB,b),u+=this.m_invIB*m.cross(this.m_rB,b)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=h,this.m_bodyB.c_velocity.w=u},_.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=m.add(e,m.cross(i,this.m_rA)),r=m.add(s,m.cross(o,this.m_rB)),a=-m.dot(this.m_uA,n)-this.m_ratio*m.dot(this.m_uB,r),h=-this.m_mass*a;this.m_impulse+=h;var c=m.mul(-h,this.m_uA),u=m.mul(-this.m_ratio*h,this.m_uB);e.addMul(this.m_invMassA,c),i+=this.m_invIA*m.cross(this.m_rA,c),s.addMul(this.m_invMassB,u),o+=this.m_invIB*m.cross(this.m_rB,u),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},_.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,n=c.neo(i),r=c.neo(o),u=c.mulVec2(n,m.sub(this.m_localAnchorA,this.m_localCenterA)),l=c.mulVec2(r,m.sub(this.m_localAnchorB,this.m_localCenterB)),_=m.sub(m.add(e,this.m_rA),this.m_groundAnchorA),p=m.sub(m.add(s,this.m_rB),this.m_groundAnchorB),y=_.length(),f=p.length();y>10*a.linearSlop?_.mul(1/y):_.setZero(),f>10*a.linearSlop?p.mul(1/f):p.setZero();var d=m.cross(u,_),v=m.cross(l,p),x=this.m_invMassA+this.m_invIA*d*d,g=this.m_invMassB+this.m_invIB*v*v,b=x+this.m_ratio*this.m_ratio*g;b>0&&(b=1/b);var A=this.m_constant-y-this.m_ratio*f,B=h.abs(A),w=-b*A,S=m.mul(-w,_),M=m.mul(-this.m_ratio*w,p);return e.addMul(this.m_invMassA,S),i+=this.m_invIA*m.cross(u,S),s.addMul(this.m_invMassB,M),o+=this.m_invIB*m.cross(l,M),this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=s,this.m_bodyB.c_position.a=o,B<a.linearSlop}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=u;var s=i(7),o=i(6),n=i(4),r=i(1),a=i(0),h=(i(10),i(9),i(14),i(3)),m=(i(8),i(5),i(12),i(13),i(11));u.TYPE="rope-joint",u._super=m,u.prototype=o(u._super.prototype);var c={maxLength:0};function u(t,e,i,o){if(!(this instanceof u))return new u(t,e,i,o);t=s(t,c),m.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=u.TYPE,this.m_localAnchorA=o?e.getLocalPoint(o):t.localAnchorA||a.neo(-1,0),this.m_localAnchorB=o?i.getLocalPoint(o):t.localAnchorB||a.neo(1,0),this.m_maxLength=t.maxLength,this.m_mass=0,this.m_impulse=0,this.m_length=0,this.m_state=0,this.m_u,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}u.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},u.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},u.prototype.setMaxLength=function(t){this.m_maxLength=t},u.prototype.getMaxLength=function(){return this.m_maxLength},u.prototype.getLimitState=function(){return this.m_state},u.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},u.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},u.prototype.getReactionForce=function(t){return a.mul(this.m_impulse,this.m_u).mul(t)},u.prototype.getReactionTorque=function(t){return 0},u.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,r=this.m_bodyB.c_position.c,m=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,u=this.m_bodyB.c_velocity.w,l=h.neo(i),_=h.neo(m);this.m_rA=h.mulSub(l,this.m_localAnchorA,this.m_localCenterA),this.m_rB=h.mulSub(_,this.m_localAnchorB,this.m_localCenterB),this.m_u=a.zero(),this.m_u.addCombine(1,r,1,this.m_rB),this.m_u.subCombine(1,e,1,this.m_rA),this.m_length=this.m_u.length();var p=this.m_length-this.m_maxLength;if(this.m_state=p>0?2:0,!(this.m_length>n.linearSlop))return this.m_u.setZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.mul(1/this.m_length);var y=a.cross(this.m_rA,this.m_u),f=a.cross(this.m_rB,this.m_u),d=this.m_invMassA+this.m_invIA*y*y+this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=0!=d?1/d:0,t.warmStarting){this.m_impulse*=t.dtRatio;var v=a.mul(this.m_impulse,this.m_u);s.subMul(this.m_invMassA,v),o-=this.m_invIA*a.cross(this.m_rA,v),c.addMul(this.m_invMassB,v),u+=this.m_invIB*a.cross(this.m_rB,v)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.set(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.set(c),this.m_bodyB.c_velocity.w=u},u.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=a.addCross(e,i,this.m_rA),h=a.addCross(s,o,this.m_rB),m=this.m_length-this.m_maxLength,c=a.dot(this.m_u,a.sub(h,n));m<0&&(c+=t.inv_dt*m);var u=-this.m_mass*c,l=this.m_impulse;this.m_impulse=r.min(0,this.m_impulse+u),u=this.m_impulse-l;var _=a.mul(u,this.m_u);e.subMul(this.m_invMassA,_),i-=this.m_invIA*a.cross(this.m_rA,_),s.addMul(this.m_invMassB,_),o+=this.m_invIB*a.cross(this.m_rB,_),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},u.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,m=h.neo(i),c=h.neo(o),u=h.mulSub(m,this.m_localAnchorA,this.m_localCenterA),l=h.mulSub(c,this.m_localAnchorB,this.m_localCenterB),_=a.zero();_.addCombine(1,s,1,l),_.subCombine(1,e,1,u);var p=_.normalize(),y=p-this.m_maxLength;y=r.clamp(y,0,n.maxLinearCorrection);var f=-this.m_mass*y,d=a.mul(f,_);return e.subMul(this.m_invMassA,d),i-=this.m_invIA*a.cross(u,d),s.addMul(this.m_invMassB,d),o+=this.m_invIB*a.cross(l,d),this.m_bodyA.c_position.c.set(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.set(s),this.m_bodyB.c_position.a=o,p-this.m_maxLength<n.linearSlop}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=_;var s=i(7),o=i(6),n=i(4),r=i(1),a=i(0),h=i(10),m=(i(9),i(14)),c=i(3),u=(i(8),i(5),i(12),i(13),i(11));_.TYPE="weld-joint",_._super=u,_.prototype=o(_._super.prototype);var l={frequencyHz:0,dampingRatio:0};function _(t,e,i,o){if(!(this instanceof _))return new _(t,e,i,o);t=s(t,l),u.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=_.TYPE,this.m_localAnchorA=o?e.getLocalPoint(o):t.localAnchorA||a.zero(),this.m_localAnchorB=o?i.getLocalPoint(o):t.localAnchorB||a.zero(),this.m_referenceAngle=r.isFinite(t.referenceAngle)?t.referenceAngle:i.getAngle()-e.getAngle(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=h(),this.m_bias=0,this.m_gamma=0,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new m}_.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},_.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},_.prototype.getReferenceAngle=function(){return this.m_referenceAngle},_.prototype.setFrequency=function(t){this.m_frequencyHz=t},_.prototype.getFrequency=function(){return this.m_frequencyHz},_.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},_.prototype.getDampingRatio=function(){return this.m_dampingRatio},_.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},_.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},_.prototype.getReactionForce=function(t){return a.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},_.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},_.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,h=this.m_bodyB.c_velocity.w,u=c.neo(e),l=c.neo(o);this.m_rA=c.mulVec2(u,a.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=c.mulVec2(l,a.sub(this.m_localAnchorB,this.m_localCenterB));var _=this.m_invMassA,p=this.m_invMassB,y=this.m_invIA,f=this.m_invIB,d=new m;if(d.ex.x=_+p+this.m_rA.y*this.m_rA.y*y+this.m_rB.y*this.m_rB.y*f,d.ey.x=-this.m_rA.y*this.m_rA.x*y-this.m_rB.y*this.m_rB.x*f,d.ez.x=-this.m_rA.y*y-this.m_rB.y*f,d.ex.y=d.ey.x,d.ey.y=_+p+this.m_rA.x*this.m_rA.x*y+this.m_rB.x*this.m_rB.x*f,d.ez.y=this.m_rA.x*y+this.m_rB.x*f,d.ex.z=d.ez.x,d.ey.z=d.ez.y,d.ez.z=y+f,this.m_frequencyHz>0){d.getInverse22(this.m_mass);var v=y+f,x=v>0?1/v:0,g=o-e-this.m_referenceAngle,b=2*r.PI*this.m_frequencyHz,A=2*x*this.m_dampingRatio*b,B=x*b*b,w=t.dt;this.m_gamma=w*(A+w*B),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=g*w*B*this.m_gamma,v+=this.m_gamma,this.m_mass.ez.z=0!=v?1/v:0}else 0==d.ez.z?(d.getInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(d.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(t.warmStarting){this.m_impulse.mul(t.dtRatio);var S=a.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(_,S),s-=y*(a.cross(this.m_rA,S)+this.m_impulse.z),n.addMul(p,S),h+=f*(a.cross(this.m_rB,S)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=h},_.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,c=this.m_invIA,u=this.m_invIB;if(this.m_frequencyHz>0){var l=o-i,_=-this.m_mass.ez.z*(l+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=_,i-=c*_,o+=u*_,(f=a.zero()).addCombine(1,s,1,a.cross(o,this.m_rB)),f.subCombine(1,e,1,a.cross(i,this.m_rA));var p=a.neg(m.mulVec2(this.m_mass,f));this.m_impulse.x+=p.x,this.m_impulse.y+=p.y;var y=a.clone(p);e.subMul(n,y),i-=c*a.cross(this.m_rA,y),s.addMul(r,y),o+=u*a.cross(this.m_rB,y)}else{var f;(f=a.zero()).addCombine(1,s,1,a.cross(o,this.m_rB)),f.subCombine(1,e,1,a.cross(i,this.m_rA));l=o-i;var d=h(f.x,f.y,l),v=h.neg(m.mulVec3(this.m_mass,d));this.m_impulse.add(v);y=a.neo(v.x,v.y);e.subMul(n,y),i-=c*(a.cross(this.m_rA,y)+v.z),s.addMul(r,y),o+=u*(a.cross(this.m_rB,y)+v.z)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},_.prototype.solvePositionConstraints=function(t){var e,i,s=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,u=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,_=c.neo(o),p=c.neo(l),y=this.m_invMassA,f=this.m_invMassB,d=this.m_invIA,v=this.m_invIB,x=c.mulVec2(_,a.sub(this.m_localAnchorA,this.m_localCenterA)),g=c.mulVec2(p,a.sub(this.m_localAnchorB,this.m_localCenterB)),b=new m;if(b.ex.x=y+f+x.y*x.y*d+g.y*g.y*v,b.ey.x=-x.y*x.x*d-g.y*g.x*v,b.ez.x=-x.y*d-g.y*v,b.ex.y=b.ey.x,b.ey.y=y+f+x.x*x.x*d+g.x*g.x*v,b.ez.y=x.x*d+g.x*v,b.ex.z=b.ez.x,b.ey.z=b.ez.y,b.ez.z=d+v,this.m_frequencyHz>0){(B=a.zero()).addCombine(1,u,1,g),B.subCombine(1,s,1,x),e=B.length(),i=0;var A=a.neg(b.solve22(B));s.subMul(y,A),o-=d*a.cross(x,A),u.addMul(f,A),l+=v*a.cross(g,A)}else{var B;(B=a.zero()).addCombine(1,u,1,g),B.subCombine(1,s,1,x);var w=l-o-this.m_referenceAngle;e=B.length(),i=r.abs(w);var S=h(B.x,B.y,w),M=h();if(b.ez.z>0)M=h.neg(b.solve33(S));else{var C=a.neg(b.solve22(B));M.set(C.x,C.y,0)}A=a.neo(M.x,M.y);s.subMul(y,A),o-=d*(a.cross(x,A)+M.z),u.addMul(f,A),l+=v*(a.cross(g,A)+M.z)}return this.m_bodyA.c_position.c=s,this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c=u,this.m_bodyB.c_position.a=l,e<=n.linearSlop&&i<=n.angularSlop}},function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;t.exports=u;var s=i(7),o=i(6),n=i(4),r=i(1),a=i(0),h=(i(10),i(9),i(14),i(3)),m=(i(8),i(5),i(12),i(13),i(11));u.TYPE="wheel-joint",u._super=m,u.prototype=o(u._super.prototype);var c={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7};function u(t,e,i,o,n){if(!(this instanceof u))return new u(t,e,i,o,n);t=s(t,c),m.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=u.TYPE,this.m_localAnchorA=o?e.getLocalPoint(o):t.localAnchorA||a.zero(),this.m_localAnchorB=o?i.getLocalPoint(o):t.localAnchorB||a.zero(),this.m_localAxis=n?e.getLocalVector(n):t.localAxisA||a.neo(1,0),this.m_localXAxisA=this.m_localAxis,this.m_localYAxisA=a.cross(1,this.m_localXAxisA),this.m_mass=0,this.m_impulse=0,this.m_motorMass=0,this.m_motorImpulse=0,this.m_springMass=0,this.m_springImpulse=0,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableMotor=t.enableMotor,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_bias=0,this.m_gamma=0,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_ax=a.zero(),this.m_ay=a.zero(),this.m_sAx,this.m_sBx,this.m_sAy,this.m_sBy}u.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},u.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},u.prototype.getLocalAxisA=function(){return this.m_localXAxisA},u.prototype.getJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.getWorldPoint(this.m_localAnchorA),s=e.getWorldPoint(this.m_localAnchorB),o=a.sub(s,i),n=t.getWorldVector(this.m_localXAxisA);return a.dot(o,n)},u.prototype.getJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},u.prototype.isMotorEnabled=function(){return this.m_enableMotor},u.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},u.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},u.prototype.getMotorSpeed=function(){return this.m_motorSpeed},u.prototype.setMaxMotorTorque=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t},u.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},u.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},u.prototype.setSpringFrequencyHz=function(t){this.m_frequencyHz=t},u.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},u.prototype.setSpringDampingRatio=function(t){this.m_dampingRatio=t},u.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},u.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},u.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},u.prototype.getReactionForce=function(t){return a.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(t)},u.prototype.getReactionTorque=function(t){return t*this.m_motorImpulse},u.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,o=this.m_invIB,n=this.m_bodyA.c_position.c,m=this.m_bodyA.c_position.a,c=this.m_bodyA.c_velocity.v,u=this.m_bodyA.c_velocity.w,l=this.m_bodyB.c_position.c,_=this.m_bodyB.c_position.a,p=this.m_bodyB.c_velocity.v,y=this.m_bodyB.c_velocity.w,f=h.neo(m),d=h.neo(_),v=h.mulVec2(f,a.sub(this.m_localAnchorA,this.m_localCenterA)),x=h.mulVec2(d,a.sub(this.m_localAnchorB,this.m_localCenterB));if((B=a.zero()).addCombine(1,l,1,x),B.subCombine(1,n,1,v),this.m_ay=h.mulVec2(f,this.m_localYAxisA),this.m_sAy=a.cross(a.add(B,v),this.m_ay),this.m_sBy=a.cross(x,this.m_ay),this.m_mass=e+i+s*this.m_sAy*this.m_sAy+o*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=h.mulVec2(f,this.m_localXAxisA),this.m_sAx=a.cross(a.add(B,v),this.m_ax),this.m_sBx=a.cross(x,this.m_ax);var g=e+i+s*this.m_sAx*this.m_sAx+o*this.m_sBx*this.m_sBx;if(g>0){this.m_springMass=1/g;var b=a.dot(B,this.m_ax),A=2*r.PI*this.m_frequencyHz,B=2*this.m_springMass*this.m_dampingRatio*A,w=this.m_springMass*A*A,S=t.dt;this.m_gamma=S*(B+S*w),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=b*S*w*this.m_gamma,this.m_springMass=g+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=s+o,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.warmStarting){this.m_impulse*=t.dtRatio,this.m_springImpulse*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var M=a.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),C=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,I=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;c.subMul(this.m_invMassA,M),u-=this.m_invIA*C,p.addMul(this.m_invMassB,M),y+=this.m_invIB*I}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.set(c),this.m_bodyA.c_velocity.w=u,this.m_bodyB.c_velocity.v.set(p),this.m_bodyB.c_velocity.w=y},u.prototype.solveVelocityConstraints=function(t){var e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,o=this.m_invIB,n=this.m_bodyA.c_velocity.v,h=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_velocity.v,c=this.m_bodyB.c_velocity.w,u=a.dot(this.m_ax,m)-a.dot(this.m_ax,n)+this.m_sBx*c-this.m_sAx*h,l=-this.m_springMass*(u+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=l;var _=a.mul(l,this.m_ax),p=l*this.m_sAx,y=l*this.m_sBx;n.subMul(e,_),h-=s*p,m.addMul(i,_);u=(c+=o*y)-h-this.m_motorSpeed,l=-this.m_motorMass*u;var f=this.m_motorImpulse,d=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=r.clamp(this.m_motorImpulse+l,-d,d),h-=s*(l=this.m_motorImpulse-f),c+=o*l;u=a.dot(this.m_ay,m)-a.dot(this.m_ay,n)+this.m_sBy*c-this.m_sAy*h,l=-this.m_mass*u;this.m_impulse+=l;_=a.mul(l,this.m_ay),p=l*this.m_sAy,y=l*this.m_sBy;n.subMul(e,_),h-=s*p,m.addMul(i,_),c+=o*y,this.m_bodyA.c_velocity.v.set(n),this.m_bodyA.c_velocity.w=h,this.m_bodyB.c_velocity.v.set(m),this.m_bodyB.c_velocity.w=c},u.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,m=h.neo(i),c=h.neo(o),u=h.mulVec2(m,a.sub(this.m_localAnchorA,this.m_localCenterA)),l=h.mulVec2(c,a.sub(this.m_localAnchorB,this.m_localCenterB)),_=a.zero();_.addCombine(1,s,1,l),_.subCombine(1,e,1,u);var p,y=h.mulVec2(m,this.m_localYAxisA),f=a.cross(a.add(_,u),y),d=a.cross(l,y),v=a.dot(_,y),x=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;p=0!=x?-v/x:0;var g=a.mul(p,y),b=p*f,A=p*d;return e.subMul(this.m_invMassA,g),i-=this.m_invIA*b,s.addMul(this.m_invMassB,g),o+=this.m_invIB*A,this.m_bodyA.c_position.c.set(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.set(s),this.m_bodyB.c_position.a=o,r.abs(v)<=n.linearSlop}},function(t,e,i){"use strict";var s,o=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var a=n(i(19)),h=r(i(20)),m=function(t){function e(e,i,s,o,n,r,a){var m=t.call(this,e,i,s,"")||this,c=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),u=e.add.graphics();return u.fillStyle(15658734,1),u.fillRect(0,0,o,n),u.generateTexture(c,o,n),u.destroy(),m.setTexture(c),m.scene=e,m.isDynamic=r,m.isFixed=a,m.scene.add.existing(m),m.setPosition(i,s),m.width=o,m.height=n,m.x=i+o/2,m.y=s-n/2,m.body=e.planck.world.createBody(),m.isDynamic&&m.body.setDynamic(),m.body.createFixture(h.Box(o/2/e.planck.scaleFactor,n/2/e.planck.scaleFactor)),m.body.setPosition(h.Vec2(m.x/e.planck.scaleFactor,m.y/e.planck.scaleFactor)),m.body.setMassData({mass:1,center:h.Vec2(),I:m.isFixed?0:1}),m}return o(e,t),e.prototype.preUpdate=function(e,i){t.prototype.preUpdate.call(this,e,i);var s=this.body.getPosition();this.x=s.x*this.scene.planck.scaleFactor,this.y=s.y*this.scene.planck.scaleFactor,this.rotation=this.body.getAngle()},e}(a.default.GameObjects.Sprite);e.default=m},function(t,e,i){"use strict";var s,o=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var a=n(i(19)),h=r(i(20)),m=function(t){function e(e,i,s,o,n,r){var a=t.call(this,e,i,s,"")||this,m=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),c=e.add.graphics();return c.fillStyle(15658734,1),c.fillCircle(o,o,o),c.generateTexture(m,2*o,2*o),c.destroy(),a.setTexture(m),a.scene=e,a.isDynamic=n,a.isFixed=r,a.scene.add.existing(a),a.radius=o,a.x=i,a.y=s,a.body=e.planck.world.createBody(),a.isDynamic&&a.body.setDynamic(),a.body.createFixture(h.Circle(o/e.planck.scaleFactor),{friction:.1,restitution:.5,density:1}),a.body.setPosition(h.Vec2(a.x/e.planck.scaleFactor,a.y/e.planck.scaleFactor)),a.body.setMassData({mass:1,center:h.Vec2(),I:1}),a}return o(e,t),e.prototype.preUpdate=function(e,i){t.prototype.preUpdate.call(this,e,i);var s=this.body.getPosition();this.x=s.x*this.scene.planck.scaleFactor,this.y=s.y*this.scene.planck.scaleFactor,this.rotation=this.body.getAngle()},e}(a.default.GameObjects.Sprite);e.default=m},function(t,e,i){"use strict";var s,o=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var a=n(i(19)),h=r(i(20)),m=function(t){function e(e,i,s,o,n,r){var a=t.call(this,e,i,s,"")||this,m=e.add.graphics();return m.lineStyle(4,3355443,1),m.beginPath(),m.moveTo(i,s),m.lineTo(o,n),m.closePath(),m.strokePath(),a.isDynamic=r,a.isFixed=!0,a.scene.add.existing(a),a.x=i,a.y=s,a.x2=o,a.y2=n,a.body=e.planck.world.createBody(),a.body.createFixture(h.Edge(h.Vec2(a.x/e.planck.scaleFactor,a.y/e.planck.scaleFactor),h.Vec2(a.x2/e.planck.scaleFactor,a.y2/e.planck.scaleFactor)),{friction:1,restitution:.5,density:1}),a.body.setMassData({mass:1,center:h.Vec2(),I:0}),a}return o(e,t),e}(a.default.GameObjects.Sprite);e.default=m},function(t,e,i){"use strict";var s,o=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var a=n(i(19)),h=r(i(20)),m=n(i(64)),c=function(t){function e(e,i,s,o,n,r){var a=t.call(this,e,i,s,"")||this,c=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),u=new m.default(o),l=u.aabb(),_=(u.center(),l.w),p=l.h,y=e.add.graphics();y.fillStyle(16711680,1),y.beginPath(),y.moveTo(o[0][0],o[0][1]);for(var f=1;f<o.length;f+=1)y.lineTo(o[f][0],o[f][1]);y.lineTo(o[0][0],o[0][1]),y.closePath(),y.fill(),y.generateTexture(c,_,p),y.destroy(),a.setTexture(c),a.scene=e,a.isDynamic=n,a.isFixed=r,a.scene.add.existing(a),a.setPosition(i,s),a.x=i,a.y=s,a.body=e.planck.world.createBody(),a.isDynamic&&a.body.setDynamic();var d=[];return o.forEach((function(t){d.push(new h.Vec2((t[0]-_/2)/e.planck.scaleFactor,(t[1]-p/2)/e.planck.scaleFactor))})),a.body.createFixture(h.Polygon(d)),a.body.setPosition(h.Vec2(i/e.planck.scaleFactor,s/e.planck.scaleFactor)),a.body.setMassData({mass:1,center:h.Vec2(),I:a.isFixed?0:1}),a}return o(e,t),e.prototype.preUpdate=function(e,i){t.prototype.preUpdate.call(this,e,i);var s=this.body.getPosition();this.x=s.x*this.scene.planck.scaleFactor,this.y=s.y*this.scene.planck.scaleFactor,this.rotation=this.body.getAngle()},e}(a.default.GameObjects.Sprite);e.default=c},function(t,e,i){var s=i(65),o=i(29),n=i(66),r=i(68),a=i(78),h=2*Math.PI,m=function(t){return"[object Array]"===Object.prototype.toString.call(t)},c=function(t){return"function"==typeof t},u=function(t){return void 0!==t};function l(t){return t instanceof l?t:this instanceof l?(Array.isArray(t)||(t=t?[t]:[]),void(this.points=t.map((function(t){return Array.isArray(t)?s.fromArray(t):t instanceof s?t:void 0!==t.x&&void 0!==t.y?s(t.x,t.y):void 0})))):new l(t)}l.prototype={each:function(t){for(var e=0;e<this.points.length&&!1!==t.call(this,this.point(e-1),this.point(e),this.point(e+1),e);e++);return this},insert:function(t,e){this.points.splice(e,0,t)},point:function(t){var e=t%this.points.length;return e<0&&(e=this.points.length+e),this.points[e]},dedupe:function(t){var e={},i=this.points.filter((function(t){var i=t.x+":"+t.y;if(!e[i])return e[i]=!0,!0}));return t?new l(i):(this.points=i,this)},remove:function(t){return"number"==typeof t?this.points.splice(t,1):this.points=this.points.filter((function(e){return e!==t})),this},clean:function(t){var e=this.point(-1),i=this.points.filter((function(t){var i=!1;return e.equal(t)||(i=!0),e=t,i}));return t?new l(i):(this.points=i,this)},simplify:function(){var t=function(t){return Math.round(1e4*t)/1e4},e=function(e,i,s){var o=e.x*(i.y-s.y)+i.x*(s.y-e.y)+s.x*(e.y-i.y);return 0===t(o)};this.points=this.points.filter(Boolean);for(var i=[],s=0;s<this.points.length;s++){var o=this.point(s-1),n=this.point(s+1),r=this.point(s),a=r.subtract(o,!0).angleTo(r.subtract(n,!0));!e(o,r,n)&&t(a)&&i.push(r)}return this.points=i,this},winding:function(){return this.area()>0},rewind:function(t){return t=!!t,this.winding()!==t&&this.points.reverse(),this},area:function(){var t=0,e=this.point(0);return this.each((function(i,s,o,n){if(!(n<2)){var r=e.subtract(s,!0),a=e.subtract(i,!0);t+=r.x*a.y-r.y*a.x}})),t/2},closestPointTo:function(t){var e,i=this.points.length,s=1/0,o=null,n=0,r=!1;for(e=0;e<i;e++){var a=this.point(e-1),h=this.point(e);if(!a.equal(h)){var m=h.subtract(a,!0),c=t.subtract(a,!0).dot(m),u=m.dot(m),l=Math.min(Math.max(c/u,0),1),_=m.multiply(l).add(a),p=t.subtract(_,!0).lengthSquared();p<s&&(o=_,n=e,r=0===l||1===l,s=p)}}return o.prev=this.point(n-1),o.next=this.point(n+1),r&&(o.current=this.point(n)),o},center:function(){var t=this.aabb();return s(t.x+t.w/2,t.y+t.h/2)},scale:function(t,e,i){var s=this;i&&(s=this.clone()),e||(e=s.center()),s.each((function(e,i){i.multiply(t)}));var o=e.multiply(t,!0).subtract(e);return s.each((function(t,e){e.subtract(o)})),s},containsPoint:function(t){var e=!1;return this.each((function(i,s,o){(i.y<=t.y&&t.y<s.y||s.y<=t.y&&t.y<i.y)&&t.x<(s.x-i.x)*(t.y-i.y)/(s.y-i.y)+i.x&&(e=!e)})),e},containsPolygon:function(t){m(t)&&(t=new l(t));for(var e=0;e<t.points.length;e++)if(!this.containsPoint(t.points[e]))return!1;for(e=0;e<this.points.length;e++)for(var i=this.line(e),s=0;s<t.points.length;s++){var n=t.line(s),r=o(i[0],i[1],n[0],n[1]);if(r&&!0!==r)return!1}return!0},aabb:function(){if(this.points.length<2)return{x:0,y:0,w:0,h:0};var t,e,i,s,o=this.point(1);return e=t=o.x,i=s=o.y,this.each((function(o,n){n.x>e&&(e=n.x),n.x<t&&(t=n.x),n.y>i&&(i=n.y),n.y<s&&(s=n.y)})),{x:t,y:s,w:e-t,h:i-s}},offset:function(t,e){var i=[];this.rewind(!1).simplify().each((function(e,s,o,n){var r,a=s.subtract(e,!0).normalize(),m=s.subtract(o,!0).normalize(),c=t/Math.sin(Math.acos(a.dot(m))/2),u=a.add(m,!0).normalize().multiply(c,!0),l=((r=a.angleTo(m))<0&&(r+=h),r),_=a.perpDot(m)<0?s.add(u,!0):s.subtract(u,!0);(l>.75*h||l<.25*h)&&(_.computeSegments=l,s.color="white",s.radius=3),_.point=s,i.push(_)}));var r=function(e,i){var o=e.subtract(i,!0),r=s(1,0).angleTo(o),a=s(t,0).rotate(r+Math.PI/2);a.add(i);var h=a.add(o,!0),m=new n(a.x,a.y,h.x,h.y),c=e.add(o,!0);new n(e.x,e.y,c.x,c.y);return m},a=l(i),m=[];return a.each((function(t,e,i,s){if(o(e,e.point,i,i.point)){var n=a.point(s-2),h=a.point(s+2),c=(r(n.point,t.point),r(t.point,e.point)),u=(r(e.point,i.point),r(i.point,h.point)),l=c.intersect(u);l.color="yellow",l.point=e.point,m.push(l)}else m.push(e)})),m.length?l(m):a},line:function(t){return[this.point(t),this.point(t+1)]},lines:function(t){var e=0;return this.each((function(i,s,o){t(s,o,e++)})),this},selfIntersections:function(){var t=[];return a(this.points,(function(e,i,o,n,r,a,h,m){if(m){var c=s.fromArray(e);return t.push(c),c.s=i+o.subtract(c,!0).length()/o.subtract(n,!0).length(),c.b=r+a.subtract(c,!0).length()/a.subtract(h,!0).length(),c.si=i,c.bi=r,!1}})),l(t)},pruneSelfIntersections:function(){var t=this.selfIntersections();var e=this.point(0).clone();e.s=0,e.b=this.points.length-1+.99;var i=new function(t,e){this.value=t,this.depth=this.depth,this.children=[]}(e),s=[e];t.each((function(t,e,o){var n,r,a,h;console.log("belongTo:",(n=i.s,r=i.b,a=e.s,h=e.b,n>a&&r<h),"contain:",function(t,e,i,s){return t<i&&e>s}(i.s,i.b,e.s,e.b),"interfere:",function(t,e,i,s){return t<i&&i<e&&s>e||i<e&&e<s&&t<i}(i.s,i.b,e.s,e.b)),s.push(e),i=e}));var o=[];if(s.length<2)return[this];s.sort((function(t,e){return t.s-e.s}));for(var n=0;n<s.length;n+=2){var r=[],a=n<s.length-1?s[n+1]:null;if(a){for(var h=Math.floor(s[n].s);h<=Math.floor(a.s);h++)r.push(this.point(h));r.push(a);for(h=Math.floor(a.b+1);h<=Math.floor(s[n].b);h++)r.push(this.point(h))}else{r.push(s[n]);for(var m=Math.floor(s[n].s+1);m<=Math.floor(s[n].b);m++)r.push(this.point(m))}o.push(new l(r))}return o},get length(){return this.points.length},clone:function(){var t=[];return this.each((function(e,i){t.push(i.clone())})),new l(t)},rotate:function(t,e,i){return e=e||this.center(),(i?this.clone():this).each((function(i,s){s.subtract(e).rotate(t).add(e)}))},translate:function(t,e){var i=e?this.clone():this;return i.each((function(e,i){i.add(t)})),i},equal:function(t){for(var e=t.length;e--;)if(!this.point(e).equal(t.point(e)))return!1;return!0},containsCircle:function(t,e,i){var o=new s(t,e);return!!this.containsPoint(o)&&(this.closestPointTo(o).distance(o)>=i||void 0)},contains:function(t){return!!t&&(u(t.radius)&&t.position?(e=c(t.radius)?t.radius():t.radius,this.containsCircle(t.position.x,t.position.y,e)):void 0!==t.points?((c(t.containsPolygon)||m(t.points))&&(i=t.points),this.containsPolygon(i)):u(t.x1)&&u(t.x2)&&u(t.y1)&&u(t.y2)?this.containsPolygon([new s(t.x1,t.y1),new s(t.x2,t.y1),new s(t.x2,t.y2),new s(t.x1,t.y2)]):!(!u(t.x)||!u(t.y))&&(u(t.w)&&u(t.h)&&(o=t.x+t.w,n=t.y+t.h),u(t.width)&&u(t.height)&&(o=t.x+t.width,n=t.y+t.height),this.containsPolygon([new s(t.x,t.y),new s(o,t.y),new s(o,n),new s(t.x,n)])));var e,i,o,n},union:function(t){return l(r(this.toArray(),t.toArray(),"or")[0])},cut:function(t){return r(this.toArray(),t.toArray(),"not").map((function(t){return new l(t)}))},intersect:function(t){return r(this.toArray(),t.toArray(),"and").map((function(t){return new l(t)}))},toArray:function(){for(var t=this.length,e=Array(t),i=0;i<t;i++)e[i]=this.points[i].toArray();return e},toString:function(){return this.points.join(",")}},t.exports&&(t.exports=l),"undefined"!=typeof window&&(window.Polygon=l)},function(t,e,i){!function e(i,s,o){var n=function(t){return"[object Array]"===Object.prototype.toString.call(t)};function r(t,e){if(!(this instanceof r))return new r(t,e);n(t)?(e=t[1],t=t[0]):"object"==typeof t&&t&&(e=t.y,t=t.x),this.x=r.clean(t||0),this.y=r.clean(e||0)}r.prototype={change:function(t){if("function"==typeof t)this.observers?this.observers.push(t):this.observers=[t];else if(this.observers&&this.observers.length)for(var e=this.observers.length-1;e>=0;e--)this.observers[e](this,t);return this},ignore:function(t){if(this.observers)if(t)for(var e=this.observers,i=e.length;i--;)e[i]===t&&e.splice(i,1);else this.observers=[];return this},set:function(t,e,i){if("number"!=typeof t&&(i=e,e=t.y,t=t.x),this.x===t&&this.y===e)return this;var s=null;return!1!==i&&this.observers&&this.observers.length&&(s=this.clone()),this.x=r.clean(t),this.y=r.clean(e),!1!==i?this.change(s):void 0},zero:function(){return this.set(0,0)},clone:function(){return new this.constructor(this.x,this.y)},negate:function(t){return t?new this.constructor(-this.x,-this.y):this.set(-this.x,-this.y)},add:function(t,e,i){return"number"!=typeof t&&(i=e,n(t)?(e=t[1],t=t[0]):(e=t.y,t=t.x)),t+=this.x,e+=this.y,i?new this.constructor(t,e):this.set(t,e)},subtract:function(t,e,i){return"number"!=typeof t&&(i=e,n(t)?(e=t[1],t=t[0]):(e=t.y,t=t.x)),t=this.x-t,e=this.y-e,i?new this.constructor(t,e):this.set(t,e)},multiply:function(t,e,i){return"number"!=typeof t?(i=e,n(t)?(e=t[1],t=t[0]):(e=t.y,t=t.x)):"number"!=typeof e&&(i=e,e=t),t*=this.x,e*=this.y,i?new this.constructor(t,e):this.set(t,e)},rotate:function(t,e,i){var s,o,n=this.x,r=this.y,a=Math.cos(t),h=Math.sin(t);return s=a*n-(e=e?-1:1)*h*r,o=e*h*n+a*r,i?new this.constructor(s,o):this.set(s,o)},length:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},lengthSquared:function(){var t=this.x,e=this.y;return t*t+e*e},distance:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},nearest:function(t){for(var e,i=Number.MAX_VALUE,s=null,o=t.length-1;o>=0;o--)(e=this.distance(t[o]))<=i&&(i=e,s=t[o]);return s},normalize:function(t){var e=this.length(),i=e<Number.MIN_VALUE?0:1/e;return t?new this.constructor(this.x*i,this.y*i):this.set(this.x*i,this.y*i)},equal:function(t,e){return"number"!=typeof t&&(n(t)?(e=t[1],t=t[0]):(e=t.y,t=t.x)),r.clean(t)===this.x&&r.clean(e)===this.y},abs:function(t){var e=Math.abs(this.x),i=Math.abs(this.y);return t?new this.constructor(e,i):this.set(e,i)},min:function(t,e){var i=this.x,s=this.y,o=t.x,n=t.y,r=i<o?i:o,a=s<n?s:n;return e?new this.constructor(r,a):this.set(r,a)},max:function(t,e){var i=this.x,s=this.y,o=t.x,n=t.y,r=i>o?i:o,a=s>n?s:n;return e?new this.constructor(r,a):this.set(r,a)},clamp:function(t,e,i){var s=this.min(e,!0).max(t);return i?s:this.set(s.x,s.y)},lerp:function(t,e,i){return this.add(t.subtract(this,!0).multiply(e),i)},skew:function(t){return t?new this.constructor(-this.y,this.x):this.set(-this.y,this.x)},dot:function(t){return r.clean(this.x*t.x+t.y*this.y)},perpDot:function(t){return r.clean(this.x*t.y-this.y*t.x)},angleTo:function(t){return Math.atan2(this.perpDot(t),this.dot(t))},divide:function(t,e,i){if("number"!=typeof t?(i=e,n(t)?(e=t[1],t=t[0]):(e=t.y,t=t.x)):"number"!=typeof e&&(i=e,e=t),0===t||0===e)throw new Error("division by zero");if(isNaN(t)||isNaN(e))throw new Error("NaN detected");return i?new this.constructor(this.x/t,this.y/e):this.set(this.x/t,this.y/e)},isPointOnLine:function(t,e){return(t.y-this.y)*(t.x-e.x)==(t.y-e.y)*(t.x-this.x)},toArray:function(){return[this.x,this.y]},fromArray:function(t){return this.set(t[0],t[1])},toJSON:function(){return{x:this.x,y:this.y}},toString:function(){return"("+this.x+", "+this.y+")"},constructor:r},r.fromArray=function(t,e){return new(e||r)(t[0],t[1])},r.precision=s||8;var a=Math.pow(10,r.precision);return r.clean=i||function(t){if(isNaN(t))throw new Error("NaN detected");if(!isFinite(t))throw new Error("Infinity detected");return Math.round(t)===t?t:Math.round(t*a)/a},r.inject=e,i||(r.fast=e((function(t){return t})),"object"==typeof t.exports?t.exports=r:window.Vec2=window.Vec2||r),r}()},function(t,e,i){var s=i(67),o=i(29),n=function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=function(t){return void 0!==t},a=function(t,e){return r(t)?t:e},h=function(t){return t!==1/0&&t!==-1/0},m=function(t,e,i,s){return t*s-e*i};function c(t,e,i,s){return this._listeners=[],this instanceof c?r(i)&&r(s)?c.fromPoints(t,e,i,s):(r(t)&&this.slope(t),void(r(e)&&this.yintercept(e))):new c(t,e,i,s)}c.prototype._yintercept=null,c.prototype._xintercept=null,c.prototype._slope=null,c.prototype.change=function(t){if("function"==typeof t)return this._listeners.push(t),t},c.prototype.ignore=function(t){this._listeners=t?this._listeners.filter((function(e){return e!==t})):[]},c.prototype.notify=function(t){for(var e=this._listeners,i=e.length,s=0;s<i;s++)e[s](this)},c.prototype.yintercept=function(t){return r(t)&&(h(t)&&(t=s.clean(t)),this._yintercept!==t&&(this._yintercept=t,this.isHorizontal()||(this._xintercept=this.solveForX(0)),this.notify())),a(this._yintercept,null)},c.prototype.xintercept=function(t){if(r(t)&&(h(t)&&(t=s.clean(t)),this._xintercept!==t)){if(!this.isVertical()){var e=this._xintercept-t;this._yintercept-=e*-this._slope}this._xintercept=t,this.notify()}return a(this._xintercept,null)},c.prototype.slope=function(t){if(r(t)&&(h(t)&&(t=s.clean(t)),this._slope!==t)){var e=this._slope;if(this._slope=t,null!==e){var i=this.solveForX(0);h(i)||(i=null),this._xintercept=i}this.notify()}return a(this._slope,null)},c.prototype.intersectSegment=function(t,e,i,n){var r,a,h,m,c,u=i-t,l=n-e,_=this.isHorizontal(),p=this.isVertical();if(0===u){if(p)return t===this.xintercept()}else if(0===l){if(_)return e===this.yintercept()}else if(l/u===this.slope())return e===this.solveForY(t);if(t>i?(r=i-10,h=t+10):(r=t-10,h=i+10),this.isHorizontal())y=this.yintercept(),c=o(r,y,h,y,t,e,i,n);else if(this.isVertical()){e>n?(a=n-10,m=e+10):(a=e-10,m=n+10);var f=this.xintercept();c=o(f,a,f,m,t,e,i,n)}else a=this.solveForY(r),m=this.solveForY(h),c=o(r,a,h,m,t,e,i,n);return c&&!0!==c?s.fromArray(c):c},c.prototype.createPerpendicular=function(t){if(this.isVertical())return new c(0,t.y);if(this.isHorizontal()){var e=new c;return e.xintercept(t.x),e.slope(1/0),e}var i=-1/this.slope();return new c(i,t.y-i*t.x)},c.prototype.intersectCircle=function(t,e){var i,o,n,r,a=e*e,h=this.slope(),m=this.yintercept();this.isHorizontal()?(i=1,o=0):this.isVertical()?(m=a,i=0,o=h=e):(i=1/h,o=1);var c=this.isVertical()?this.xintercept():1,u=m+h,l=i*i,_=o*o,p=i*(t.y-u)-o*(t.x-c);p*=p;var y=l+_,f=Math.sqrt(a*(l+_)-p);if(isNaN(f))return[];f/=y;var d=i*(t.x-c)+o*(t.y-u),v=d/y+f,x=d/y-f;n=new s(c+v*i,u+v*o),r=new s(c+x*i,u+x*o);var g=[n];return n.equal(r)||g.push(r),g},c.prototype.solveForX=function(t){return this.isVertical()?this.xintercept():(t-this.yintercept())/this.slope()},c.prototype.solveForY=function(t){return this.isHorizontal()?this.yintercept():this.slope()*t+this.yintercept()},c.prototype.intersect=function(t,e,i,o){if(r(e)&&r(o)||r(t.end))return this.intersectSegment(t,e,i,o);var n=this.slope(),a=t.slope();if(n===a)return this.yintercept()===t.yintercept()&&this.xintercept()===t.xintercept();if(h(n)&&h(a)){if(this.isHorizontal())return new s(t.solveForX(this.yintercept()),this.yintercept());if(t.isHorizontal())return new s(this.solveForX(t.yintercept()),t.yintercept());var c=t.solveForX(-1);e=t.solveForY(c),i=t.solveForX(1),o=t.solveForY(i);var u=this.solveForX(-1),l=this.solveForY(u),_=this.solveForX(1),p=this.solveForY(_),y=m(c,e,i,o),f=m(u,l,_,p),d=m(y,c-i,f,u-_),v=m(y,e-o,f,l-p),x=m(c-i,e-o,u-_,l-p);return s(d/x,v/x)}var g,b,A=this.xintercept()||t.xintercept();return h(n)?(g=n,b=this.yintercept()):(g=a,b=t.yintercept()),s(A,0!==g?A*g+b:b)},c.fromPoints=function(t,e,i,s){n(e)?(s=e[1],i=e[0]):r(e)&&r(e.x)&&r(e.y)&&(s=e.y,i=e.x),n(t)?(e=t[1],t=t[0]):r(t)&&r(t.x)&&r(t.y)&&(e=t.y,t=t.x);var o=new c,a=(s-e)/(i-t);return o.slope(a),o.isHorizontal()?o.yintercept(e):o.isVertical()?o.xintercept(i):o.yintercept(e-a*t),o},c.prototype.isHorizontal=function(){return!this.slope()},c.prototype.isVertical=function(){return!h(this.slope())},c.prototype.closestPointTo=function(t){var e=this.yintercept(),i=this.xintercept();this.slope();return this.isHorizontal()?s(t.x,e):this.isVertical()?s(i,t.y):this.intersect(this.createPerpendicular(t))},c.prototype.containsPoint=function(t,e){var i=t;return r(e)||(e=t.y,i=t.x),this.isHorizontal()?e===this.yintercept():this.isVertical()?i===this.xintercept():e===this.solveForY(i)},"object"==typeof t.exports&&(t.exports=c),"undefined"!=typeof window&&(window.Line2=window.Line2||c)},function(t,e,i){!function e(i,s,o){function n(t,e){return this instanceof n?"object"==typeof t&&t?(this.y=t.y||0,void(this.x=t.x||0)):(this.x=n.clean(t||0),void(this.y=n.clean(e||0))):new n(t,e)}n.prototype={change:function(t){if(t)this.observers?this.observers.push(t):this.observers=[t];else if(this.observers)for(var e=this.observers.length-1;e>=0;e--)this.observers[e](this);return this},ignore:function(t){if(this.observers)for(var e=this.observers,i=e.length;i--;)e[i]===t&&e.splice(i,1);return this},set:function(t,e,i){return"number"!=typeof t&&(i=e,e=t.y,t=t.x),this.x===t&&this.y===e?this:(this.x=n.clean(t),this.y=n.clean(e),!1!==i?this.change():void 0)},zero:function(){return this.set(0,0)},clone:function(){return new n(this.x,this.y)},negate:function(t){return t?new n(-this.x,-this.y):this.set(-this.x,-this.y)},add:function(t,e){return e?new n(this.x+t.x,this.y+t.y):(this.x+=t.x,this.y+=t.y,this.change())},subtract:function(t,e){return e?new n(this.x-t.x,this.y-t.y):(this.x-=t.x,this.y-=t.y,this.change())},multiply:function(t,e){var i,s;return"number"!=typeof t?(i=t.x,s=t.y):i=s=t,e?new n(this.x*i,this.y*s):this.set(this.x*i,this.y*s)},rotate:function(t,e,i){var s,o,r=this.x,a=this.y,h=Math.cos(t),m=Math.sin(t);return s=h*r-(e=e?-1:1)*m*a,o=e*m*r+h*a,i?new n(s,o):this.set(s,o)},length:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},lengthSquared:function(){var t=this.x,e=this.y;return t*t+e*e},distance:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},normalize:function(t){var e=this.length(),i=e<Number.MIN_VALUE?0:1/e;return t?new n(this.x*i,this.y*i):this.set(this.x*i,this.y*i)},equal:function(t,e){return e===o&&(e=t.y,t=t.x),n.clean(t)===this.x&&n.clean(e)===this.y},abs:function(t){var e=Math.abs(this.x),i=Math.abs(this.y);return t?new n(e,i):this.set(e,i)},min:function(t,e){var i=this.x,s=this.y,o=t.x,r=t.y,a=i<o?i:o,h=s<r?s:r;return e?new n(a,h):this.set(a,h)},max:function(t,e){var i=this.x,s=this.y,o=t.x,r=t.y,a=i>o?i:o,h=s>r?s:r;return e?new n(a,h):this.set(a,h)},clamp:function(t,e,i){var s=this.min(e,!0).max(t);return i?s:this.set(s.x,s.y)},lerp:function(t,e){return this.add(t.subtract(this,!0).multiply(e),!0)},skew:function(){return new n(-this.y,this.x)},dot:function(t){return n.clean(this.x*t.x+t.y*this.y)},perpDot:function(t){return n.clean(this.x*t.y-this.y*t.x)},angleTo:function(t){return Math.atan2(this.perpDot(t),this.dot(t))},divide:function(t,e){var i,s;if("number"!=typeof t?(i=t.x,s=t.y):i=s=t,0===i||0===s)throw new Error("division by zero");if(isNaN(i)||isNaN(s))throw new Error("NaN detected");return e?new n(this.x/i,this.y/s):this.set(this.x/i,this.y/s)},isPointOnLine:function(t,e){return(t.y-this.y)*(t.x-e.x)==(t.y-e.y)*(t.x-this.x)},toArray:function(){return[this.x,this.y]},fromArray:function(t){return this.set(t[0],t[1])},toJSON:function(){return{x:this.x,y:this.y}},toString:function(){return"("+this.x+", "+this.y+")"}},n.fromArray=function(t){return new n(t[0],t[1])},n.precision=s||8;var r=Math.pow(10,n.precision);return n.clean=i||function(t){if(isNaN(t))throw new Error("NaN detected");if(!isFinite(t))throw new Error("Infinity detected");return Math.round(t)===t?t:Math.round(t*r)/r},n.inject=e,i||(n.fast=e((function(t){return t})),"object"==typeof t.exports?t.exports=n:window.Vec2=window.Vec2||n),n}()},function(t,e,i){var s=i(29),o=i(69),n=i(76),r=i(77),a=Math.abs;function h(t){for(var e=t.length,i=new Array(e),s=0;s<e;s++)i[s]=t[s].slice();return i}function m(t,e,i){this.vec=t,this.alpha=e||0,this.intersect=!!i}function c(t){for(var e,i,s=t.length,o=0;o<s;o++){var n=t[o];e?(i.next=new m(n),i.next.prev=i,i=i.next):i=e=new m(n)}return e}function u(t,e){var i=t[0]-e[0],s=t[1]-e[1];return Math.sqrt(i*i+s*s)}function l(t){for(var e=t.length-1;e--;){var i=t[e],s=t[e+1];i[0]===s[0]&&i[1]===s[1]&&t.splice(e,1)}return t}m.prototype={vec:null,next:null,next:null,prev:null,nextPoly:null,neighbor:null,intersect:null,entry:null,visited:!1,alpha:0,nextNonIntersection:function(){for(var t=this;t&&t.intersect;)t=t.next;return t},last:function(){for(var t=this;t.next&&t.next!==this;)t=t.next;return t},createLoop:function(){var t=this.last();t.prev.next=this,this.prev=t.prev},firstNodeOfInterest:function(){var t=this;if(t)do{t=t.next}while(t!==this&&(!t.intersect||t.intersect&&t.visited));return t},insertBetween:function(t,e){for(var i=t;i!==e&&i.alpha<this.alpha;)i=i.next;this.next=i,this.prev=i.prev,this.prev&&(this.prev.next=this),this.next.prev=this}},t.exports=function(t,e,i){var _,p=c(t),y=c(e),f=o([e]),d=o([t]);if(function(t,e){var i,o,n=t.last();n.next=new m(t.vec,n),n.next.prev=n;var r=e.last();r.next=new m(e.vec,r),r.next.prev=r;var a=!1;for(i=t;i.next;i=i.next)if(!i.intersect)for(o=e;o.next;o=o.next)if(!o.intersect){var h=i.vec,c=i.next.nextNonIntersection().vec,l=o.vec,_=o.next.nextNonIntersection().vec,p=s(h,c,l,_);if(p&&!0!==p){a=!0;var y=new m(p,u(h,p)/u(h,c),!0),f=new m(p,u(l,p)/u(l,_),!0);y.neighbor=f,f.neighbor=y,y.insertBetween(i,i.next.nextNonIntersection()),f.insertBetween(o,o.next.nextNonIntersection())}}return a}(p,y))!function(t,e,i,s,o){var n,r,a=i(t.vec)<0;for("and"===o&&(a=!a),n=t;n.next;n=n.next)n.intersect&&(n.entry=a,a=!a);var h=s(e.vec)>0;for("or"===o&&(h=!h),r=e;r.next;r=r.next)r.intersect&&(r.entry=h,h=!h)}(p,y,f,d,i),_=function(t,e){t.createLoop(),e.createLoop();for(var i,s,o=[];(i=t.firstNodeOfInterest())!==t;){for(s=[];!i.visited;i=i.neighbor){s.push(i.vec);for(var n=i.entry;;){if(i.visited=!0,(i=n?i.next:i.prev).intersect){i.visited=!0;break}s.push(i.vec)}}o.push(l(s))}return o}(p,y);else{var v=f(t[0])<0,x=d(e[0])<0;switch(_=[],i){case"or":v||x?v?_.push(h(e)):x&&_.push(h(t)):(_.push(h(t)),_.push(h(e)));break;case"and":if(v)_.push(h(t));else{if(!x)throw new Error("woops");_.push(h(e))}break;case"not":var g=h(t),b=h(e),A=n(g),B=n(b);r(A)===r(B)&&(x?b.reverse():v&&g.reverse()),_.push(g),a(A)>a(B)?_.push(b):_.unshift(b)}}return _}},function(t,e,i){"use strict";t.exports=function(t,e){e=!!e;for(var i=t.length,r=0,a=0;a<i;++a)r+=t[a].length;if(0===r)return n;var h=new Array(r),m=0;for(a=0;a<i;++a)for(var c=t[a],u=c.length,l=u-1,_=0;_<u;l=_++)h[m++]=[c[l],c[_]];var p,y=o(h),f=y.slabs[0];if(f){for(;f.left;)f=f.left;var d=f.key;p=d[0][0]<d[1][0]?-1:1}else{d=h[y.horizontal[0][0].index];p=d[0][1]<d[1][1]?1:-1}e&&(p=-p);return function(t,e,i,o){return function(n){var r=e.castUp(n);if(r<0)return i;var a=t[r];return o?s(n,a[1],a[0]):s(n,a[0],a[1])}}(h,y,p,e)};var s=i(26),o=i(72);function n(t){return-1}},function(t,e,i){"use strict";t.exports=function(t,e,i){var s=t+e,o=s-t,n=e-o,r=t-(s-o);if(i)return i[0]=r+n,i[1]=s,i;return[r+n,s]}},function(t,e,i){"use strict";t.exports=function(t,e){var i=0|t.length,s=0|e.length;if(1===i&&1===s)return function(t,e){var i=t+e,s=i-t,o=t-(i-s)+(e-s);if(o)return[o,i];return[i]}(t[0],-e[0]);var o,n,r=new Array(i+s),a=0,h=0,m=0,c=Math.abs,u=t[h],l=c(u),_=-e[m],p=c(_);l<p?(n=u,(h+=1)<i&&(u=t[h],l=c(u))):(n=_,(m+=1)<s&&(_=-e[m],p=c(_)));h<i&&l<p||m>=s?(o=u,(h+=1)<i&&(u=t[h],l=c(u))):(o=_,(m+=1)<s&&(_=-e[m],p=c(_)));var y,f,d=o+n,v=d-o,x=n-v,g=x,b=d;for(;h<i&&m<s;)l<p?(o=u,(h+=1)<i&&(u=t[h],l=c(u))):(o=_,(m+=1)<s&&(_=-e[m],p=c(_))),(x=(n=g)-(v=(d=o+n)-o))&&(r[a++]=x),g=b-((y=b+d)-(f=y-b))+(d-f),b=y;for(;h<i;)(x=(n=g)-(v=(d=(o=u)+n)-o))&&(r[a++]=x),g=b-((y=b+d)-(f=y-b))+(d-f),b=y,(h+=1)<i&&(u=t[h]);for(;m<s;)(x=(n=g)-(v=(d=(o=_)+n)-o))&&(r[a++]=x),g=b-((y=b+d)-(f=y-b))+(d-f),b=y,(m+=1)<s&&(_=-e[m]);g&&(r[a++]=g);b&&(r[a++]=b);a||(r[a++]=0);return r.length=a,r}},function(t,e,i){"use strict";t.exports=function(t){for(var e=t.length,i=2*e,s=new Array(i),n=0;n<e;++n){var h=t[n],m=h[0][0]<h[1][0];s[2*n]=new u(h[0][0],h,m,n),s[2*n+1]=new u(h[1][0],h,!m,n)}s.sort((function(t,e){var i=t.x-e.x;return i||((i=t.create-e.create)||Math.min(t.segment[0][1],t.segment[1][1])-Math.min(e.segment[0][1],e.segment[1][1]))}));var l=o(r),_=[],p=[],y=[];for(n=0;n<i;){for(var f=s[n].x,d=[];n<i;){var v=s[n];if(v.x!==f)break;n+=1,v.segment[0][0]===v.x&&v.segment[1][0]===v.x?v.create&&(v.segment[0][1]<v.segment[1][1]?(d.push(new c(v.segment[0][1],v.index,!0,!0)),d.push(new c(v.segment[1][1],v.index,!1,!1))):(d.push(new c(v.segment[1][1],v.index,!0,!1)),d.push(new c(v.segment[0][1],v.index,!1,!0)))):l=v.create?l.insert(v.segment,v.index):l.remove(v.segment)}_.push(l.root),p.push(f),y.push(d)}return new a(_,p,y)};var s=i(73),o=i(74),n=i(26),r=i(75);function a(t,e,i){this.slabs=t,this.coordinates=e,this.horizontal=i}function h(t,e){return t.y-e}function m(t,e){for(var i=null;t;){var s,o,r=t.key;r[0][0]<r[1][0]?(s=r[0],o=r[1]):(s=r[1],o=r[0]);var a=n(s,o,e);if(a<0)t=t.left;else if(a>0)if(e[0]!==r[1][0])i=t,t=t.right;else{if(h=m(t.right,e))return h;t=t.left}else{if(e[0]!==r[1][0])return t;var h;if(h=m(t.right,e))return h;t=t.left}}return i}function c(t,e,i,s){this.y=t,this.index=e,this.start=i,this.closed=s}function u(t,e,i,s){this.x=t,this.segment=e,this.create=i,this.index=s}a.prototype.castUp=function(t){var e=s.le(this.coordinates,t[0]);if(e<0)return-1;this.slabs[e];var i=m(this.slabs[e],t),o=-1;if(i&&(o=i.value),this.coordinates[e]===t[0]){var a=null;if(i&&(a=i.key),e>0){var c=m(this.slabs[e-1],t);c&&(a?r(c.key,a)>0&&(a=c.key,o=c.value):(o=c.value,a=c.key))}var u=this.horizontal[e];if(u.length>0){var l=s.ge(u,t[1],h);if(l<u.length){var _=u[l];if(t[1]===_.y){if(_.closed)return _.index;for(;l<u.length-1&&u[l+1].y===t[1];)if((_=u[l+=1]).closed)return _.index;if(_.y===t[1]&&!_.start){if((l+=1)>=u.length)return o;_=u[l]}}if(_.start)if(a){var p=n(a[0],a[1],[t[0],_.y]);a[0][0]>a[1][0]&&(p=-p),p>0&&(o=_.index)}else o=_.index;else _.y!==t[1]&&(o=_.index)}}}return o}},function(t,e,i){"use strict";function s(t,e,i,s,o,n){var r=["function ",t,"(a,l,h,",s.join(","),"){",n?"":"var i=",i?"l-1":"h+1",";while(l<=h){var m=(l+h)>>>1,x=a",o?".get(m)":"[m]"];return n?e.indexOf("c")<0?r.push(";if(x===y){return m}else if(x<=y){"):r.push(";var p=c(x,y);if(p===0){return m}else if(p<=0){"):r.push(";if(",e,"){i=m;"),i?r.push("l=m+1}else{h=m-1}"):r.push("h=m-1}else{l=m+1}"),r.push("}"),n?r.push("return -1};"):r.push("return i};"),r.join("")}function o(t,e,i,o){return new Function([s("A","x"+t+"y",e,["y"],!1,o),s("B","x"+t+"y",e,["y"],!0,o),s("P","c(x,y)"+t+"0",e,["y","c"],!1,o),s("Q","c(x,y)"+t+"0",e,["y","c"],!0,o),"function dispatchBsearch",i,"(a,y,c,l,h){if(a.shape){if(typeof(c)==='function'){return Q(a,(l===undefined)?0:l|0,(h===undefined)?a.shape[0]-1:h|0,y,c)}else{return B(a,(c===undefined)?0:c|0,(l===undefined)?a.shape[0]-1:l|0,y)}}else{if(typeof(c)==='function'){return P(a,(l===undefined)?0:l|0,(h===undefined)?a.length-1:h|0,y,c)}else{return A(a,(c===undefined)?0:c|0,(l===undefined)?a.length-1:l|0,y)}}}return dispatchBsearch",i].join(""))()}t.exports={ge:o(">=",!1,"GE"),gt:o(">",!1,"GT"),lt:o("<",!0,"LT"),le:o("<=",!0,"LE"),eq:o("-",!0,"EQ",!0)}},function(t,e,i){"use strict";t.exports=function(t){return new a(t||y,null)};function s(t,e,i,s,o,n){this._color=t,this.key=e,this.value=i,this.left=s,this.right=o,this._count=n}function o(t){return new s(t._color,t.key,t.value,t.left,t.right,t._count)}function n(t,e){return new s(t,e.key,e.value,e.left,e.right,e._count)}function r(t){t._count=1+(t.left?t.left._count:0)+(t.right?t.right._count:0)}function a(t,e){this._compare=t,this.root=e}var h=a.prototype;function m(t,e){var i;if(e.left&&(i=m(t,e.left)))return i;return(i=t(e.key,e.value))||(e.right?m(t,e.right):void 0)}function c(t,e,i,s){if(e(t,s.key)<=0){var o;if(s.left)if(o=c(t,e,i,s.left))return o;if(o=i(s.key,s.value))return o}if(s.right)return c(t,e,i,s.right)}function u(t,e,i,s,o){var n,r=i(t,o.key),a=i(e,o.key);if(r<=0){if(o.left&&(n=u(t,e,i,s,o.left)))return n;if(a>0&&(n=s(o.key,o.value)))return n}if(a>0&&o.right)return u(t,e,i,s,o.right)}function l(t,e){this.tree=t,this._stack=e}Object.defineProperty(h,"keys",{get:function(){var t=[];return this.forEach((function(e,i){t.push(e)})),t}}),Object.defineProperty(h,"values",{get:function(){var t=[];return this.forEach((function(e,i){t.push(i)})),t}}),Object.defineProperty(h,"length",{get:function(){return this.root?this.root._count:0}}),h.insert=function(t,e){for(var i=this._compare,o=this.root,h=[],m=[];o;){var c=i(t,o.key);h.push(o),m.push(c),o=c<=0?o.left:o.right}h.push(new s(0,t,e,null,null,1));for(var u=h.length-2;u>=0;--u){o=h[u];m[u]<=0?h[u]=new s(o._color,o.key,o.value,h[u+1],o.right,o._count+1):h[u]=new s(o._color,o.key,o.value,o.left,h[u+1],o._count+1)}for(u=h.length-1;u>1;--u){var l=h[u-1];o=h[u];if(1===l._color||1===o._color)break;var _=h[u-2];if(_.left===l)if(l.left===o){if(!(p=_.right)||0!==p._color){if(_._color=0,_.left=l.right,l._color=1,l.right=_,h[u-2]=l,h[u-1]=o,r(_),r(l),u>=3)(y=h[u-3]).left===_?y.left=l:y.right=l;break}l._color=1,_.right=n(1,p),_._color=0,u-=1}else{if(!(p=_.right)||0!==p._color){if(l.right=o.left,_._color=0,_.left=o.right,o._color=1,o.left=l,o.right=_,h[u-2]=o,h[u-1]=l,r(_),r(l),r(o),u>=3)(y=h[u-3]).left===_?y.left=o:y.right=o;break}l._color=1,_.right=n(1,p),_._color=0,u-=1}else if(l.right===o){if(!(p=_.left)||0!==p._color){if(_._color=0,_.right=l.left,l._color=1,l.left=_,h[u-2]=l,h[u-1]=o,r(_),r(l),u>=3)(y=h[u-3]).right===_?y.right=l:y.left=l;break}l._color=1,_.left=n(1,p),_._color=0,u-=1}else{var p;if(!(p=_.left)||0!==p._color){var y;if(l.left=o.right,_._color=0,_.right=o.left,o._color=1,o.right=l,o.left=_,h[u-2]=o,h[u-1]=l,r(_),r(l),r(o),u>=3)(y=h[u-3]).right===_?y.right=o:y.left=o;break}l._color=1,_.left=n(1,p),_._color=0,u-=1}}return h[0]._color=1,new a(i,h[0])},h.forEach=function(t,e,i){if(this.root)switch(arguments.length){case 1:return m(t,this.root);case 2:return c(e,this._compare,t,this.root);case 3:if(this._compare(e,i)>=0)return;return u(e,i,this._compare,t,this.root)}},Object.defineProperty(h,"begin",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.left;return new l(this,t)}}),Object.defineProperty(h,"end",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.right;return new l(this,t)}}),h.at=function(t){if(t<0)return new l(this,[]);for(var e=this.root,i=[];;){if(i.push(e),e.left){if(t<e.left._count){e=e.left;continue}t-=e.left._count}if(!t)return new l(this,i);if(t-=1,!e.right)break;if(t>=e.right._count)break;e=e.right}return new l(this,[])},h.ge=function(t){for(var e=this._compare,i=this.root,s=[],o=0;i;){var n=e(t,i.key);s.push(i),n<=0&&(o=s.length),i=n<=0?i.left:i.right}return s.length=o,new l(this,s)},h.gt=function(t){for(var e=this._compare,i=this.root,s=[],o=0;i;){var n=e(t,i.key);s.push(i),n<0&&(o=s.length),i=n<0?i.left:i.right}return s.length=o,new l(this,s)},h.lt=function(t){for(var e=this._compare,i=this.root,s=[],o=0;i;){var n=e(t,i.key);s.push(i),n>0&&(o=s.length),i=n<=0?i.left:i.right}return s.length=o,new l(this,s)},h.le=function(t){for(var e=this._compare,i=this.root,s=[],o=0;i;){var n=e(t,i.key);s.push(i),n>=0&&(o=s.length),i=n<0?i.left:i.right}return s.length=o,new l(this,s)},h.find=function(t){for(var e=this._compare,i=this.root,s=[];i;){var o=e(t,i.key);if(s.push(i),0===o)return new l(this,s);i=o<=0?i.left:i.right}return new l(this,[])},h.remove=function(t){var e=this.find(t);return e?e.remove():this},h.get=function(t){for(var e=this._compare,i=this.root;i;){var s=e(t,i.key);if(0===s)return i.value;i=s<=0?i.left:i.right}};var _=l.prototype;function p(t,e){t.key=e.key,t.value=e.value,t.left=e.left,t.right=e.right,t._color=e._color,t._count=e._count}function y(t,e){return t<e?-1:t>e?1:0}Object.defineProperty(_,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(_,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),_.clone=function(){return new l(this.tree,this._stack.slice())},_.remove=function(){var t=this._stack;if(0===t.length)return this.tree;var e=new Array(t.length),i=t[t.length-1];e[e.length-1]=new s(i._color,i.key,i.value,i.left,i.right,i._count);for(var h=t.length-2;h>=0;--h){(i=t[h]).left===t[h+1]?e[h]=new s(i._color,i.key,i.value,e[h+1],i.right,i._count):e[h]=new s(i._color,i.key,i.value,i.left,e[h+1],i._count)}if((i=e[e.length-1]).left&&i.right){var m=e.length;for(i=i.left;i.right;)e.push(i),i=i.right;var c=e[m-1];e.push(new s(i._color,c.key,c.value,i.left,i.right,i._count)),e[m-1].key=i.key,e[m-1].value=i.value;for(h=e.length-2;h>=m;--h)i=e[h],e[h]=new s(i._color,i.key,i.value,i.left,e[h+1],i._count);e[m-1].left=e[m]}if(0===(i=e[e.length-1])._color){var u=e[e.length-2];u.left===i?u.left=null:u.right===i&&(u.right=null),e.pop();for(h=0;h<e.length;++h)e[h]._count--;return new a(this.tree._compare,e[0])}if(i.left||i.right){i.left?p(i,i.left):i.right&&p(i,i.right),i._color=1;for(h=0;h<e.length-1;++h)e[h]._count--;return new a(this.tree._compare,e[0])}if(1===e.length)return new a(this.tree._compare,null);for(h=0;h<e.length;++h)e[h]._count--;var l=e[e.length-2];return function(t){for(var e,i,s,a,h=t.length-1;h>=0;--h){if(e=t[h],0===h)return void(e._color=1);if((i=t[h-1]).left===e){if((s=i.right).right&&0===s.right._color){if(a=(s=i.right=o(s)).right=o(s.right),i.right=s.left,s.left=i,s.right=a,s._color=i._color,e._color=1,i._color=1,a._color=1,r(i),r(s),h>1)(m=t[h-2]).left===i?m.left=s:m.right=s;return void(t[h-1]=s)}if(s.left&&0===s.left._color){if(a=(s=i.right=o(s)).left=o(s.left),i.right=a.left,s.left=a.right,a.left=i,a.right=s,a._color=i._color,i._color=1,s._color=1,e._color=1,r(i),r(s),r(a),h>1)(m=t[h-2]).left===i?m.left=a:m.right=a;return void(t[h-1]=a)}if(1===s._color){if(0===i._color)return i._color=1,void(i.right=n(0,s));i.right=n(0,s);continue}s=o(s),i.right=s.left,s.left=i,s._color=i._color,i._color=0,r(i),r(s),h>1&&((m=t[h-2]).left===i?m.left=s:m.right=s),t[h-1]=s,t[h]=i,h+1<t.length?t[h+1]=e:t.push(e),h+=2}else{if((s=i.left).left&&0===s.left._color){if(a=(s=i.left=o(s)).left=o(s.left),i.left=s.right,s.right=i,s.left=a,s._color=i._color,e._color=1,i._color=1,a._color=1,r(i),r(s),h>1)(m=t[h-2]).right===i?m.right=s:m.left=s;return void(t[h-1]=s)}if(s.right&&0===s.right._color){if(a=(s=i.left=o(s)).right=o(s.right),i.left=a.right,s.right=a.left,a.right=i,a.left=s,a._color=i._color,i._color=1,s._color=1,e._color=1,r(i),r(s),r(a),h>1)(m=t[h-2]).right===i?m.right=a:m.left=a;return void(t[h-1]=a)}if(1===s._color){if(0===i._color)return i._color=1,void(i.left=n(0,s));i.left=n(0,s);continue}var m;s=o(s),i.left=s.right,s.right=i,s._color=i._color,i._color=0,r(i),r(s),h>1&&((m=t[h-2]).right===i?m.right=s:m.left=s),t[h-1]=s,t[h]=i,h+1<t.length?t[h+1]=e:t.push(e),h+=2}}}(e),l.left===i?l.left=null:l.right=null,new a(this.tree._compare,e[0])},Object.defineProperty(_,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(_,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(_,"index",{get:function(){var t=0,e=this._stack;if(0===e.length){var i=this.tree.root;return i?i._count:0}e[e.length-1].left&&(t=e[e.length-1].left._count);for(var s=e.length-2;s>=0;--s)e[s+1]===e[s].right&&(++t,e[s].left&&(t+=e[s].left._count));return t},enumerable:!0}),_.next=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.right)for(e=e.right;e;)t.push(e),e=e.left;else for(t.pop();t.length>0&&t[t.length-1].right===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(_,"hasNext",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].right)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].left===t[e])return!0;return!1}}),_.update=function(t){var e=this._stack;if(0===e.length)throw new Error("Can't update empty node!");var i=new Array(e.length),o=e[e.length-1];i[i.length-1]=new s(o._color,o.key,t,o.left,o.right,o._count);for(var n=e.length-2;n>=0;--n)(o=e[n]).left===e[n+1]?i[n]=new s(o._color,o.key,o.value,i[n+1],o.right,o._count):i[n]=new s(o._color,o.key,o.value,o.left,i[n+1],o._count);return new a(this.tree._compare,i[0])},_.prev=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.left)for(e=e.left;e;)t.push(e),e=e.right;else for(t.pop();t.length>0&&t[t.length-1].left===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(_,"hasPrev",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].left)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].right===t[e])return!0;return!1}})},function(t,e,i){"use strict";t.exports=function(t,e){var i,n,r,a;if(e[0][0]<e[1][0])i=e[0],n=e[1];else{if(!(e[0][0]>e[1][0]))return o(e,t);i=e[1],n=e[0]}if(t[0][0]<t[1][0])r=t[0],a=t[1];else{if(!(t[0][0]>t[1][0]))return-o(t,e);r=t[1],a=t[0]}var h=s(i,n,a),m=s(i,n,r);if(h<0){if(m<=0)return h}else if(h>0){if(m>=0)return h}else if(m)return m;if(h=s(a,r,n),m=s(a,r,i),h<0){if(m<=0)return h}else if(h>0){if(m>=0)return h}else if(m)return m;return n[0]-a[0]};var s=i(26);function o(t,e){var i,o,n,r;if(e[0][0]<e[1][0])i=e[0],o=e[1];else{if(!(e[0][0]>e[1][0])){var a=Math.min(t[0][1],t[1][1]),h=Math.max(t[0][1],t[1][1]),m=Math.min(e[0][1],e[1][1]),c=Math.max(e[0][1],e[1][1]);return h<m?h-m:a>c?a-c:h-c}i=e[1],o=e[0]}t[0][1]<t[1][1]?(n=t[0],r=t[1]):(n=t[1],r=t[0]);var u=s(o,i,n);return u||((u=s(o,i,r))||r-o)}},function(t,e){t.exports=function(t){for(var e=0,o=t[0],n=t.length,r=2;r<n;r++){var a=t[r-1],h=t[r];i[0]=o[0]-h[0],i[1]=o[1]-h[1],s[0]=o[0]-a[0],s[1]=o[1]-a[1],e+=i[0]*s[1]-i[1]*s[0]}return e/2};var i=[0,0],s=[0,0]},function(t,e,i){"use strict";t.exports=function(t){return t<0?-1:t>0?1:0}},function(t,e,i){var s=i(79),o=i(82);function n(t,e){return t[0]===e[0]&&t[1]===e[1]}t.exports=function(t,e){for(var i={},u=t.length,l=[],_=0;_<u;_++){var p=t[_],y=t[(_+1)%u];c(p,h),c(y,m);for(var f=0;f<u;f++)if(_!==f){var d=t[f],v=t[(f+1)%u];if(c(d,r),c(v,a),!(n(r,h)||n(r,m)||n(a,h)||n(a,m))){var x=s(h,m,r,a),g=x[2];if(1!==g.length||g[0]){var b=o(x[2]);if(x[0]=o(x[0])/b,x[1]=o(x[1])/b,x.pop(),!(n(x,h)||n(x,m)||n(x,r)||n(x,a))){var A=x+"",B=!i[A];B&&(i[A]=!0);var w=B;e&&(w=e(x,_,p,y,f,d,v,B)),w&&l.push(x)}}}}}return l};var r=[0,0],a=[0,0],h=[0,0],m=[0,0];function c(t,e){Array.isArray(t)?(e[0]=t[0],e[1]=t[1]):(e[0]=t.x,e[1]=t.y)}},function(t,e,i){"use strict";t.exports=function(t,e,i,h){if(!a(t,e,i,h))return[[0],[0],[0]];var m=o([i[1]],[-h[1]]),c=o([-i[0]],[h[0]]),u=o(o(n(c,t[1]),n(c,-e[1])),o(n(m,t[0]),n(m,-e[0]))),l=o(s(-t[0],e[1]),s(t[1],e[0])),_=o(s(-i[0],h[1]),s(i[1],h[0])),p=o(o(n(_,t[0]),n(_,-e[0])),o(n(l,-i[0]),n(l,h[0]))),y=o(o(n(_,t[1]),n(_,-e[1])),o(n(l,-i[1]),n(l,h[1])));return[r(p),r(y),r(u)]};var s=i(30),o=i(37),n=i(38),r=i(80),a=i(81)},function(t,e,i){"use strict";t.exports=function(t){for(var e=t.length,i=t[t.length-1],s=e,o=e-2;o>=0;--o){var n=i,r=t[o];(h=r-((i=n+r)-n))&&(t[--s]=i,i=h)}var a=0;for(o=s;o<e;++o){var h;n=t[o];(h=(r=i)-((i=n+r)-n))&&(t[a++]=h)}return t[a++]=i,t.length=a,t}},function(t,e,i){"use strict";t.exports=function(t,e,i,o){var n=s(t,i,o),r=s(e,i,o);if(n>0&&r>0||n<0&&r<0)return!1;var a=s(i,t,e),h=s(o,t,e);if(a>0&&h>0||a<0&&h<0)return!1;if(0===n&&0===r&&0===a&&0===h)return function(t,e,i,s){for(var o=0;o<2;++o){var n=t[o],r=e[o],a=Math.min(n,r),h=Math.max(n,r),m=i[o],c=s[o],u=Math.min(m,c);if(Math.max(m,c)<a||h<u)return!1}return!0}(t,e,i,o);return!0};var s=i(26)[3]},function(t,e){t.exports=function(t){var e=0,i=t.length;switch(i){case 1:e=t[0];break;case 2:e=t[0]+t[1];break;case 3:e=t[0]+t[1]+t[2];break;case 4:e=t[0]+t[1]+t[2]+t[3];break;default:for(var s=0;s<i;s++)e+=t[s]}return e}}])}));